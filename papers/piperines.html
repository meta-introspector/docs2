<!DOCTYPE html><html>
<head>
<title></title>
<style type="text/css">
<!--
.xflip {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    filter: fliph;
}
.yflip {
    -moz-transform: scaleY(-1);
    -webkit-transform: scaleY(-1);
    -o-transform: scaleY(-1);
    transform: scaleY(-1);
    filter: flipv;
}
.xyflip {
    -moz-transform: scaleX(-1) scaleY(-1);
    -webkit-transform: scaleX(-1) scaleY(-1);
    -o-transform: scaleX(-1) scaleY(-1);
    transform: scaleX(-1) scaleY(-1);
    filter: fliph + flipv;
}
-->
</style>
</head>
<body>
<a name=1></a>Replicated&#160;state&#160;machines&#160;without&#160;replicated&#160;execution<br/>
Jonathan&#160;Lee<br/>
Kirill&#160;Nikitin<i></i><br/>
Srinath&#160;Setty<br/>
<i>Microsoft&#160;Research</i><br/>
<i>EPFL</i><br/>
Abstract<br/>
<i>S&#160;</i>with&#160;<i>x&#160;</i>as&#160;input&#160;(using&#160;<i>π</i>)—<i>without&#160;</i>reexecuting&#160;the&#160;state<br/>
This&#160;paper&#160;introduces&#160;a&#160;new&#160;approach&#160;to&#160;reduce&#160;end-to-end<br/>
transitions.&#160;Furthermore,&#160;the&#160;cost&#160;of&#160;verifying&#160;such&#160;a&#160;proof&#160;is<br/>
costs&#160;in&#160;large-scale&#160;replicated&#160;systems&#160;built&#160;under&#160;a&#160;Byzantine<br/>
less&#160;than&#160;reexecuting&#160;the&#160;corresponding&#160;state&#160;transitions&#160;and<br/>
fault&#160;model.&#160;Speciﬁcally,&#160;our&#160;approach&#160;transforms&#160;a&#160;given<br/>
the&#160;size&#160;of&#160;the&#160;proof&#160;is&#160;far&#160;less&#160;than&#160;the&#160;size&#160;of&#160;the&#160;original<br/>
replicated&#160;state&#160;machine&#160;(RSM)&#160;to&#160;another&#160;RSM&#160;where&#160;nodes<br/>
batch&#160;of&#160;transactions.&#160;Thus,&#160;nodes&#160;(in&#160;an&#160;RSM)&#160;that&#160;replicate<br/>
incur&#160;lower&#160;costs&#160;by&#160;<i>delegating&#160;</i>state&#160;machine&#160;execution:&#160;an<br/>
a&#160;state&#160;machine&#160;<i>S&#160;</i>can&#160;delegate&#160;<i>S&#160;</i>to&#160;an&#160;untrusted&#160;prover&#160;and<br/>
untrusted&#160;prover&#160;produces&#160;succinct&#160;cryptographic&#160;proofs&#160;of<br/>
then&#160;replicate&#160;the&#160;veriﬁer&#160;at&#160;each&#160;node&#160;to&#160;verify&#160;the&#160;prover’s<br/>
correct&#160;state&#160;transitions&#160;along&#160;with&#160;state&#160;changes,&#160;which&#160;nodes<br/>
proofs.&#160;Naturally,&#160;if&#160;the&#160;end-to-end&#160;resource&#160;costs&#160;of&#160;the&#160;trans-<br/>
in&#160;the&#160;transformed&#160;RSM&#160;verify&#160;and&#160;apply&#160;respectively.<br/>
formed&#160;RSM&#160;(CPU,&#160;storage,&#160;network,&#160;etc.)&#160;is&#160;cheaper&#160;than<br/>
To&#160;realize&#160;our&#160;approach,&#160;we&#160;build&#160;<i>Piperine</i>,&#160;a&#160;system&#160;that<br/>
the&#160;original&#160;RSM,&#160;veriﬁable&#160;delegation&#160;leads&#160;to&#160;lower&#160;costs.<br/>
makes&#160;the&#160;proof&#160;machinery&#160;proﬁtable&#160;in&#160;the&#160;context&#160;of&#160;RSMs.<br/>
In&#160;theory,&#160;the&#160;above&#160;picture&#160;is&#160;straightforward&#160;and&#160;offers<br/>
Speciﬁcally,&#160;Piperine&#160;reduces&#160;the&#160;costs&#160;of&#160;both&#160;proving&#160;and<br/>
a&#160;principled&#160;solution&#160;to&#160;reduce&#160;end-to-end&#160;costs&#160;of&#160;a&#160;repli-<br/>
verifying&#160;the&#160;correctness&#160;of&#160;state&#160;machine&#160;execution&#160;while<br/>
cated&#160;system.&#160;However,&#160;in&#160;practice,&#160;the&#160;above&#160;approach&#160;is<br/>
retaining&#160;liveness—a&#160;distinctive&#160;requirement&#160;in&#160;the&#160;context&#160;of<br/>
completely&#160;impractical.&#160;Speciﬁcally,&#160;even&#160;with&#160;state-of-the-<br/>
RSMs.&#160;Our&#160;experimental&#160;evaluation&#160;demonstrates&#160;that,&#160;for&#160;a<br/>
art&#160;systems&#160;for&#160;veriﬁable&#160;outsourcing,&#160;the&#160;veriﬁer&#160;is&#160;more<br/>
payment&#160;service,&#160;employing&#160;Piperine&#160;is&#160;more&#160;proﬁtable&#160;than<br/>
resource-efﬁcient&#160;compared&#160;to&#160;reexecution&#160;only&#160;under&#160;narrow<br/>
naive&#160;reexecution&#160;of&#160;transactions&#160;as&#160;long&#160;as&#160;there&#160;are&#160;<i>&gt;&#160;</i>104<br/>
regimes&#160;[80,&#160;81,&#160;83].&#160;Furthermore,&#160;in&#160;the&#160;context&#160;of&#160;RSMs,<br/>
nodes.&#160;When&#160;we&#160;apply&#160;Piperine&#160;to&#160;ERC-20&#160;transactions&#160;in<br/>
the&#160;veriﬁer&#160;running&#160;at&#160;each&#160;node&#160;must&#160;have&#160;a&#160;copy&#160;of&#160;the&#160;del-<br/>
Ethereum&#160;(a&#160;real-world&#160;RSM&#160;with&#160;up&#160;to&#160;105&#160;nodes),&#160;it&#160;reduces<br/>
egated&#160;state&#160;machine’s&#160;state,&#160;otherwise&#160;liveness&#160;of&#160;the&#160;trans-<br/>
per-transaction&#160;costs&#160;by&#160;5.4<i>×&#160;</i>and&#160;network&#160;costs&#160;by&#160;2.7<i>×</i>.<br/>
formed&#160;RSM&#160;hinges&#160;on&#160;the&#160;liveness&#160;of&#160;the&#160;prover&#160;(relying&#160;on<br/>the&#160;prover&#160;for&#160;liveness&#160;introduces&#160;attack&#160;vectors&#160;for&#160;mount-<br/>
1<br/>
Introduction<br/>
ing&#160;denial&#160;of&#160;service).&#160;Finally,&#160;the&#160;prover’s&#160;cost&#160;to&#160;produce&#160;a<br/>proof&#160;is&#160;104–107<i>×&#160;</i>higher&#160;than&#160;natively&#160;executing&#160;the&#160;corre-<br/>
A&#160;modern&#160;example&#160;of&#160;a&#160;large-scale&#160;replicated&#160;system&#160;is&#160;a<br/>
sponding&#160;state&#160;transition&#160;(the&#160;overheads&#160;depends&#160;on&#160;whether<br/>
blockchain&#160;network&#160;[64,&#160;86],&#160;which&#160;employs&#160;replication&#160;to<br/>
the&#160;outsourced&#160;computation&#160;is&#160;efﬁciently&#160;representable&#160;in&#160;the<br/>
enable&#160;mutually-distrusting&#160;entities&#160;to&#160;transact&#160;<i>without&#160;</i>rely-<br/>
computational&#160;model&#160;of&#160;the&#160;proof&#160;machinery)&#160;[73,&#160;81].<br/>
ing&#160;on&#160;trusted&#160;authorities.&#160;Speciﬁcally,&#160;blockchains&#160;instantiate<br/>
The&#160;primary&#160;contribution&#160;of&#160;this&#160;paper&#160;is&#160;a&#160;set&#160;of&#160;techniques<br/>
<i>replicated&#160;state&#160;machines&#160;</i>(RSMs)&#160;[71]&#160;under&#160;a&#160;Byzantine<br/>
to&#160;reduce&#160;the&#160;costs&#160;of&#160;veriﬁable&#160;state&#160;machines&#160;in&#160;the&#160;con-<br/>
fault&#160;model&#160;in&#160;an&#160;open,&#160;permissionless&#160;network&#160;where&#160;each<br/>
text&#160;of&#160;RSMs&#160;and&#160;to&#160;ensure&#160;liveness&#160;without&#160;increasing&#160;the<br/>
node&#160;executes&#160;and&#160;validates&#160;every&#160;transaction.&#160;Unfortunately,<br/>
costs&#160;of&#160;the&#160;prover.&#160;To&#160;demonstrate&#160;the&#160;beneﬁts&#160;of&#160;these&#160;tech-<br/>
the&#160;most&#160;popular&#160;blockchains&#160;achieve&#160;a&#160;throughput&#160;of&#160;only<br/>
niques,&#160;we&#160;build&#160;a&#160;system&#160;called&#160;<i>Piperine</i>.&#160;When&#160;we&#160;apply<br/>
a&#160;handful&#160;of&#160;transactions&#160;per&#160;second.&#160;This&#160;has&#160;motivated&#160;re-<br/>
Piperine&#160;to&#160;a&#160;popular&#160;type&#160;of&#160;state&#160;machine&#160;on&#160;Ethereum’s<br/>
search&#160;to&#160;improve&#160;throughput&#160;and&#160;to&#160;reduce&#160;costs,&#160;for&#160;example,<br/>
blockchain,&#160;Piperine’s&#160;proofs&#160;act&#160;as&#160;compressed&#160;information<br/>
by&#160;changing&#160;the&#160;underlying&#160;consensus&#160;protocol&#160;used&#160;to&#160;real-<br/>
(e.g.,&#160;there&#160;is&#160;no&#160;need&#160;to&#160;transmit&#160;digital&#160;signatures&#160;or&#160;the&#160;raw<br/>
ize&#160;RSMs&#160;[41,&#160;46,&#160;50].&#160;These&#160;proposals,&#160;however,&#160;introduce<br/>
transactions&#160;over&#160;the&#160;blockchain),&#160;which&#160;allows&#160;Piperine&#160;to<br/>
additional&#160;assumptions&#160;for&#160;safety&#160;and/or&#160;liveness&#160;(§7).<br/>
transparently&#160;reduce&#160;per-transaction&#160;network&#160;costs&#160;by&#160;2.7<i>×</i><br/>
We&#160;consider&#160;a&#160;different&#160;approach,&#160;one&#160;that&#160;applies&#160;to&#160;any<br/>
and&#160;per-transaction&#160;end-to-end&#160;costs&#160;by&#160;5.4<i>×</i>.&#160;Beyond&#160;cost&#160;re-<br/>
existing&#160;replicated&#160;state&#160;machine&#160;in&#160;a&#160;Byzantine&#160;fault&#160;model<br/>
ductions,&#160;Piperine&#160;resolves&#160;an&#160;open&#160;question&#160;in&#160;the&#160;context&#160;of<br/>
(including&#160;blockchains)&#160;<i>without&#160;</i>any&#160;changes&#160;to&#160;the&#160;underlying<br/>
replicated&#160;systems:&#160;Piperine&#160;offers&#160;the&#160;ﬁrst&#160;approach&#160;to&#160;build<br/>
consensus&#160;protocol.&#160;Naturally,&#160;it&#160;does&#160;not&#160;introduce&#160;any&#160;strong<br/>
RSMs&#160;with&#160;concurrent&#160;transaction&#160;processing&#160;in&#160;a&#160;permis-<br/>
assumptions&#160;for&#160;safety&#160;or&#160;liveness.&#160;In&#160;fact,&#160;this&#160;approach&#160;is<br/>
sionless&#160;model.&#160;Note&#160;that&#160;prior&#160;works&#160;that&#160;achieve&#160;concurrent<br/>
complementary&#160;to&#160;aforementioned&#160;advances&#160;[41,&#160;46,&#160;50]&#160;and<br/>
transaction&#160;processing&#160;in&#160;RSMs&#160;[9,&#160;49]&#160;require&#160;substantial<br/>
can&#160;be&#160;used&#160;in&#160;conjunction&#160;with&#160;those&#160;proposals.&#160;Our&#160;ap-<br/>
changes&#160;to&#160;the&#160;underlying&#160;consensus&#160;protocol&#160;and&#160;apply&#160;only<br/>
proach&#160;is&#160;based&#160;on&#160;work&#160;in&#160;the&#160;area&#160;of&#160;<i>proof-based&#160;veriﬁable</i><br/>
to&#160;a&#160;permissioned&#160;membership&#160;model.<br/>
<i>computation&#160;</i>(see&#160;[83]&#160;for&#160;a&#160;survey),&#160;which&#160;has&#160;developed&#160;a<br/>powerful&#160;primitive&#160;called&#160;<i>veriﬁable&#160;state&#160;machines&#160;</i>[24,&#160;73]:<br/>
Reducing&#160;costs.&#160;To&#160;tame&#160;costs&#160;imposed&#160;by&#160;the&#160;proof&#160;machin-<br/>
for&#160;a&#160;state&#160;machine&#160;<i>S&#160;</i>and&#160;a&#160;batch&#160;of&#160;transactions&#160;<i>x</i>,&#160;an&#160;un-<br/>
ery,&#160;Piperine&#160;leverages&#160;the&#160;following&#160;observations:&#160;(1)&#160;in&#160;our<br/>
trusted&#160;<i>prover&#160;</i>can&#160;produce&#160;outputs&#160;<i>y&#160;</i>and&#160;a&#160;short&#160;proof&#160;<i>π</i><br/>
target&#160;state&#160;machines,&#160;the&#160;primary&#160;computational&#160;bottleneck<br/>
such&#160;that&#160;a&#160;<i>veriﬁer&#160;</i>can&#160;check&#160;if&#160;<i>y&#160;</i>is&#160;the&#160;correct&#160;output&#160;of<br/>
of&#160;a&#160;state&#160;transition&#160;is&#160;authenticating&#160;a&#160;transaction&#160;by&#160;verify-<br/>
<hr/>
<a name=2></a>ing&#160;a&#160;digital&#160;signature;&#160;and&#160;(2)&#160;in&#160;the&#160;context&#160;of&#160;blockchains<br/>
best&#160;of&#160;our&#160;knowledge,&#160;describes&#160;the&#160;ﬁrst&#160;instance&#160;in&#160;which<br/>
(and&#160;RSMs&#160;that&#160;favor&#160;throughput&#160;over&#160;latency),&#160;there&#160;is&#160;signif-<br/>
veriﬁably&#160;delegating&#160;computation&#160;improves&#160;the&#160;performance<br/>
icant&#160;opportunity&#160;for&#160;processing&#160;transactions&#160;in&#160;batches.&#160;The<br/>
of&#160;a&#160;large-scale&#160;distributed&#160;system.<br/>
ﬁrst&#160;observation&#160;enables&#160;Piperine&#160;to&#160;substantially&#160;drive&#160;down<br/>end-to-end&#160;costs&#160;of&#160;the&#160;prover&#160;by&#160;aggressively&#160;optimizing&#160;the<br/>
2<br/>
Piperine’s&#160;base&#160;machinery<br/>
signature&#160;veriﬁcation&#160;operation&#160;in&#160;the&#160;proof&#160;machinery&#160;(i.e.,<br/>
This&#160;section&#160;describes&#160;machinery&#160;that&#160;Piperine&#160;employs:&#160;<i>veriﬁ-</i><br/>
verifying&#160;a&#160;signature&#160;with&#160;a&#160;smaller&#160;circuit).&#160;Our&#160;optimizations<br/>
<i>able&#160;state&#160;machines&#160;</i>[73],&#160;a&#160;primitive&#160;that&#160;involves&#160;two&#160;entities,<br/>
include&#160;a&#160;careful&#160;choice&#160;of&#160;cryptographic&#160;primitives&#160;as&#160;well<br/>
a&#160;prover&#160;<i>P&#160;</i>and&#160;a&#160;veriﬁer&#160;<i>V</i>,&#160;and&#160;a&#160;state&#160;machine&#160;<i>S</i>.&#160;It&#160;enables<br/>
as&#160;several&#160;low-level&#160;cryptographic&#160;engineering&#160;techniques<br/>
the&#160;following&#160;setup.&#160;<i>V&#160;</i>and&#160;<i>P&#160;</i>agree&#160;on&#160;a&#160;non-deterministic<br/>
such&#160;as&#160;double-scalar&#160;multiplication,&#160;windowing,&#160;efﬁcient&#160;big<br/>
state&#160;machine&#160;<i>M&#160;</i>=&#160;(Ψ,&#160;<i>S</i>0),&#160;where&#160;Ψ&#160;is&#160;a&#160;program&#160;that&#160;en-<br/>
number&#160;arithmetic,&#160;etc.1&#160;Due&#160;to&#160;the&#160;second&#160;observation,&#160;the<br/>
codes&#160;state&#160;transitions&#160;and&#160;<i>S</i>0&#160;is&#160;the&#160;initial&#160;state&#160;of&#160;the&#160;machine.<br/>
prover&#160;can&#160;produce&#160;a&#160;single&#160;proof&#160;for&#160;a&#160;batch&#160;of&#160;transactions,<br/>
Both&#160;<i>V&#160;</i>and&#160;<i>P&#160;</i>are&#160;given&#160;as&#160;inputs&#160;auxiliary&#160;setup&#160;material&#160;<i>pp</i><br/>
and&#160;the&#160;veriﬁer&#160;incurs&#160;a&#160;near-constant&#160;cost&#160;to&#160;verify&#160;that&#160;proof.<br/>
related&#160;to&#160;Ψ.&#160;The&#160;internal&#160;state&#160;of&#160;<i>P&#160;</i>is&#160;<i>S</i>,&#160;which&#160;is&#160;initialized<br/>
To&#160;drive&#160;down&#160;the&#160;veriﬁer’s&#160;costs&#160;further,&#160;Piperine&#160;employs<br/>
to&#160;<i>S</i>0,&#160;and&#160;the&#160;internal&#160;state&#160;of&#160;<i>V&#160;</i>is&#160;<i>d</i>,&#160;which&#160;is&#160;initialized&#160;to<br/>
techniques&#160;from&#160;delegating&#160;state&#160;[24,&#160;35,&#160;43]—even&#160;when&#160;<i>not</i><br/>
<i>H</i>(<i>S</i>0),&#160;where&#160;<i>H&#160;</i>is&#160;a&#160;collision-resistant&#160;hash&#160;function.<br/>
delegating&#160;state—to&#160;replace&#160;expensive&#160;modular&#160;exponentia-<br/>tions&#160;with&#160;inexpensive&#160;hash&#160;operations.<br/>
•&#160;<i>P&#160;</i>executes&#160;a&#160;state&#160;transition&#160;using&#160;input&#160;<i>x&#160;</i>and&#160;non-<br/>
deterministic&#160;choices&#160;<i>w&#160;</i>for&#160;<i>M&#160;</i>to&#160;produce&#160;an&#160;output&#160;<i>y</i><br/>
Achieving&#160;liveness.&#160;To&#160;achieve&#160;liveness,&#160;the&#160;veriﬁer&#160;must<br/>
and&#160;an&#160;updated&#160;state:<br/>
efﬁciently&#160;receive&#160;and&#160;verify&#160;state&#160;changes&#160;from&#160;the&#160;prover—<br/>
without&#160;trusting&#160;the&#160;prover.&#160;In&#160;the&#160;context&#160;of&#160;blockchains,<br/>
(<i>y</i>,&#160;<i>S</i>)&#160;<i>←&#160;</i>Ψ(<i>x</i>,&#160;<i>w</i>,&#160;<i>S</i>)&#160;;<br/>
<i>S&#160;←&#160;S</i><br/>
such&#160;liveness&#160;is&#160;critical:&#160;without&#160;liveness,&#160;a&#160;malicious&#160;prover<br/>can&#160;prevent&#160;certain&#160;(or&#160;all)&#160;transactions&#160;from&#160;being&#160;executed.<br/>
<i>P&#160;</i>sends&#160;(<i>x</i>,&#160;<i>y</i>,&#160;<i>π</i>,&#160;<i>d</i>)&#160;to&#160;<i>V&#160;</i>,&#160;where&#160;<i>π&#160;</i>is&#160;a&#160;proof,&#160;<i>d&#160;</i>=&#160;<i>H</i>(<i>S</i>).<br/>
Unfortunately,&#160;with&#160;prior&#160;state-of-the-art&#160;in&#160;veriﬁable&#160;state&#160;ma-<br/>
•&#160;<i>V&#160;</i>runs&#160;a&#160;local&#160;check&#160;using&#160;(<i>pp</i>,&#160;<i>x</i>,&#160;<i>y</i>,&#160;<i>π</i>,&#160;<i>d</i>,&#160;<i>d</i>)&#160;that&#160;outputs<br/>
chines,&#160;the&#160;veriﬁer’s&#160;cost&#160;to&#160;receive&#160;and&#160;verify&#160;state&#160;changes<br/>
<i>b&#160;∈&#160;{</i>0,&#160;1<i>}</i>;&#160;if&#160;<i>b&#160;</i>=&#160;1,&#160;<i>V&#160;</i>sets&#160;<i>d&#160;←&#160;d</i>,&#160;else&#160;it&#160;aborts.<br/>
is&#160;proportional&#160;to&#160;the&#160;size&#160;of&#160;the&#160;entire&#160;state&#160;of&#160;the&#160;prover,<br/>making&#160;the&#160;whole&#160;approach&#160;infeasible.&#160;Piperine&#160;addresses<br/>
A&#160;veriﬁable&#160;state&#160;machine&#160;is&#160;a&#160;succinct&#160;non-interactive&#160;argu-<br/>
this&#160;with&#160;new&#160;techniques.&#160;Speciﬁcally,&#160;we&#160;observe&#160;that&#160;the<br/>
ment&#160;of&#160;knowledge&#160;[21,&#160;45]&#160;for&#160;the&#160;language&#160;of&#160;state&#160;machine<br/>
veriﬁer&#160;can&#160;verify&#160;purported&#160;state&#160;changes&#160;during&#160;an&#160;<i>epoch&#160;</i>(a<br/>
transitions.&#160;Informally,&#160;it&#160;offers&#160;the&#160;following&#160;guarantees&#160;un-<br/>
time&#160;period&#160;where&#160;a&#160;prover&#160;executes&#160;a&#160;batch&#160;of&#160;transactions)<br/>
der&#160;a&#160;set&#160;of&#160;cryptographic&#160;hardness&#160;assumptions.<br/>
as&#160;long&#160;as&#160;it&#160;retains&#160;the&#160;digest&#160;of&#160;the&#160;prover’s&#160;state&#160;both&#160;at&#160;the<br/>
•&#160;Completeness.&#160;If&#160;<i>y&#160;</i>is&#160;the&#160;correct&#160;output&#160;of&#160;transitioning<br/>
beginning&#160;and&#160;the&#160;end&#160;of&#160;an&#160;epoch.&#160;The&#160;computational&#160;cost<br/>
<i>M&#160;</i>with&#160;input&#160;<i>x</i>,&#160;some&#160;non-deterministic&#160;choices&#160;<i>w</i>,&#160;and&#160;<i>d</i><br/>
of&#160;this&#160;process&#160;to&#160;the&#160;veriﬁer&#160;is&#160;proportional&#160;to&#160;the&#160;number&#160;of<br/>
is&#160;the&#160;correct&#160;digest&#160;of&#160;the&#160;updated&#160;state,&#160;<i>P&#160;</i>can&#160;produce&#160;a<br/>
state&#160;changes&#160;within&#160;the&#160;epoch,&#160;which&#160;is&#160;theoretically&#160;optimal.<br/>
tuple&#160;(<i>x</i>,&#160;<i>y</i>,&#160;<i>π</i>,&#160;<i>d</i>)&#160;such&#160;that&#160;<i>V&#160;</i>updates&#160;its&#160;internal&#160;state&#160;to&#160;<i>d</i>.<br/>
Implementation&#160;and&#160;evaluation.&#160;We&#160;implement&#160;Piperine<br/>
•&#160;Knowledge&#160;soundness.&#160;If&#160;<i>P&#160;</i>produces&#160;a&#160;tuple&#160;(<i>x</i>,&#160;<i>y</i>,&#160;<i>π</i>,&#160;<i>d</i>)<br/>
atop&#160;Spice&#160;[73],&#160;inheriting&#160;an&#160;end-to-end&#160;compiler&#160;toolchain:<br/>
that&#160;makes&#160;<i>V&#160;</i>update&#160;its&#160;internal&#160;state&#160;from&#160;<i>d&#160;</i>to&#160;<i>d</i>,&#160;then<br/>
A&#160;programmer&#160;can&#160;express&#160;a&#160;state&#160;machine&#160;in&#160;a&#160;broad&#160;subset<br/>
there&#160;exists&#160;a&#160;PPT&#160;algorithm,&#160;called&#160;an&#160;extractor,&#160;that,&#160;with<br/>
of&#160;C&#160;and&#160;compile&#160;it&#160;into&#160;a&#160;prover&#160;and&#160;a&#160;veriﬁer,&#160;with&#160;the&#160;prover<br/>
oracle&#160;access&#160;to&#160;<i>P</i>,&#160;can&#160;output&#160;(<i>w</i>,&#160;<i>S</i>,&#160;<i>S</i>)&#160;such&#160;that&#160;(<i>y</i>,&#160;<i>S</i>)&#160;=<br/>
designed&#160;to&#160;run&#160;on&#160;a&#160;distributed&#160;cluster.&#160;We&#160;also&#160;extend&#160;the<br/>
Ψ(<i>x</i>,&#160;<i>w</i>,&#160;<i>S</i>)&#160;<i>∧&#160;H</i>(<i>S</i>)&#160;=&#160;<i>d&#160;∧&#160;H</i>(<i>S</i>)&#160;=&#160;<i>d</i>.<br/>
compiler&#160;toolchain&#160;to&#160;produce&#160;a&#160;veriﬁer&#160;in&#160;Solidity,&#160;a&#160;lan-<br/>guage&#160;for&#160;writing&#160;state&#160;machines&#160;that&#160;run&#160;on&#160;Ethereum.&#160;Using<br/>
•&#160;Efﬁciency.&#160;The&#160;CPU&#160;cost&#160;of&#160;verifying&#160;<i>π&#160;</i>is&#160;lower&#160;than&#160;the<br/>
the&#160;toolchain,&#160;we&#160;implement&#160;a&#160;blockchain-based&#160;payment&#160;ser-<br/>
cost&#160;of&#160;executing&#160;<i>M</i>’s&#160;state&#160;transitions.<br/>
vice&#160;with&#160;a&#160;standardized&#160;interface&#160;[79].&#160;We&#160;then&#160;evaluate&#160;this<br/>
APIs&#160;and&#160;programming&#160;model.&#160;In&#160;Spice&#160;[73],&#160;Ψ&#160;is&#160;ex-<br/>
artifact&#160;using&#160;workloads&#160;modeled&#160;after&#160;real-world&#160;traces.&#160;We<br/>
pressed&#160;in&#160;a&#160;broad&#160;subset&#160;of&#160;C,&#160;which&#160;includes&#160;functions,<br/>
ﬁnd&#160;that&#160;Piperine&#160;reduces&#160;end-to-end&#160;costs&#160;of&#160;a&#160;transaction&#160;by<br/>
structs,&#160;typedefs,&#160;preprocessor&#160;macros,&#160;if-else&#160;statements,<br/>
5.4<i>×&#160;</i>and&#160;network&#160;costs&#160;by&#160;2.7<i>×&#160;</i>(§6.3).&#160;Whilst&#160;Piperine&#160;does<br/>
loops&#160;(with&#160;static&#160;bounds),&#160;explicit&#160;type&#160;conversions,&#160;and<br/>
not&#160;directly&#160;reduce&#160;mining&#160;costs&#160;of&#160;Ethereum,&#160;Piperine&#160;exe-<br/>
standard&#160;integer&#160;and&#160;bitwise&#160;operations.&#160;For&#160;Ψ&#160;to&#160;interact<br/>
cutes&#160;more&#160;transactions&#160;per&#160;block,&#160;and&#160;so&#160;effectively&#160;reduces<br/>
with&#160;persistent&#160;storage,&#160;Spice&#160;offers:&#160;(1)&#160;a&#160;block&#160;store&#160;with<br/>
per-transaction&#160;mining&#160;(and&#160;associated&#160;energy)&#160;costs.<br/>
GetBlock/PutBlock&#160;APIs;&#160;and&#160;(2)&#160;a&#160;key-value&#160;store&#160;with&#160;a<br/>
Finally,&#160;we&#160;believe&#160;this&#160;work&#160;represents&#160;the&#160;ﬁrst&#160;large-scale<br/>
standard&#160;get/put&#160;interface&#160;and&#160;concurrency&#160;control&#160;primi-<br/>
application&#160;of&#160;cryptographic&#160;proof&#160;machinery,&#160;and,&#160;to&#160;the<br/>
tives&#160;(e.g.,&#160;lock/unlock)&#160;and&#160;simple&#160;transactions.<br/>
The&#160;prover&#160;runs&#160;multiple&#160;instances&#160;of&#160;Ψ&#160;in&#160;different&#160;threads.<br/>
1Such&#160;optimizations&#160;are&#160;widely&#160;used&#160;for&#160;code&#160;running&#160;on&#160;standard&#160;hardware,<br/>
but&#160;it&#160;is&#160;non-trivial&#160;to&#160;realize&#160;them&#160;in&#160;the&#160;computational&#160;model&#160;of&#160;the&#160;proof<br/>
Each&#160;thread&#160;processes&#160;distinct&#160;transactions&#160;and&#160;the&#160;shared<br/>
machinery,&#160;which&#160;is&#160;clumsy&#160;from&#160;a&#160;programmability&#160;perspective.<br/>
state&#160;is&#160;stored&#160;in&#160;a&#160;logically&#160;centralized&#160;key-value&#160;store.&#160;In<br/>
<hr/>
<a name=3></a>this&#160;context,&#160;Spice&#160;[73]&#160;guarantees&#160;sequential&#160;consistency&#160;[54]<br/>
equations&#160;that&#160;check&#160;if&#160;the&#160;hash&#160;of&#160;the&#160;supplied&#160;block&#160;equals<br/>
for&#160;single-object&#160;operations&#160;(where&#160;an&#160;object&#160;is&#160;a&#160;key-value<br/>
the&#160;input&#160;digest&#160;(this&#160;requires&#160;representing&#160;a&#160;hash&#160;function&#160;as&#160;a<br/>
pair)&#160;and&#160;serializability&#160;[20,&#160;66]&#160;for&#160;multi-object&#160;transactions.<br/>
set&#160;of&#160;constraints).&#160;PutBlock&#160;translates&#160;to&#160;a&#160;similar&#160;set&#160;of&#160;con-<br/>
Mechanics.&#160;Spice&#160;[73]&#160;and&#160;its&#160;predecessors&#160;[15,&#160;18,&#160;24,&#160;35,<br/>
straints.&#160;Since&#160;the&#160;veriﬁer&#160;supplies&#160;digests,&#160;unless&#160;the&#160;prover<br/>
67,&#160;74–76,&#160;81,&#160;89]&#160;proceed&#160;in&#160;two&#160;steps.&#160;First,&#160;they&#160;reduce&#160;the<br/>
identiﬁes&#160;a&#160;hash&#160;collision&#160;(which&#160;is&#160;infeasible),&#160;the&#160;prover&#160;is<br/>
task&#160;of&#160;proving&#160;the&#160;correct&#160;execution&#160;of&#160;a&#160;state&#160;machine&#160;to&#160;the<br/>
compelled&#160;to&#160;supply&#160;the&#160;correct&#160;block&#160;to&#160;each&#160;GetBlock&#160;and<br/>
task&#160;of&#160;proving&#160;the&#160;satisﬁability&#160;of&#160;a&#160;set&#160;of&#160;equations.&#160;Second,<br/>
supply&#160;the&#160;correct&#160;digest&#160;as&#160;the&#160;response&#160;to&#160;each&#160;PutBlock.<br/>
the&#160;prover&#160;employs&#160;a&#160;cryptographic&#160;machinery&#160;to&#160;prove&#160;the<br/>
Key-value&#160;store.&#160;Spice&#160;supports&#160;a&#160;key-value&#160;store&#160;using<br/>
satisﬁability&#160;of&#160;the&#160;set&#160;of&#160;equations—by&#160;producing&#160;a&#160;proof.<br/>
a&#160;particular&#160;type&#160;of&#160;hash&#160;function&#160;<i>H</i>(<i>·</i>)&#160;that&#160;operates&#160;on&#160;sets<br/>
The&#160;latter&#160;ensures&#160;that&#160;the&#160;veriﬁer&#160;is&#160;more&#160;resource-efﬁcient<br/>
and&#160;is&#160;incremental&#160;[10,&#160;11,&#160;32]:&#160;given&#160;a&#160;<i>set-digest&#160;dS&#160;</i>for&#160;a&#160;set<br/>
than&#160;reexecuting&#160;state&#160;transitions.<br/>
<i>S</i>,&#160;and&#160;a&#160;set&#160;<i>W</i>,&#160;one&#160;can&#160;efﬁciently&#160;compute&#160;a&#160;set-digest&#160;for<br/>
(1)&#160;Program&#160;executions&#160;to&#160;constraints.&#160;Spice’s&#160;compiler<br/>
<i>S∪W</i>.&#160;Speciﬁcally,&#160;there&#160;is&#160;a&#160;constant&#160;time&#160;operation&#160;<i>⊕&#160;</i>where:<br/>
<i>H</i>(<br/>
transforms&#160;Ψ&#160;to&#160;<i>algebraic&#160;constraints</i>,&#160;a&#160;model&#160;of&#160;computa-<br/>
<i>S&#160;∪&#160;W</i>)&#160;=&#160;<i>H</i>(<i>S</i>)&#160;<i>⊕&#160;H</i>(<i>W</i>)&#160;=&#160;<i>dS&#160;⊕&#160;H</i>(<i>W</i>).&#160;In&#160;more&#160;detail,<br/>
tion&#160;where&#160;a&#160;program&#160;is&#160;represented&#160;as&#160;a&#160;system&#160;of&#160;equations<br/>
a&#160;key-value&#160;store&#160;is&#160;encoded&#160;using&#160;two&#160;sets:&#160;a&#160;read-set&#160;<i>RS</i><br/>
and&#160;variables&#160;take&#160;values&#160;from&#160;a&#160;ﬁnite&#160;ﬁeld&#160;F<br/>
and&#160;a&#160;write-set&#160;<i>WS</i>.&#160;These&#160;sets&#160;contain&#160;(<i>key</i>,&#160;<i>value</i>,&#160;<i>timestamp</i>)<br/>
<i>p&#160;</i>for&#160;a&#160;large<br/>
prime&#160;<i>p</i>.&#160;The&#160;compiler&#160;operates&#160;line-by-line&#160;over&#160;Ψ:&#160;loops&#160;are<br/>
tuples&#160;for&#160;every&#160;operation&#160;on&#160;the&#160;store.&#160;Neither&#160;the&#160;prover&#160;nor<br/>
unrolled&#160;and&#160;then&#160;each&#160;program&#160;statement&#160;is&#160;compiled&#160;to&#160;one<br/>
the&#160;veriﬁer&#160;materializes&#160;these&#160;sets&#160;in&#160;full;&#160;they&#160;only&#160;operate<br/>
(or&#160;more)&#160;equations.&#160;The&#160;compiler&#160;ensures&#160;the&#160;following&#160;prop-<br/>
on&#160;them&#160;using&#160;the&#160;corresponding&#160;digest&#160;(which&#160;we&#160;illustrate<br/>
erty:&#160;the&#160;set&#160;of&#160;equations&#160;is&#160;<i>satisﬁable</i>—there&#160;exists&#160;a&#160;solution<br/>
below).&#160;Thus,&#160;the&#160;veriﬁer’s&#160;digest&#160;of&#160;the&#160;key-value&#160;store&#160;is:<br/>
(a&#160;setting&#160;of&#160;values&#160;to&#160;variables)&#160;to&#160;constraints—<i>if&#160;and&#160;only</i><br/>
struct&#160;KVDigest&#160;{<br/>
<i>if&#160;</i>the&#160;output&#160;is&#160;correct.&#160;To&#160;illustrate,&#160;consider&#160;a&#160;toy&#160;computa-<br/>
SetDigest&#160;rs;&#160;//&#160;a&#160;set-digest&#160;of&#160;RS<br/>SetDigest&#160;ws;&#160;//&#160;a&#160;set-digest&#160;of&#160;WS<br/>
tion&#160;and&#160;its&#160;equivalent&#160;constraints&#160;(uppercase&#160;letters&#160;denote<br/>
}<br/>
variables&#160;and&#160;lowercase&#160;letters&#160;denote&#160;concrete&#160;values):<br/>
<i>Example.&#160;</i>If&#160;the&#160;key-value&#160;store&#160;is&#160;empty,&#160;<i>rs&#160;</i>=&#160;<i>ws&#160;</i>=&#160;<i>H</i>(<i>{}</i>).<br/>
int&#160;incr(int&#160;x)&#160;{<br/>
⎧<br/>
⎫<br/>
⎨<br/>
<i>X&#160;−&#160;x</i><br/>
=&#160;0&#160;⎬<br/>
int&#160;y&#160;=&#160;x&#160;+&#160;1;<br/>
Suppose&#160;the&#160;prover&#160;executes&#160;a&#160;program&#160;Ψ&#160;that&#160;invokes<br/>
<i>C&#160;</i>=<br/>
<i>Y&#160;−&#160;</i>(<i>X&#160;</i>+&#160;1)<br/>
=&#160;0<br/>
return&#160;y;<br/>
⎩<br/>
⎭<br/>
insert(<i>k</i>,&#160;<i>v</i>),&#160;it&#160;is&#160;forced&#160;to&#160;return&#160;an&#160;updated&#160;KVDigest&#160;such<br/>
<i>Y&#160;−&#160;y</i><br/>
=&#160;0<br/>
}<br/>
that&#160;the&#160;following&#160;holds&#160;(this&#160;is&#160;done&#160;by&#160;translating&#160;insert<br/>
For&#160;the&#160;above&#160;constraints,&#160;if&#160;<i>y&#160;</i>=&#160;<i>x&#160;</i>+&#160;1,&#160;<i>{X&#160;←&#160;x</i>,&#160;<i>Y&#160;←&#160;y}</i><br/>
into&#160;appropriate&#160;constraints,&#160;as&#160;in&#160;the&#160;GetBlock&#160;example):<br/>
is&#160;a&#160;solution.&#160;If&#160;<i>y&#160;</i>=&#160;<i>x&#160;</i>+&#160;1,&#160;then&#160;there&#160;is&#160;no&#160;solution&#160;and&#160;the<br/>
<i>rs&#160;</i>=&#160;<i>H</i>(<i>{}</i>),&#160;<i>ws&#160;</i>=&#160;<i>H</i>(<i>{</i>(<i>k</i>,&#160;<i>v</i>,&#160;1)<i>}</i>).<br/>
constraint&#160;set&#160;is&#160;not&#160;satisﬁable.<br/>
Now,&#160;suppose&#160;the&#160;prover&#160;executes&#160;Ψ<i>&#160;</i>that&#160;invokes&#160;get(<i>k</i>),<br/>
(2)&#160;Proving&#160;the&#160;satisﬁability&#160;of&#160;constraints&#160;succinctly.<br/>
which&#160;should&#160;return&#160;a&#160;value&#160;<i>v&#160;</i>and&#160;update&#160;the&#160;timestamp&#160;associ-<br/>
The&#160;prover&#160;identiﬁes&#160;a&#160;solution&#160;to&#160;the&#160;equations&#160;using&#160;input<br/>
ated&#160;of&#160;the&#160;tuple.&#160;To&#160;explain&#160;how&#160;KVDigest&#160;is&#160;updated,&#160;there<br/>
<i>x</i>.&#160;Since&#160;the&#160;veriﬁer&#160;must&#160;be&#160;able&#160;to&#160;check&#160;this&#160;solution&#160;in<br/>
are&#160;two&#160;cases&#160;to&#160;consider.&#160;First,&#160;suppose&#160;the&#160;prover&#160;behaves<br/>
time&#160;sublinear&#160;in&#160;the&#160;running&#160;time&#160;of&#160;the&#160;computation,&#160;the<br/>
and&#160;returns&#160;<i>v&#160;</i>that&#160;was&#160;previously&#160;stored&#160;by&#160;insert(<i>k</i>,&#160;<i>v</i>),<br/>
prover&#160;cannot&#160;simply&#160;send&#160;its&#160;solution&#160;to&#160;the&#160;veriﬁer.&#160;Instead,<br/>
then:&#160;<i>rs&#160;</i>=&#160;<i>H</i>(<i>{</i>(<i>k</i>,&#160;<i>v</i>,&#160;1)<i>}</i>),&#160;<i>ws&#160;</i>=&#160;<i>H</i>(<i>{</i>(<i>k</i>,&#160;<i>v</i>,&#160;1),&#160;(<i>k</i>,&#160;<i>v</i>,&#160;2)<i>}</i>).<br/>
Spice&#160;employs&#160;cryptographic&#160;machinery&#160;(called&#160;an&#160;<i>argument</i><br/>
A&#160;key&#160;invariant&#160;here&#160;is&#160;that&#160;whenever&#160;the&#160;prover&#160;maintains<br/>
<i>protocol</i>)&#160;to&#160;encode&#160;the&#160;prover’s&#160;solution&#160;as&#160;a&#160;succinct&#160;proof<br/>
the&#160;key-value&#160;store&#160;correctly,&#160;the&#160;set&#160;underneath&#160;<i>rs&#160;</i>is&#160;a&#160;subset<br/>
<i>π</i><br/>
of&#160;the&#160;set&#160;underneath&#160;<i>ws</i>.&#160;To&#160;illustrate&#160;the&#160;invariant&#160;further,<br/>
<i>x</i>.&#160;This&#160;machinery&#160;is&#160;detailed&#160;at&#160;length&#160;elsewhere&#160;[15,&#160;18,<br/>
24,&#160;47,&#160;67,&#160;81,&#160;83].&#160;We&#160;now&#160;focus&#160;on&#160;details&#160;relevant&#160;for&#160;this<br/>
consider&#160;the&#160;second&#160;case&#160;where&#160;the&#160;prover&#160;returns&#160;<i>v&#160;</i>=&#160;<i>v&#160;</i>(for<br/>
work:&#160;how&#160;does&#160;Spice&#160;encode&#160;state&#160;in&#160;constraints?<br/>
get(<i>k</i>)),&#160;then&#160;the&#160;set-digests&#160;returned&#160;by&#160;the&#160;prover&#160;will&#160;be:<br/><i>rs&#160;</i>=&#160;<i>H</i>(<i>{</i>(<i>k</i>,&#160;<i>v</i>,&#160;1)<i>}</i>),&#160;<i>ws&#160;</i>=&#160;<i>H</i>(<i>{</i>(<i>k</i>,&#160;<i>v</i>,&#160;1),&#160;(<i>k</i>,&#160;<i>v</i>,&#160;2)<i>}</i>).<br/>
Supporting&#160;state&#160;in&#160;the&#160;constraints&#160;formalism.&#160;We&#160;begin<br/>
Observe&#160;that&#160;the&#160;set&#160;underneath&#160;<i>rs&#160;</i>is&#160;not&#160;a&#160;subset&#160;of&#160;the<br/>
with&#160;Spice’s&#160;block&#160;store,&#160;which&#160;it&#160;inherits&#160;from&#160;Pantry&#160;[24].<br/>
set&#160;underneath&#160;<i>ws</i>.&#160;However,&#160;the&#160;veriﬁer&#160;cannot&#160;not&#160;detect<br/>
Consider&#160;the&#160;following&#160;program&#160;that&#160;takes&#160;as&#160;input&#160;a&#160;<i>digest</i><br/>
this&#160;(since&#160;set-digests&#160;have&#160;no&#160;structure&#160;to&#160;check&#160;the&#160;subset<br/>
(e.g.,&#160;a&#160;SHA-256&#160;hash)&#160;and&#160;accesses&#160;the&#160;prover’s&#160;block&#160;store<br/>
property).&#160;Instead,&#160;the&#160;veriﬁer&#160;requires&#160;the&#160;prover&#160;to&#160;produce&#160;a<br/>
using&#160;GetBlock/PutBlock&#160;APIs:<br/>
special&#160;proof&#160;<i>πaudit&#160;</i>periodically&#160;(e.g.,&#160;for&#160;a&#160;sequence&#160;of&#160;inputs<br/>
Digest&#160;increment(Digest&#160;d)&#160;{<br/>
<i>x</i>1,&#160;<i>.&#160;.&#160;.&#160;xn</i>)&#160;that&#160;proves&#160;the&#160;set&#160;underneath&#160;<i>rs&#160;</i>is&#160;a&#160;subset&#160;of&#160;the<br/>
//&#160;produces&#160;equations&#160;that&#160;check&#160;d==Hash(block)<br/>
set&#160;underneath&#160;<i>ws</i>.&#160;To&#160;do&#160;so,&#160;the&#160;prover’s&#160;<i>πaudit&#160;</i>proves:<br/>
int&#160;block&#160;=&#160;GetBlock(d);<br/>int&#160;block’&#160;=&#160;block&#160;+&#160;1;<br/>
<i>∃{</i>(<i>ki</i>,&#160;<i>vi</i>,&#160;<i>tsi</i>)<i>}&#160;</i>:&#160;<i>ws&#160;&#160;&#160;rs&#160;</i>=&#160;<i>H</i>(<i>{</i>(<i>ki</i>,&#160;<i>vi</i>,&#160;<i>tsi</i>)<i>}</i>)&#160;<i>∧&#160;∀i</i>,&#160;<i>ki&#160;&lt;&#160;ki</i>+1,<br/>
//&#160;produces&#160;equations&#160;that&#160;check&#160;d’==Hash(block’)<br/>Digest&#160;d’&#160;=&#160;PutBlock(block’);<br/>
where&#160;<i>&#160;&#160;</i>is&#160;the&#160;inverse&#160;of&#160;<i>⊕&#160;</i>(i.e.,&#160;it&#160;results&#160;in&#160;removal&#160;of<br/>
return&#160;d’;<br/>
elements&#160;from&#160;a&#160;set&#160;underneath&#160;the&#160;digest).&#160;This&#160;difference&#160;is<br/>
}<br/>
a&#160;set&#160;as&#160;the&#160;<i>ki&#160;</i>are&#160;distinct.&#160;An&#160;honest&#160;prover&#160;takes&#160;<i>{</i>(<i>ki</i>,&#160;<i>vi</i>,&#160;<i>tsi</i>)<i>}</i><br/>
Spice’s&#160;compiler&#160;translates&#160;each&#160;GetBlock&#160;call&#160;to&#160;a&#160;set&#160;of<br/>
to&#160;be&#160;all&#160;key-value-timestamp&#160;tuples&#160;in&#160;its&#160;current&#160;state.<br/>
<hr/>
<a name=4></a>To&#160;produce&#160;<i>πaudit</i>,&#160;the&#160;prover&#160;incurs&#160;costs&#160;linear&#160;in&#160;the&#160;num-<br/>
(Ψ,&#160;<i>S</i>0),&#160;where&#160;Ψ&#160;is&#160;a&#160;program&#160;that&#160;encodes&#160;state&#160;machine<br/>
ber&#160;of&#160;key-value&#160;tuples,&#160;but&#160;the&#160;linear&#160;cost&#160;is&#160;amortized&#160;over<br/>
transitions&#160;and&#160;<i>S</i>0&#160;is&#160;the&#160;initial&#160;state&#160;of&#160;the&#160;machine.&#160;When<br/>
all&#160;transactions&#160;processed&#160;within&#160;the&#160;epoch,&#160;and&#160;the&#160;proof&#160;pro-<br/>
<i>P&#160;</i>is&#160;given&#160;a&#160;state&#160;<i>S&#160;</i>of&#160;<i>S&#160;</i>and&#160;a&#160;transaction&#160;<i>x&#160;</i>(<i>S&#160;</i>=&#160;<i>S</i>0&#160;at<br/>
duced&#160;by&#160;the&#160;prover&#160;is&#160;<i>π&#160;</i>=&#160;(<i>πx&#160;</i>,&#160;<i>.&#160;.&#160;.&#160;</i>,&#160;<i>π&#160;</i>,&#160;<i>π</i><br/>
beginning&#160;of&#160;time),&#160;it&#160;produces:<br/>
1<br/>
<i>xn</i><br/>
<i>audit</i>).&#160;Finally,&#160;as<br/>
an&#160;optimization&#160;atop&#160;Spice&#160;[73],&#160;we&#160;observe&#160;that&#160;the&#160;veriﬁer<br/>
•&#160;The&#160;output&#160;<i>y</i>,&#160;a&#160;digest&#160;<i>d&#160;</i>of&#160;the&#160;new&#160;state&#160;<i>S</i>,&#160;and&#160;a&#160;proof<br/>
only&#160;needs&#160;to&#160;track&#160;a&#160;single&#160;set-digest&#160;<i>d&#160;</i>=&#160;<i>ws&#160;&#160;&#160;rs</i>.<br/>
<i>π&#160;</i>=&#160;(<i>πx</i>,&#160;<i>πaudit</i>).<br/>
3<br/>
Design<br/>
•&#160;A&#160;succinct&#160;representation&#160;Δ&#160;of&#160;the&#160;difference&#160;between&#160;<i>S</i><br/>
and&#160;<i>S</i>,&#160;and&#160;a&#160;proof&#160;<i>π</i><br/>
This&#160;section&#160;describes&#160;the&#160;design&#160;of&#160;Piperine.&#160;We&#160;begin&#160;with<br/>
Δ&#160;that&#160;this&#160;difference&#160;is&#160;consistent<br/>
with&#160;the&#160;old&#160;and&#160;new&#160;digests&#160;<i>d</i>,&#160;<i>d</i>.<br/>
an&#160;overview&#160;of&#160;Piperine&#160;and&#160;then&#160;delve&#160;into&#160;its&#160;details.<br/>
For&#160;efﬁciency,&#160;<i>π</i><br/>
Overview&#160;of&#160;Piperine.&#160;Piperine&#160;provides&#160;a&#160;generic&#160;mecha-<br/>
<i>audit&#160;</i>and&#160;<i>π</i>Δ&#160;are&#160;produced&#160;by&#160;the&#160;prover<br/>
after&#160;processing&#160;a&#160;batch&#160;of&#160;transactions.&#160;For&#160;ease&#160;of&#160;exposition,<br/>
nism&#160;to&#160;transform&#160;a&#160;replicated&#160;state&#160;machine&#160;(RSM)&#160;<i>R&#160;</i>into<br/>
we&#160;include&#160;it&#160;with&#160;every&#160;transaction&#160;<i>x&#160;</i>(we&#160;relax&#160;this&#160;in&#160;(§3.3)).<br/>
another&#160;RSM&#160;<i>R</i>—while&#160;retaining&#160;the&#160;safety&#160;and&#160;liveness<br/>
<i>V&#160;</i>begins&#160;with&#160;a&#160;copy&#160;of&#160;<i>S&#160;</i>as&#160;well&#160;as&#160;its&#160;digest&#160;<i>d</i>.&#160;When&#160;<i>V</i><br/>
properties&#160;of&#160;<i>R</i>.&#160;To&#160;explain&#160;how&#160;Piperine&#160;realizes&#160;this&#160;trans-<br/>
is&#160;given&#160;as&#160;input&#160;a&#160;tuple&#160;(<i>x</i>,&#160;<i>y</i>,&#160;<i>d</i>,&#160;<i>π</i>,&#160;Δ,&#160;<i>π</i><br/>
formation,&#160;we&#160;start&#160;with&#160;a&#160;brief&#160;review&#160;of&#160;RSMs.&#160;Recall&#160;that<br/>
Δ)&#160;produced&#160;by&#160;the<br/>
prover,&#160;it&#160;runs&#160;the&#160;local&#160;checks&#160;of&#160;Section&#160;2,&#160;and&#160;in&#160;addition<br/>
an&#160;RSM&#160;is&#160;a&#160;methodology&#160;to&#160;transform&#160;a&#160;state&#160;machine&#160;<i>M</i><br/>
checks&#160;that&#160;<i>π</i><br/>
into&#160;a&#160;distributed&#160;computation&#160;running&#160;on&#160;a&#160;set&#160;of&#160;nodes&#160;such<br/>
Δ&#160;proves&#160;that&#160;Δ&#160;represents&#160;the&#160;correct&#160;difference<br/>
between&#160;states&#160;whose&#160;digests&#160;match&#160;<i>d</i>,&#160;<i>d</i>.&#160;If&#160;these&#160;checks&#160;pass,<br/>
that&#160;the&#160;distributed&#160;computation&#160;emulates&#160;a&#160;safe&#160;and&#160;live&#160;<i>S</i><br/>
<i>V&#160;</i>applies&#160;Δ&#160;to&#160;<i>S&#160;</i>to&#160;obtain&#160;<i>S</i>.<br/>
(under&#160;certain&#160;operating&#160;conditions&#160;about&#160;nodes,&#160;such&#160;as&#160;fault<br/>
thresholds,&#160;and&#160;the&#160;network&#160;connecting&#160;them).<br/>
Safety&#160;and&#160;liveness&#160;intuition.&#160;The&#160;veriﬁer’s&#160;initial&#160;state&#160;is<br/>
In&#160;the&#160;context&#160;of&#160;an&#160;RSM,&#160;the&#160;safety&#160;property&#160;is&#160;that&#160;non-<br/>
the&#160;initial&#160;state&#160;of&#160;the&#160;state&#160;machine&#160;<i>S</i>0&#160;and&#160;a&#160;digest&#160;of<br/>
faulty&#160;nodes&#160;progress&#160;through&#160;the&#160;same&#160;sequence&#160;of&#160;state<br/>
that&#160;state&#160;<i>d</i>.&#160;Since&#160;Piperine&#160;runs&#160;<i>V&#160;</i>as&#160;a&#160;state&#160;machine&#160;that<br/>
transitions;&#160;the&#160;liveness&#160;property&#160;is&#160;that&#160;non-faulty&#160;nodes&#160;can<br/>
is&#160;replicated&#160;by&#160;RSM&#160;<i>R&#160;</i>and&#160;since&#160;<i>R&#160;</i>is&#160;safe,&#160;the&#160;veriﬁer<br/>
eventually&#160;execute&#160;a&#160;state&#160;transition&#160;[55].&#160;An&#160;RSM&#160;can&#160;have<br/>
running&#160;at&#160;each&#160;node&#160;will&#160;only&#160;transition&#160;to&#160;a&#160;new&#160;state&#160;if<br/>
one&#160;or&#160;more&#160;safety&#160;and&#160;liveness&#160;properties&#160;and&#160;Piperine&#160;is<br/>
(<i>x</i>,&#160;<i>y</i>,&#160;<i>d</i>,&#160;<i>π</i>,&#160;Δ,&#160;<i>π</i>Δ)&#160;pass&#160;the&#160;veriﬁer’s&#160;local&#160;checks.&#160;From&#160;the<br/>
oblivious&#160;to&#160;the&#160;speciﬁc&#160;properties&#160;(in&#160;other&#160;words,&#160;Piperine<br/>
completeness&#160;and&#160;soundness&#160;properties&#160;of&#160;the&#160;underlying&#160;ver-<br/>
simply&#160;preserves&#160;the&#160;safety&#160;and&#160;liveness&#160;properties&#160;of&#160;the<br/>
iﬁable&#160;state&#160;machine,&#160;this&#160;happens&#160;only&#160;if&#160;<i>y&#160;</i>is&#160;a&#160;correct&#160;output<br/>
underlying&#160;RSM&#160;<i>R&#160;</i>in&#160;the&#160;transformed&#160;RSM&#160;<i>R</i>).<br/>
for&#160;the&#160;transaction&#160;<i>x&#160;</i>and&#160;<i>d&#160;</i>is&#160;the&#160;digest&#160;of&#160;the&#160;state&#160;after<br/>
<i>Constructing&#160;R.&#160;</i>To&#160;construct&#160;<i>R&#160;</i>for&#160;a&#160;given&#160;<i>R&#160;</i>that&#160;repli-<br/>
executing&#160;<i>x</i>.&#160;Furthermore,&#160;the&#160;veriﬁer&#160;running&#160;at&#160;each&#160;node<br/>
cates&#160;a&#160;state&#160;machine&#160;<i>M</i>,&#160;the&#160;high&#160;level&#160;recipe&#160;is&#160;as&#160;follows.<br/>
obtains&#160;a&#160;correct&#160;copy&#160;of&#160;the&#160;updated&#160;state&#160;using&#160;Δ.&#160;Thus,&#160;<i>R</i><br/>
First,&#160;Piperine&#160;splits&#160;<i>M&#160;</i>into&#160;a&#160;preprocessing&#160;phase&#160;and&#160;a&#160;state<br/>
is&#160;both&#160;safe&#160;and&#160;live&#160;as&#160;long&#160;as&#160;<i>R&#160;</i>is&#160;safe&#160;and&#160;live.&#160;The&#160;only&#160;ad-<br/>
machine:&#160;the&#160;<i>prover&#160;</i>and&#160;the&#160;<i>veriﬁer&#160;</i>respectively&#160;(by&#160;employ-<br/>
ditional&#160;assumption&#160;in&#160;<i>R&#160;</i>compared&#160;to&#160;<i>R&#160;</i>is&#160;the&#160;cryptographic<br/>
ing&#160;the&#160;veriﬁable&#160;state&#160;machine&#160;primitive&#160;from&#160;Section&#160;2).<br/>
hardness&#160;assumptions&#160;made&#160;by&#160;veriﬁable&#160;state&#160;machines.&#160;We<br/>
The&#160;prover&#160;processes&#160;inputs&#160;(i.e.,&#160;transactions)&#160;for&#160;<i>S&#160;</i>and<br/>
make&#160;this&#160;intuition&#160;more&#160;formal&#160;later&#160;(§3.3).<br/>
transforms&#160;them&#160;into&#160;inputs&#160;for&#160;the&#160;veriﬁer.&#160;The&#160;prover&#160;is&#160;fully<br/>
RSMs&#160;with&#160;an&#160;open&#160;membership&#160;model.&#160;In&#160;RSMs&#160;with<br/>
untrusted&#160;and&#160;maintains&#160;no&#160;private&#160;state,&#160;so&#160;the&#160;transactions<br/>
an&#160;open&#160;membership&#160;model&#160;such&#160;as&#160;blockchains,&#160;ensuring<br/>
can&#160;be&#160;processed&#160;by&#160;any&#160;party&#160;on&#160;any&#160;untrusted&#160;infrastructure.<br/>
liveness&#160;means&#160;that&#160;a&#160;new&#160;node&#160;joining&#160;the&#160;system&#160;must&#160;be<br/>
More&#160;concretely,&#160;a&#160;transaction&#160;can&#160;be&#160;processed&#160;by&#160;the&#160;client<br/>
able&#160;to&#160;start&#160;with&#160;the&#160;initial&#160;state&#160;<i>S</i>0&#160;and&#160;incrementally&#160;update<br/>
that&#160;creates&#160;it,&#160;the&#160;RSM&#160;node&#160;that&#160;ﬁrst&#160;receives&#160;it,&#160;or&#160;a&#160;third<br/>
it&#160;using&#160;publicly&#160;available&#160;sequence&#160;of&#160;transformed&#160;inputs<br/>
party;&#160;the&#160;choice&#160;is&#160;arbitrary&#160;and&#160;the&#160;choice&#160;can&#160;be&#160;made&#160;for<br/>
until&#160;it&#160;reaches&#160;the&#160;up-to-date&#160;state&#160;<i>S</i>.&#160;In&#160;other&#160;words,&#160;the<br/>
each&#160;transaction&#160;independently,&#160;so&#160;our&#160;transformation&#160;does<br/>
transformed&#160;inputs&#160;must&#160;be&#160;available&#160;to&#160;any&#160;new&#160;node&#160;as&#160;part<br/>
not&#160;incur&#160;any&#160;loss&#160;of&#160;decentralization.&#160;Such&#160;ﬂexibility&#160;exists<br/>
of&#160;the&#160;blockchain.&#160;We&#160;provide&#160;more&#160;details&#160;when&#160;we&#160;apply<br/>
because&#160;the&#160;prover&#160;in&#160;Piperine&#160;is&#160;untrusted,&#160;by&#160;design,&#160;not<br/>
Piperine&#160;to&#160;reduce&#160;per-transaction&#160;costs&#160;of&#160;Ethereum&#160;(§4).<br/>
only&#160;for&#160;safety&#160;but&#160;also&#160;for&#160;liveness.<br/>
Finally,&#160;nodes&#160;in&#160;the&#160;original&#160;RSM&#160;then&#160;replicate&#160;the<br/>
3.1<br/>
Ensuring&#160;liveness<br/>
veriﬁer—instead&#160;of&#160;<i>S</i>—using&#160;<i>R</i>.&#160;Thus,&#160;<i>R&#160;</i>is&#160;an&#160;RSM&#160;that<br/>
The&#160;usual&#160;way&#160;for&#160;nodes&#160;in&#160;RSMs&#160;to&#160;keep&#160;their&#160;state&#160;up-to-<br/>
replicates&#160;the&#160;veriﬁer&#160;and&#160;processes&#160;transformed&#160;inputs&#160;and<br/>
date&#160;is&#160;to&#160;reexecute&#160;transitions&#160;on&#160;all&#160;the&#160;submitted&#160;inputs<br/>
proofs&#160;from&#160;the&#160;prover.&#160;Below,&#160;we&#160;provide&#160;an&#160;overview&#160;of<br/>
that&#160;have&#160;been&#160;agreed&#160;upon&#160;by&#160;the&#160;replicated&#160;system.&#160;Because<br/>
mechanics&#160;behind&#160;this&#160;instantiation&#160;and&#160;then&#160;provide&#160;intuition<br/>
nodes&#160;in&#160;Piperine&#160;avoid&#160;such&#160;reexecution,&#160;the&#160;veriﬁer&#160;running<br/>
for&#160;why&#160;<i>R&#160;</i>inherits&#160;any&#160;safety&#160;and&#160;liveness&#160;properties&#160;of&#160;<i>R</i>.<br/>
at&#160;each&#160;node&#160;in&#160;the&#160;transformed&#160;RSM&#160;must&#160;be&#160;able&#160;to&#160;recover<br/>
Overview&#160;of&#160;mechanics.&#160;Figure&#160;1&#160;summarizes&#160;the&#160;prover<br/>
a&#160;correct&#160;state&#160;<i>S&#160;</i>with&#160;a&#160;digest&#160;<i>d&#160;</i>from&#160;<i>S&#160;</i>and&#160;Δ.&#160;Furthermore,<br/>
and&#160;the&#160;veriﬁer&#160;machinery&#160;that&#160;Piperine&#160;uses.<br/>
this&#160;must&#160;be&#160;efﬁcient&#160;both&#160;for&#160;<i>V&#160;</i>and&#160;<i>P</i>.&#160;As&#160;we&#160;illustrate&#160;via&#160;a<br/>
In&#160;Piperine’s&#160;context,&#160;a&#160;state&#160;machine&#160;<i>M&#160;</i>is&#160;speciﬁed&#160;with<br/>
series&#160;of&#160;straw-man&#160;solutions&#160;below,&#160;this&#160;is&#160;non-trivial&#160;due&#160;to<br/>
<hr/>
<a name=5></a>1:&#160;function&#160;delta(<i>d</i>,&#160;<i>d</i>,&#160;Δ)<br/>
state:<br/>
2:<br/>
<i>sum&#160;←&#160;H</i>(<i>{}</i>)<br/>
,&#160;<br/>
Ψ<br/>
get<br/>
3:<br/>
for&#160;(<i>k</i>,&#160;<i>v</i>Δ,&#160;<i>t</i>Δ)&#160;in&#160;Δ&#160;do<br/>
,&#160;,<br/>
,<br/>
4:<br/>
<i>exists</i>,&#160;<i>v</i><br/>
put<br/>
<i>δ</i>,&#160;<i>tδ&#160;←&#160;</i>RPC(GETOLDVALUE,&#160;<i>k</i>)<br/>
key-<br/>
5:<br/>
<i>sum&#160;←&#160;sum&#160;⊕&#160;H</i>(<i>{</i>(<i>k</i>,&#160;<i>v</i>Δ,&#160;<i>t</i>Δ)<i>}</i>)<br/>
value&#160;<br/>
Ψaudit<br/>
state&#160;′<br/>
6:<br/>
if&#160;<i>exists&#160;</i>then<br/>
Store<br/>
if&#160;&#160;,<br/>
,<br/>
7:<br/>
<i>sum&#160;←&#160;sum&#160;&#160;H</i>(<i>{</i>(<i>k</i>,&#160;<i>vδ</i>,&#160;<i>tδ</i>)<i>}</i>)<br/>
pass checks:<br/>
Δ,<br/>
ΨΔ<br/>
Δ<br/>
verify&#160;&#160;,<br/>
,&#160;Δ<br/>
←<br/>
+&#160;Δ<br/>
8:<br/>
assert(<i>sum&#160;</i>=&#160;<i>d&#160;&#160;d</i>)<br/>
consistent<br/>
←&#160;′<br/>
FIGURE&#160;2—The&#160;description&#160;of&#160;ΨΔ,&#160;a&#160;computation&#160;that&#160;the&#160;prover<br/>runs&#160;to&#160;prove&#160;that&#160;its&#160;purported&#160;state&#160;changes&#160;are&#160;correct.<br/>
FIGURE&#160;1—Overview&#160;of&#160;Piperine’s&#160;proof&#160;machinery;&#160;our&#160;extensions<br/>are&#160;depicted&#160;with&#160;dotted&#160;components.&#160;To&#160;apply&#160;this&#160;to&#160;RSMs,&#160;instead<br/>
possible.&#160;To&#160;explain&#160;how&#160;we&#160;make&#160;it&#160;efﬁcient&#160;for&#160;<i>P&#160;</i>to&#160;generate<br/>
of&#160;running&#160;a&#160;state&#160;machine,&#160;each&#160;node&#160;in&#160;an&#160;RSM&#160;runs&#160;the&#160;veriﬁer,<br/>
this&#160;proof,&#160;it&#160;is&#160;necessary&#160;to&#160;unpack&#160;the&#160;details&#160;of&#160;how&#160;a&#160;key-<br/>
which&#160;veriﬁes&#160;proofs&#160;and&#160;state&#160;changes&#160;produced&#160;by&#160;an&#160;untrusted<br/>
value&#160;store&#160;is&#160;supported&#160;in&#160;Spice&#160;[73].<br/>
prover&#160;who&#160;veriﬁably&#160;executes&#160;the&#160;designated&#160;state&#160;machine.<br/>
Details.&#160;Recall&#160;that&#160;Piperine’s&#160;base&#160;machinery&#160;employs<br/>
an&#160;incremental&#160;hash&#160;function&#160;<i>H</i>(<i>·</i>)&#160;for&#160;sets&#160;to&#160;implement&#160;a<br/>
the&#160;requirements&#160;on&#160;computational&#160;efﬁciency,&#160;bandwidth&#160;re-<br/>
key-value&#160;store&#160;<i>K</i>.&#160;Let&#160;<i>WS</i>,&#160;<i>RS&#160;</i>be&#160;the&#160;sets&#160;of&#160;all&#160;writes&#160;and<br/>
quirements,&#160;and&#160;a&#160;desire&#160;to&#160;execute&#160;transactions&#160;concurrently.<br/>
reads&#160;to&#160;<i>K&#160;</i>at&#160;the&#160;end&#160;of&#160;the&#160;last&#160;epoch&#160;(i.e.,&#160;at&#160;the&#160;time&#160;the&#160;last<br/>
Straw-man&#160;#1.&#160;The&#160;prover&#160;could&#160;set&#160;Δ&#160;=&#160;<i>S&#160;</i>and&#160;have&#160;<i>π</i>Δ<br/>
<i>πaudit&#160;</i>was&#160;produced&#160;and&#160;veriﬁed).&#160;Note&#160;that&#160;neither&#160;the&#160;prover<br/>
prove&#160;that&#160;<i>H</i>(Δ)&#160;=&#160;<i>d</i>.&#160;Collision&#160;resistance&#160;of&#160;<i>H&#160;</i>ensures<br/>
nor&#160;the&#160;veriﬁer&#160;explicitly&#160;materializes&#160;these&#160;sets.&#160;A&#160;correct<br/>
that&#160;<i>S&#160;</i>is&#160;correct&#160;if&#160;the&#160;digests&#160;match,&#160;and&#160;the&#160;proof&#160;shows<br/>
prover&#160;simply&#160;maintains&#160;<i>K</i>’s&#160;current&#160;state&#160;<i>S</i>,&#160;and&#160;the&#160;veriﬁer<br/>
that&#160;the&#160;digest&#160;is&#160;computed&#160;correctly.&#160;The&#160;veriﬁer&#160;running<br/>
maintains&#160;a&#160;single&#160;set-digest&#160;<i>d</i>.&#160;Furthermore,&#160;at&#160;the&#160;end&#160;of&#160;an<br/>
at&#160;each&#160;node&#160;performs&#160;checks&#160;as&#160;above,&#160;and&#160;if&#160;they&#160;pass,&#160;it<br/>
epoch,&#160;the&#160;invariant&#160;is&#160;that&#160;<i>S&#160;</i>=&#160;<i>WS&#160;−&#160;RS&#160;</i>and&#160;<i>H</i>(<i>S</i>)&#160;=&#160;<i>d</i>.<br/>
overwrites&#160;its&#160;local&#160;state&#160;with&#160;Δ.&#160;Unfortunately,&#160;this&#160;approach<br/>
Now,&#160;in&#160;the&#160;next&#160;epoch,&#160;when&#160;the&#160;prover&#160;executes&#160;a&#160;trans-<br/>
incurs&#160;unacceptable&#160;network&#160;and&#160;computational&#160;costs.&#160;Having<br/>
action&#160;<i>x</i>,&#160;it&#160;sends&#160;to&#160;the&#160;veriﬁer,&#160;as&#160;part&#160;of&#160;<i>πx</i>,&#160;the&#160;difference<br/>
Δ&#160;=&#160;<i>S&#160;</i>means&#160;that&#160;the&#160;prover&#160;would&#160;need&#160;to&#160;send&#160;its&#160;whole<br/>
<i>δx&#160;</i>=&#160;<i>H</i>(<i>WSx</i>)&#160;<i>−&#160;H</i>(<i>RSx</i>),&#160;where&#160;<i>WSx</i>,&#160;<i>RSx&#160;</i>are&#160;the&#160;set&#160;of&#160;writes<br/>
state&#160;over&#160;the&#160;network&#160;for&#160;each&#160;batch&#160;of&#160;state&#160;transitions,&#160;and<br/>
and&#160;reads&#160;required&#160;to&#160;execute&#160;<i>x</i>.&#160;From&#160;these,&#160;the&#160;veriﬁer&#160;com-<br/>
that&#160;the&#160;veriﬁer&#160;(running&#160;at&#160;each&#160;node&#160;in&#160;an&#160;RSM)&#160;would&#160;need<br/>
putes&#160;<i>d&#160;</i>=&#160;<i>H</i>(<i>WS</i>)&#160;<i>&#160;&#160;H</i>(<i>RS</i>)&#160;=&#160;<i>d&#160;⊕&#160;δx</i>,&#160;where&#160;<i>WS</i>,&#160;<i>RS&#160;</i>are<br/>
to&#160;incur&#160;costs&#160;linear&#160;in&#160;the&#160;size&#160;of&#160;<i>S</i>.<br/>
the&#160;sets&#160;of&#160;all&#160;writes&#160;and&#160;reads&#160;after&#160;executing&#160;<i>x</i>.<br/>
Straw-man&#160;#2.&#160;The&#160;prover&#160;could&#160;augment&#160;the&#160;proof&#160;<i>π</i><br/>
We&#160;now&#160;make&#160;a&#160;few&#160;new&#160;observations.&#160;If&#160;the&#160;veriﬁer&#160;tracks<br/>
<i>x&#160;</i>to<br/>
output&#160;the&#160;state&#160;changes&#160;(i.e.&#160;a&#160;list&#160;of&#160;updated&#160;key-value&#160;pairs)<br/>
both&#160;<i>d&#160;</i>and&#160;<i>d</i>,&#160;there&#160;are&#160;sets&#160;<i>S</i>,&#160;<i>S&#160;</i>such&#160;that&#160;<i>H</i>(<i>S</i>)&#160;=&#160;<i>d&#160;∧</i><br/>
caused&#160;by&#160;executing&#160;the&#160;transaction&#160;<i>x</i>.&#160;The&#160;veriﬁer&#160;could&#160;then<br/>
<i>H</i>(<i>S</i>)&#160;=&#160;<i>d</i>.&#160;Concretely,&#160;<i>S&#160;</i>=&#160;<i>WS&#160;−&#160;RS&#160;</i>and&#160;<i>S&#160;</i>=&#160;<i>WS&#160;−&#160;RS</i>.<br/>
apply&#160;those&#160;state&#160;changes.&#160;However,&#160;for&#160;efﬁciency,&#160;Piperine’s<br/>
Deﬁne&#160;the&#160;sets&#160;<i>A&#160;</i>=&#160;<i>S&#160;−&#160;S&#160;</i>and&#160;<i>B&#160;</i>=&#160;<i>S&#160;−&#160;S</i>,&#160;and&#160;observe&#160;that<br/>
base&#160;operates&#160;in&#160;a&#160;setting&#160;where&#160;it&#160;produces&#160;<i>π</i><br/>
<i>S&#160;−&#160;S&#160;</i>=&#160;<i>A&#160;−&#160;B</i>.&#160;Furthermore,&#160;observe&#160;that&#160;<i>A&#160;</i>is&#160;the&#160;minimal<br/>
<i>audit&#160;</i>after&#160;execut-<br/>
ing&#160;a&#160;set&#160;of&#160;transactions&#160;(§2).&#160;As&#160;a&#160;result,&#160;the&#160;prover&#160;does&#160;not<br/>
set&#160;of&#160;writes&#160;that&#160;must&#160;be&#160;applied&#160;to&#160;<i>S&#160;</i>to&#160;get&#160;<i>S</i>,&#160;and&#160;<i>B&#160;</i>is<br/>
materialize&#160;a&#160;concrete&#160;ordering&#160;of&#160;transactions,&#160;but&#160;merely<br/>
the&#160;set&#160;of&#160;stale&#160;writes&#160;that&#160;<i>A&#160;</i>overwrites.&#160;This&#160;opens&#160;up&#160;the<br/>
proves&#160;that&#160;one&#160;exists.&#160;So&#160;a&#160;malicious&#160;prover&#160;can&#160;violate&#160;safety<br/>
following&#160;solution&#160;for&#160;the&#160;veriﬁer&#160;to&#160;efﬁciently&#160;receive&#160;and<br/>
by&#160;providing&#160;a&#160;different&#160;ordering&#160;to&#160;the&#160;veriﬁer(s)&#160;than&#160;the<br/>
verify&#160;state&#160;changes&#160;from&#160;the&#160;prover.<br/>
one&#160;it&#160;used&#160;internally.&#160;A&#160;solution&#160;is&#160;to&#160;make&#160;the&#160;prover’s&#160;exe-<br/>
Piperine’s&#160;prover&#160;sets&#160;Δ&#160;=&#160;<i>A</i>,&#160;which&#160;is&#160;minimal&#160;(as&#160;noted<br/>
cution&#160;veriﬁably&#160;deterministic,&#160;but&#160;it&#160;is&#160;not&#160;entirely&#160;clear&#160;how<br/>
above).&#160;Furthermore,&#160;Piperine’s&#160;prover&#160;proves&#160;that&#160;<i>∃B</i>,&#160;a&#160;set<br/>
to&#160;achieve&#160;this—without&#160;incurring&#160;substantial&#160;costs.<br/>
writes&#160;to&#160;a&#160;subset&#160;of&#160;the&#160;state&#160;written&#160;to&#160;by&#160;<i>A&#160;</i>and&#160;that&#160;the<br/>
Additionally,&#160;the&#160;network&#160;trafﬁc&#160;is&#160;proportional&#160;to&#160;the&#160;sum<br/>
following&#160;condition&#160;holds:&#160;<i>d&#160;&#160;&#160;d&#160;</i>=&#160;<i>H</i>(<i>A</i>)&#160;<i>&#160;H</i>(<i>B</i>).&#160;Piperine’s<br/>
of&#160;the&#160;count&#160;of&#160;state&#160;changes&#160;in&#160;each&#160;transaction&#160;processed<br/>
prover&#160;proves&#160;this&#160;efﬁciently&#160;by&#160;adapting&#160;techniques&#160;used&#160;to<br/>
by&#160;the&#160;prover—rather&#160;than&#160;the&#160;overall&#160;state&#160;change&#160;from&#160;<i>S</i><br/>
efﬁciently&#160;produce&#160;<i>πaudit</i>.&#160;More&#160;concretely,&#160;the&#160;prover&#160;proves<br/>
to&#160;<i>S</i>.&#160;In&#160;workloads&#160;where&#160;a&#160;part&#160;of&#160;the&#160;state&#160;is&#160;updated&#160;by<br/>
the&#160;correct&#160;execution&#160;of&#160;the&#160;program,&#160;ΨΔ&#160;(depicted&#160;in&#160;Fig-<br/>
many&#160;transactions,&#160;the&#160;network&#160;trafﬁc&#160;includes&#160;each&#160;of&#160;those<br/>
ure&#160;2).&#160;ΨΔ&#160;takes&#160;as&#160;public&#160;input&#160;two&#160;digests&#160;of&#160;state&#160;<i>d</i>,&#160;<i>d</i>,<br/>
changes,&#160;instead&#160;of&#160;just&#160;the&#160;ﬁnal&#160;values,&#160;which&#160;is&#160;sub-optimal.<br/>
and&#160;purported&#160;set&#160;of&#160;writes&#160;Δ,&#160;and&#160;takes&#160;as&#160;non-deterministic<br/>input&#160;a&#160;set&#160;of&#160;overwritten&#160;values.&#160;It&#160;then&#160;checks&#160;that&#160;these&#160;state<br/>
Our&#160;solution.&#160;Piperine’s&#160;prover&#160;sets&#160;Δ&#160;to&#160;be&#160;a&#160;minimal&#160;set<br/>
changes&#160;are&#160;consistent&#160;with&#160;the&#160;updated&#160;digest.&#160;The&#160;veriﬁer<br/>
of&#160;writes&#160;needed&#160;to&#160;take&#160;<i>S&#160;</i>to&#160;<i>S</i>,&#160;and&#160;directly&#160;proves&#160;that:<br/>
simply&#160;veriﬁes&#160;the&#160;proof&#160;of&#160;correct&#160;execution&#160;of&#160;ΨΔ&#160;(i.e.,&#160;<i>π</i>Δ)<br/>
<i>∃S</i><br/>
and&#160;applies&#160;the&#160;claimed&#160;state&#160;changes&#160;to&#160;its&#160;local&#160;state.<br/>
:&#160;<i>d&#160;</i>=&#160;<i>H</i>(<i>S</i>)&#160;<i>∧&#160;d&#160;</i>=&#160;<i>H</i>(Apply(<i>S</i>,&#160;Δ)).<br/>
Clearly,&#160;this&#160;approach&#160;is&#160;efﬁcient&#160;for&#160;<i>V</i>,&#160;as&#160;the&#160;number&#160;of<br/>changes&#160;to&#160;make&#160;it&#160;to&#160;progress&#160;from&#160;<i>S&#160;</i>to&#160;<i>S&#160;</i>is&#160;the&#160;minimal<br/>
<hr/>
<a name=6></a>3.2<br/>
Reducing&#160;concrete&#160;costs<br/>
turn&#160;require&#160;arithmetic&#160;over&#160;large&#160;ﬁnite&#160;ﬁelds.&#160;A&#160;prior&#160;idea&#160;[17,<br/>
We&#160;make&#160;a&#160;number&#160;of&#160;additional&#160;changes&#160;to&#160;Piperine’s&#160;base<br/>
35,&#160;73]&#160;to&#160;make&#160;this&#160;efﬁcient&#160;is&#160;to&#160;ensure&#160;that&#160;the&#160;ﬁeld&#160;over<br/>
machinery&#160;to&#160;reduce&#160;the&#160;veriﬁer’s&#160;and&#160;prover’s&#160;costs.<br/>
which&#160;digital&#160;signature&#160;is&#160;computed&#160;is&#160;the&#160;same&#160;ﬁeld&#160;used&#160;by<br/>
our&#160;algebraic&#160;constraints.&#160;Thus,&#160;we&#160;select&#160;digital&#160;signatures&#160;on<br/>
Replacing&#160;exponentiations&#160;with&#160;hashing.&#160;In&#160;the&#160;proof&#160;ma-<br/>
an&#160;elliptic&#160;curve&#160;over&#160;the&#160;ﬁeld&#160;F<i>p&#160;</i>of&#160;our&#160;algebraic&#160;constraints.<br/>
chinery&#160;that&#160;Piperine&#160;uses&#160;(§2),&#160;the&#160;cost&#160;of&#160;verifying&#160;a&#160;proof<br/>
There&#160;are,&#160;however,&#160;many&#160;elliptic&#160;curves&#160;over&#160;F<i>p</i>.&#160;We<br/>
for&#160;a&#160;computation&#160;Ψ&#160;scales&#160;in&#160;the&#160;number&#160;of&#160;inputs&#160;and&#160;out-<br/>
choose&#160;a&#160;Twisted&#160;Edwards&#160;curve&#160;[19]&#160;to&#160;avoid&#160;<i>branching</i><br/>
puts&#160;of&#160;the&#160;computation,&#160;but&#160;not&#160;in&#160;the&#160;computation&#160;com-<br/>
when&#160;computing&#160;a&#160;point&#160;addition.&#160;This&#160;is&#160;because&#160;the&#160;con-<br/>
plexity&#160;of&#160;Ψ.&#160;Concretely,&#160;each&#160;additional&#160;input&#160;or&#160;output&#160;re-<br/>
straints&#160;formalism&#160;necessitates&#160;executing&#160;all&#160;branches,&#160;which<br/>
quires&#160;the&#160;veriﬁer&#160;to&#160;do&#160;one&#160;additional&#160;modular&#160;exponentia-<br/>
increases&#160;costs.&#160;Speciﬁcally,&#160;we&#160;use&#160;the&#160;curve&#160;<i>E&#160;</i>:&#160;634670<i>x</i>2&#160;+<br/>
tion.&#160;There&#160;is&#160;also&#160;a&#160;ﬁxed&#160;cost&#160;of&#160;three&#160;pairing&#160;computations.<br/>
<i>y</i>2&#160;=&#160;1&#160;+&#160;634650<i>x</i>2<i>y</i>2,&#160;which&#160;is&#160;birationally&#160;equivalent&#160;to&#160;the<br/>
It&#160;is&#160;desirable&#160;to&#160;minimize&#160;the&#160;number&#160;of&#160;explicit&#160;inputs<br/>
twist&#160;of&#160;the&#160;C<i>∅</i>C<i>∅&#160;</i>curve&#160;[19,&#160;53],&#160;of&#160;size&#160;<i>N&#160;</i>=&#160;<i>|E|&#160;≈&#160;p/</i>4.<br/>
and&#160;outputs&#160;that&#160;a&#160;computation&#160;has&#160;(whilst&#160;retaining&#160;safety).<br/>
We&#160;ﬁx&#160;a&#160;base&#160;point&#160;<i>G</i>,&#160;and&#160;construct&#160;ECDSA&#160;signatures<br/>
We&#160;apply&#160;a&#160;prior&#160;idea&#160;[24]&#160;in&#160;our&#160;context:&#160;we&#160;observe&#160;that<br/>
over&#160;<i>E&#160;</i>using&#160;the&#160;MiMC-based&#160;hash&#160;discussed&#160;above.&#160;A&#160;public<br/>
GetBlock&#160;and&#160;PutBlock&#160;primitives&#160;from&#160;Section&#160;2&#160;enable<br/>
key&#160;is&#160;a&#160;point&#160;<i>P&#160;∈&#160;E</i>,&#160;and&#160;a&#160;signature&#160;on&#160;a&#160;message&#160;<i>m&#160;</i>is&#160;a<br/>
any&#160;block&#160;of&#160;data&#160;for&#160;which&#160;<i>V&#160;</i>knows&#160;a&#160;digest&#160;to&#160;be&#160;referenced<br/>
pair&#160;<i>r</i>,&#160;<i>t&#160;∈&#160;</i>[0,&#160;<i>N</i>).&#160;Verifying&#160;a&#160;signature&#160;requires&#160;computing<br/>
by&#160;a&#160;short&#160;cryptographically-binding&#160;name&#160;in&#160;a&#160;veriﬁable<br/>
<i>h&#160;</i>:=&#160;hash(<i>m</i>),&#160;<i>r&#160;</i>:=&#160;(<i>ht</i>)<i>P&#160;</i>+&#160;(<i>rt</i>)<i>G&#160;</i>=&#160;<i>t</i>(<i>hP&#160;</i>+&#160;<i>rG</i>),&#160;and<br/>
way.&#160;Speciﬁcally,&#160;Piperine&#160;replaces&#160;the&#160;inputs&#160;and&#160;outputs&#160;of<br/>
checking&#160;that&#160;<i>r&#160;</i>is&#160;the&#160;<i>x</i>-coordinate&#160;of&#160;<i>r</i>.<br/>
computations&#160;with&#160;their&#160;short&#160;cryptographic&#160;digests&#160;and&#160;have<br/>
The&#160;most&#160;straightforward&#160;way&#160;to&#160;compute&#160;<i>r&#160;</i>is&#160;to&#160;compute<br/>
the&#160;veriﬁer&#160;separately&#160;verify&#160;the&#160;correctness&#160;of&#160;cryptographic<br/>
<i>hP&#160;</i>and&#160;<i>rG&#160;</i>with&#160;a&#160;double-and-add&#160;algorithm,&#160;add&#160;these&#160;points,<br/>
digests&#160;using&#160;their&#160;full&#160;inputs&#160;and&#160;outputs.&#160;Schematically,<br/>
and&#160;then&#160;multiply&#160;by&#160;<i>t&#160;</i>(again&#160;with&#160;double-and-add).&#160;We&#160;now<br/>
Piperine&#160;transforms&#160;a&#160;computation&#160;<i>y&#160;</i>=&#160;<i>f&#160;</i>(<i>x</i>)&#160;into:<br/>
discuss&#160;a&#160;series&#160;of&#160;optimizations.&#160;These&#160;optimizations&#160;are<br/>
Digest&#160;f_wrapped(Digest&#160;in_d)&#160;{<br/>
somewhat&#160;standard&#160;in&#160;the&#160;context&#160;of&#160;high-speed&#160;cryptographic<br/>
x&#160;=&#160;GetBlock(in_d);<br/>
libraries&#160;designed&#160;to&#160;run&#160;on&#160;a&#160;hardware&#160;platform&#160;such&#160;as&#160;x86.<br/>
y&#160;=&#160;f(x);<br/>
Our&#160;innovation&#160;is&#160;in&#160;a&#160;careful&#160;selection&#160;and&#160;application&#160;of<br/>
return&#160;PutBlock(y);<br/>
those&#160;optimizations&#160;for&#160;code&#160;compiled&#160;to&#160;constraints.&#160;For<br/>
}<br/>
context,&#160;although&#160;the&#160;constraints&#160;formalism&#160;is&#160;as&#160;general&#160;as<br/>
<i>P&#160;</i>proves&#160;correct&#160;execution&#160;of&#160;<i>fwrapped</i>,&#160;and&#160;additionally<br/>
x86,&#160;it&#160;has&#160;a&#160;completely&#160;different&#160;cost&#160;model&#160;for&#160;different<br/>
sends&#160;<i>x&#160;</i>and&#160;<i>y&#160;</i>to&#160;<i>V</i>.&#160;As&#160;part&#160;of&#160;its&#160;local&#160;checks,&#160;<i>V&#160;</i>ensures&#160;that<br/>
operations&#160;(e.g.&#160;bitwise&#160;operations&#160;are&#160;orders&#160;of&#160;magnitude<br/>
the&#160;digests&#160;passing&#160;in&#160;and&#160;out&#160;of&#160;<i>fwrapped&#160;</i>correspond&#160;to&#160;<i>x</i>,&#160;<i>y</i>.<br/>
more&#160;expensive&#160;than&#160;256-bit&#160;modular&#160;multiplications).<br/>
For&#160;<i>V</i>,&#160;this&#160;replaces&#160;a&#160;multi-exponentiation&#160;of&#160;size&#160;<i>O</i>(<i>|x|&#160;</i>+&#160;<i>|y|</i>)<br/>
Optimizations.&#160;First,&#160;we&#160;combine&#160;the&#160;computation&#160;of<br/>
with&#160;hash&#160;operations&#160;that&#160;compute&#160;with&#160;<i>O</i>(<i>|x|&#160;</i>+&#160;<i>|y|</i>)&#160;data.<br/>
<i>hP&#160;</i>+&#160;<i>rG&#160;</i>into&#160;a&#160;single&#160;loop&#160;of&#160;doubling&#160;and&#160;adding&#160;one&#160;of<br/>
<i>Choice&#160;of&#160;the&#160;hash&#160;function.&#160;</i>The&#160;remaining&#160;question&#160;is<br/>
<i>{</i>0,&#160;<i>P</i>,&#160;<i>G</i>,&#160;<i>P&#160;</i>+&#160;<i>G}</i>;&#160;this&#160;optimization&#160;is&#160;called&#160;<i>double-scalar</i><br/>
how&#160;to&#160;implement&#160;the&#160;hashing.&#160;Clearly,&#160;for&#160;the&#160;veriﬁer&#160;to&#160;gain,<br/>
<i>multiplication</i>,&#160;a&#160;special&#160;case&#160;of&#160;multiexponentiation&#160;[62].<br/>
the&#160;hash&#160;function&#160;must&#160;be&#160;cheaper&#160;than&#160;exponentiation.&#160;A<br/>
Second,&#160;we&#160;apply&#160;the&#160;above&#160;idea&#160;to&#160;a&#160;single&#160;scalar&#160;mul-<br/>
standard&#160;hash&#160;function&#160;(e.g.,&#160;SHA-256)&#160;would&#160;be&#160;optimal&#160;in<br/>
tiplication&#160;of&#160;a&#160;point&#160;<i>Q</i>;&#160;instead&#160;of&#160;repeatedly&#160;doubling&#160;and<br/>
this&#160;case.&#160;However,&#160;the&#160;prover&#160;must&#160;compute&#160;digests&#160;inside<br/>
adding&#160;one&#160;of&#160;<i>{</i>0,&#160;<i>Q}</i>,&#160;we&#160;repeatedly&#160;quadruple&#160;and&#160;add&#160;one<br/>
constraints&#160;(as&#160;part&#160;of&#160;GetBlock),&#160;and&#160;executing&#160;a&#160;typical<br/>
of&#160;<i>{</i>0,&#160;<i>Q</i>,&#160;2<i>Q</i>,&#160;3<i>Q}</i>.&#160;This&#160;optimization&#160;is&#160;called&#160;<i>2-bit&#160;window-</i><br/>
hash&#160;function&#160;would&#160;incur&#160;<i>≈&#160;</i>800&#160;constraints&#160;per&#160;byte.<br/>
<i>ing</i>,&#160;a&#160;special&#160;case&#160;left-to-right&#160;<i>k</i>-ary&#160;exponentiation&#160;[62].&#160;In<br/>
This&#160;cost&#160;is&#160;partially&#160;addressed&#160;in&#160;prior&#160;work&#160;[17,&#160;24,&#160;43,<br/>
general,&#160;we&#160;can&#160;use&#160;larger&#160;windows,&#160;where&#160;the&#160;number&#160;of<br/>
73]&#160;where&#160;the&#160;GetBlock/PutBlock&#160;primitives&#160;are&#160;based&#160;on<br/>
possible&#160;summands&#160;becomes&#160;some&#160;2<i>w&#160;&gt;&#160;</i>4.&#160;However,&#160;in&#160;con-<br/>
the&#160;Ajtai’s&#160;hash&#160;function&#160;[6],&#160;which&#160;costs&#160;<i>≈&#160;</i>10&#160;constraints&#160;per<br/>
straints,&#160;one&#160;must&#160;encode&#160;the&#160;selection&#160;operation&#160;with&#160;<i>∼&#160;</i>2<i>w</i><br/>
byte.&#160;In&#160;Piperine,&#160;we&#160;use&#160;the&#160;MiMC-based&#160;hash&#160;function&#160;[8]<br/>
constraints,&#160;so&#160;<i>w&#160;&gt;&#160;</i>2&#160;does&#160;not&#160;improve&#160;further.<br/>
(used&#160;in&#160;Spice&#160;[73]&#160;for&#160;a&#160;different&#160;purpose),&#160;which&#160;costs&#160;<i>≈&#160;</i>5<br/>
Our&#160;ﬁnal&#160;and&#160;most&#160;involved&#160;change&#160;is&#160;to&#160;compute&#160;<i>ht&#160;</i>and<br/>
constraints&#160;per&#160;byte.<br/>
<i>rt&#160;</i>mod&#160;<i>N</i>,&#160;which&#160;replaces&#160;one&#160;point&#160;multiplication&#160;with&#160;two<br/>
Efﬁcient&#160;signature&#160;veriﬁcation.&#160;The&#160;cost&#160;of&#160;proof&#160;genera-<br/>
multiplications&#160;mod&#160;<i>N</i>.&#160;However,&#160;<i>N&#160;</i>=&#160;<i>p</i>,&#160;and&#160;since&#160;<i>N</i>2&#160;<i>&#160;p</i><br/>
tion&#160;in&#160;Piperine’s&#160;proof&#160;machinery&#160;is&#160;primarily&#160;due&#160;to&#160;FFTs<br/>
this&#160;multiplication&#160;will&#160;overﬂow&#160;if&#160;performed&#160;naively.&#160;We<br/>
and&#160;multi-exponentiations&#160;whose&#160;size&#160;is&#160;given&#160;by&#160;the&#160;number<br/>
address&#160;this&#160;as&#160;follows.&#160;Given&#160;an&#160;<i>x</i>,&#160;<i>y&#160;</i>to&#160;multiply,&#160;there&#160;is<br/>
of&#160;constraints.&#160;So&#160;reducing&#160;the&#160;number&#160;of&#160;constraints&#160;used&#160;to<br/>
some&#160;<i>a&#160;</i>such&#160;that&#160;<i>xy&#160;−&#160;aN&#160;∈&#160;</i>[0,&#160;<i>N</i>).&#160;To&#160;compute&#160;this,&#160;we<br/>
represent&#160;a&#160;computation&#160;reduces&#160;prover&#160;costs.&#160;In&#160;our&#160;target<br/>
express&#160;<i>x</i>,&#160;<i>y</i>,&#160;<i>a</i>,&#160;<i>N&#160;</i>in&#160;base&#160;<i>B&#160;</i>=&#160;286,&#160;where&#160;each&#160;of&#160;<i>x</i>,&#160;<i>y</i>,&#160;<i>a</i>,&#160;<i>N&#160;</i>has<br/>
state&#160;machines,&#160;most&#160;constraints&#160;are&#160;used&#160;to&#160;implement&#160;cryp-<br/>
at&#160;most&#160;three&#160;digits.&#160;We&#160;then&#160;use&#160;long&#160;multiplication&#160;(base&#160;<i>B</i>)<br/>
tographic&#160;operations,&#160;such&#160;as&#160;digital&#160;signature&#160;veriﬁcation.<br/>
to&#160;express&#160;the&#160;product&#160;as&#160;the&#160;sum&#160;of&#160;products&#160;of&#160;the&#160;digits,<br/>
Common&#160;digital&#160;signature&#160;algorithms&#160;compute&#160;over&#160;a&#160;group<br/>
shifted&#160;by&#160;powers&#160;of&#160;<i>B</i>.&#160;We&#160;collect&#160;the&#160;terms&#160;that&#160;have&#160;been<br/>
where&#160;the&#160;discrete&#160;logarithm&#160;problem&#160;is&#160;hard.&#160;These&#160;groups&#160;in<br/>
shifted&#160;by&#160;a&#160;common&#160;power&#160;of&#160;<i>B&#160;</i>for&#160;both&#160;<i>xy&#160;</i>and&#160;<i>−aN</i>.&#160;Each<br/>
<hr/>
<a name=7></a>aggregated&#160;term&#160;is&#160;in&#160;(<i>−</i>3<i>B</i>2,&#160;3<i>B</i>2).&#160;So&#160;<i>xy&#160;−&#160;aN&#160;</i>is&#160;expressed<br/>
Verify(<i>π</i>Δ,&#160;<i>d</i>,&#160;<i>d</i>,&#160;Δ)&#160;=<i>⇒&#160;∃δ&#160;</i>:&#160;keys(<i>δ</i>)&#160;<i>⊆&#160;</i>keys(Δ)<br/>
(2)<br/>
as&#160;a&#160;sum&#160;of&#160;values&#160;of&#160;modulus&#160;<i>&lt;&#160;</i>3<i>B</i>2,&#160;shifted&#160;by&#160;powers&#160;of&#160;<i>B</i>.<br/>
<i>∧&#160;H</i>(Δ)&#160;<i>&#160;&#160;H</i>(<i>δ</i>)&#160;=&#160;<i>d&#160;&#160;&#160;d</i><br/>
Since&#160;<i>B</i>2&#160;=&#160;2172&#160;<i>&#160;p/</i>6,&#160;these&#160;sums&#160;can&#160;be&#160;computed<br/>
exactly&#160;modulo&#160;<i>p</i>.&#160;So&#160;we&#160;can&#160;combine&#160;the&#160;values&#160;(shifted&#160;by<br/>
Lemma&#160;3.1.&#160;<i>For&#160;a&#160;state&#160;machine&#160;M&#160;with&#160;transition&#160;function</i><br/>
powers&#160;of&#160;<i>B</i>)&#160;to&#160;ﬁnd&#160;<i>xy&#160;−&#160;aN</i>,&#160;checking&#160;that&#160;no&#160;overﬂow&#160;will<br/>
Ψ&#160;<i>and&#160;initial&#160;state&#160;S</i>0&#160;=&#160;<i>S&#160;(where&#160;d&#160;</i>=&#160;<i>H</i>(<i>S</i>)<i>),&#160;given&#160;inputs&#160;x,</i><br/>
occur.&#160;To&#160;do&#160;this,&#160;we&#160;accumulate&#160;the&#160;most&#160;signiﬁcant&#160;parts&#160;of<br/>
<i>an&#160;honest&#160;prover&#160;can&#160;produce&#160;a&#160;tuple&#160;</i>(<i>y</i>,&#160;<i>d</i>,&#160;<i>π</i>,&#160;Δ,&#160;<i>π</i>Δ)&#160;<i>such</i><br/>
the&#160;product,&#160;multiplying&#160;by&#160;powers&#160;of&#160;<i>B&#160;</i>only&#160;after&#160;checking<br/>
<i>that&#160;the&#160;state&#160;machine&#160;M&#160;with&#160;current&#160;state&#160;</i>(<i>S</i>,&#160;<i>d</i>)&#160;<i>transitions</i><br/>
that&#160;the&#160;accumulator&#160;is&#160;below&#160;<i>p/B</i>.<br/>
<i>to&#160;</i>(Apply(<i>S</i>,&#160;Δ),&#160;<i>d</i>)&#160;<i>and&#160;outputs&#160;y.</i><br/>
Section&#160;6.1&#160;evaluates&#160;these&#160;optimizations.<br/>
<i>Proof.&#160;</i>By&#160;the&#160;completeness&#160;of&#160;the&#160;underlying&#160;VSM,&#160;an&#160;hon-<br/>
Batching.&#160;The&#160;prover&#160;executes&#160;a&#160;batch&#160;of&#160;transactions&#160;and<br/>
est&#160;prover&#160;on&#160;inputs&#160;<i>x&#160;</i>and&#160;state&#160;<i>S&#160;</i>can&#160;compute&#160;the&#160;new&#160;state<br/>
provides&#160;a&#160;proof&#160;of&#160;correct&#160;execution&#160;for&#160;the&#160;batch&#160;as&#160;a&#160;whole.<br/>
<i>S</i>,&#160;outputs&#160;<i>yi</i>,&#160;and&#160;state&#160;changes&#160;Δ&#160;such&#160;that&#160;<i>d&#160;</i>:=&#160;<i>H</i>(<i>S</i>),<br/>
The&#160;veriﬁer&#160;veriﬁes&#160;a&#160;single&#160;proof&#160;for&#160;the&#160;entire&#160;batch,&#160;thereby<br/>
<i>d&#160;</i>:=&#160;<i>H</i>(<i>S</i>),&#160;and&#160;<i>π</i>,&#160;<i>π</i>Δ&#160;pass&#160;their&#160;veriﬁcation&#160;checks,&#160;which<br/>
amortizing&#160;the&#160;ﬁxed&#160;costs&#160;of&#160;veriﬁcation&#160;over&#160;the&#160;entire&#160;batch.<br/>
causes&#160;<i>M&#160;</i>in&#160;state&#160;(<i>S</i>,&#160;<i>d</i>)&#160;to&#160;transition&#160;to&#160;(Apply(<i>S</i>,&#160;Δ),&#160;<i>d</i>)<br/>
The&#160;prover&#160;also&#160;amortizes&#160;the&#160;linear&#160;cost&#160;of&#160;producing&#160;<i>πaudit</i><br/>
and&#160;output&#160;<i>y</i>.<br/>
and&#160;<i>π</i>Δ&#160;over&#160;the&#160;entire&#160;batch&#160;of&#160;transactions.<br/>
Finally,&#160;note&#160;that&#160;producing&#160;<i>π</i><br/>
Lemma&#160;3.2.&#160;<i>If&#160;M&#160;is&#160;in&#160;state&#160;</i>(<i>S</i>,&#160;<i>d</i>)&#160;<i>with&#160;d&#160;</i>=&#160;<i>H</i>(<i>S</i>)<i>,&#160;and</i><br/>
<i>audit&#160;</i>and&#160;<i>π</i>Δ&#160;requires&#160;comput-<br/>
ing&#160;over&#160;the&#160;entire&#160;state&#160;<i>S&#160;</i>and&#160;the&#160;state&#160;changes&#160;Δ.&#160;Building<br/>
<i>transitions&#160;to&#160;a&#160;state&#160;</i>(<i>S</i>,&#160;<i>d</i>)&#160;<i>with&#160;outputs&#160;y,&#160;then&#160;with&#160;proba-</i><br/>
on&#160;Spice&#160;[73],&#160;we&#160;structure&#160;these&#160;computations&#160;as&#160;a&#160;MapRe-<br/>
<i>bility&#160;≥&#160;</i>1<i>−O</i>(<i></i>)<i>:&#160;(1)&#160;d&#160;</i>=&#160;<i>H</i>(<i>S</i>)<i>,&#160;and&#160;(2)&#160;∃x&#160;</i>:&#160;<i>M&#160;transitions</i><br/>
duce&#160;job&#160;where&#160;each&#160;mapper&#160;and&#160;reducer&#160;operates&#160;on&#160;ﬁxed-<br/>
<i>S&#160;→&#160;S&#160;on&#160;inputs&#160;x,&#160;outputting&#160;y&#160;in&#160;some&#160;order.</i><br/>
sized&#160;chunk&#160;of&#160;data&#160;(this&#160;permits&#160;the&#160;use&#160;of&#160;a&#160;one-time&#160;trusted<br/>
<i>Proof.&#160;</i>If&#160;<i>M&#160;</i>transitions,&#160;both&#160;Verify&#160;checks&#160;return&#160;true.&#160;So<br/>
setup&#160;for&#160;proof&#160;machinery&#160;regardless&#160;of&#160;the&#160;size&#160;of&#160;the&#160;prover’s<br/>
(ignoring&#160;an&#160;<i>O</i>(<i></i>)&#160;probability&#160;of&#160;failure)&#160;the&#160;prover&#160;knows<br/>
state;&#160;§8).&#160;However,&#160;different&#160;from&#160;Spice,&#160;Piperine’s&#160;prover<br/>
<i>σ</i>,&#160;<i>{x</i><br/>
does&#160;not&#160;prove&#160;the&#160;execution&#160;of&#160;reducers,&#160;but&#160;instead&#160;the<br/>
<i>i}i</i>=1<i>...n</i>,&#160;<i>{Si}i</i>=0<i>...n&#160;</i>and&#160;<i>δ</i>.<br/>
From&#160;the&#160;collision&#160;resistance&#160;of&#160;<i>H</i>(<i>·</i>),&#160;<i>S&#160;</i>=&#160;<i>S</i><br/>
veriﬁer&#160;executes&#160;reducers.&#160;This&#160;is&#160;because&#160;the&#160;reducer’s&#160;com-<br/>
0,&#160;<i>Sn&#160;−&#160;S</i>0&#160;=<br/>
Δ&#160;<i>−&#160;δ</i>.&#160;Since&#160;keys(Δ)&#160;<i>⊇&#160;</i>keys(<i>δ</i>),&#160;<i>S</i><br/>
putation&#160;(elliptic&#160;curve&#160;point&#160;additions,&#160;equality&#160;checks,&#160;etc.)<br/>
<i>n&#160;</i>=&#160;Apply(<i>S</i>0,&#160;Δ),&#160;and<br/>
so&#160;<i>S&#160;</i>=&#160;<i>S</i><br/>
is&#160;not&#160;worthwhile&#160;to&#160;be&#160;outsourced&#160;to&#160;the&#160;prover.<br/>
<i>n</i>,&#160;implying&#160;<i>d&#160;</i>=&#160;<i>H</i>(<i>S&#160;</i>).&#160;Then&#160;from&#160;Equation&#160;1,<br/>
<i>M&#160;</i>transitions&#160;<i>S&#160;→&#160;S&#160;</i>on&#160;inputs&#160;<i>xσ</i>(<i>i</i>),&#160;outputting&#160;<i>yσ</i>(<i>i</i>).<br/>
3.3<br/>
Correctness&#160;proofs<br/>
Theorem&#160;3.1.&#160;<i>If&#160;R&#160;maintains&#160;a&#160;safety&#160;property&#160;on&#160;M,&#160;then</i><br/>
Recall&#160;that&#160;safety&#160;and&#160;liveness&#160;properties&#160;are&#160;properties&#160;of&#160;se-<br/>
<i>R&#160;maintains&#160;this&#160;safety&#160;property&#160;on&#160;M&#160;except&#160;for&#160;an&#160;error</i><br/>
quences&#160;of&#160;states&#160;which,&#160;respectively,&#160;are&#160;closed&#160;under&#160;taking<br/>
<i>probability&#160;of&#160;O</i>(<i></i>)<i>.</i><br/>
preﬁxes,&#160;or&#160;can&#160;be&#160;preserved&#160;under&#160;extension&#160;[55].<br/>
Given&#160;an&#160;RSM&#160;<i>R&#160;</i>that&#160;replicates&#160;a&#160;state&#160;machine&#160;<i>M</i>,&#160;Piper-<br/>
<i>Proof.&#160;</i>By&#160;Lemma&#160;3.2,&#160;<i>M&#160;</i>can&#160;only&#160;transition&#160;from&#160;(<i>S</i>,&#160;<i>d</i>)&#160;to<br/>
ine&#160;constructs&#160;an&#160;RSM&#160;<i>R</i>,&#160;which&#160;includes:&#160;(i)&#160;Piperine’s<br/>
(<i>S</i>,&#160;<i>d</i>)&#160;outputting&#160;<i>y&#160;</i>if&#160;<i>M&#160;</i>can&#160;have&#160;a&#160;sequence&#160;of&#160;transitions<br/>
prover;&#160;and&#160;(ii)&#160;<i>R&#160;</i>that&#160;replicates&#160;Piperine’s&#160;veriﬁer.&#160;We&#160;now<br/>
from&#160;<i>S&#160;</i>to&#160;<i>S&#160;</i>outputting&#160;<i>y</i>.&#160;So&#160;any&#160;sequence&#160;of&#160;states&#160;(<i>Si</i>,&#160;<i>di</i>)<br/>
prove&#160;that&#160;any&#160;safety&#160;or&#160;liveness&#160;property&#160;that&#160;holds&#160;in&#160;<i>R&#160;</i>for<br/>
with&#160;outputs&#160;<i>y&#160;</i>of&#160;<i>M&#160;</i>projects&#160;down&#160;to&#160;a&#160;sub-sequence&#160;of&#160;a<br/>
all&#160;state&#160;machines&#160;is&#160;preserved&#160;in&#160;<i>R&#160;</i>for&#160;all&#160;state&#160;machines—<br/>
sequence&#160;of&#160;states&#160;<i>S&#160;</i>with&#160;outputs&#160;<i>y&#160;</i>of&#160;<i>M</i>.<br/>
except&#160;for&#160;an&#160;error&#160;probability&#160;of&#160;<i>O</i>(<i></i>),&#160;where&#160;<i>&#160;</i>is&#160;negligible<br/>
Taking&#160;preﬁxes&#160;of&#160;a&#160;sequence&#160;commutes&#160;with&#160;this&#160;projec-<br/>
in&#160;the&#160;security&#160;parameter&#160;and&#160;is&#160;set&#160;to&#160;1<i>/</i>2128&#160;in&#160;practice.&#160;In<br/>
tion.&#160;Furthermore,&#160;<i>A&#160;</i>is&#160;a&#160;sub-sequence&#160;of&#160;a&#160;preﬁx&#160;of&#160;<i>B&#160;</i>if&#160;and<br/>
more&#160;detail,&#160;the&#160;veriﬁer&#160;that&#160;is&#160;replicated&#160;in&#160;<i>R&#160;</i>(say&#160;<i>M</i>)&#160;is<br/>
only&#160;if&#160;<i>A&#160;</i>is&#160;a&#160;preﬁx&#160;of&#160;a&#160;sub-sequence&#160;of&#160;<i>B</i>.&#160;So&#160;if&#160;<i>R&#160;</i>maintains<br/>
a&#160;state&#160;machine&#160;with&#160;state&#160;(<i>S</i>,&#160;<i>d</i>).&#160;The&#160;transition&#160;function&#160;of<br/>
some&#160;safety&#160;property&#160;on&#160;<i>M</i>,&#160;then&#160;<i>R&#160;</i>preserves&#160;it&#160;on&#160;<i>M</i>.<br/>
<i>M&#160;</i>takes&#160;as&#160;input&#160;a&#160;tuple&#160;(<i>y</i>,&#160;<i>d</i>,&#160;<i>π</i>,&#160;Δ,&#160;<i>π</i>Δ),&#160;and&#160;executes:<br/>
Corollary&#160;3.1.&#160;<i>If&#160;R&#160;maintains&#160;a&#160;safety&#160;property&#160;S&#160;for&#160;all</i><br/>
1.&#160;Assert(Verify(<i>π</i>,&#160;<i>d</i>,&#160;<i>d</i>,<i>y</i>)&#160;<i>∧&#160;</i>Verify(<i>π</i>Δ,&#160;<i>d</i>,&#160;<i>d</i>,&#160;Δ)).<br/>
<i>state&#160;machines,&#160;then&#160;R&#160;maintains&#160;S&#160;for&#160;all&#160;state&#160;machines,</i><br/>
2.&#160;(<i>S</i>,&#160;<i>d</i>)&#160;<i>←&#160;</i>(<i>S</i>,&#160;<i>d</i>)&#160;where&#160;<i>S&#160;</i>=&#160;Apply(<i>S</i>,&#160;Δ),&#160;output&#160;<i>y</i>.<br/>
<i>excepting&#160;an&#160;error&#160;probability&#160;O</i>(<i></i>)<i>.</i><br/>
Since&#160;we&#160;allow&#160;a&#160;probability&#160;<i>O</i>(<i></i>)&#160;of&#160;error,&#160;we&#160;can&#160;con-<br/>
Theorem&#160;3.2.&#160;<i>If&#160;R&#160;applied&#160;to&#160;M&#160;maintains&#160;a&#160;liveness&#160;prop-</i><br/>
dition&#160;on&#160;events&#160;of&#160;probability&#160;<i>≥&#160;</i>1&#160;<i>−&#160;</i>.&#160;In&#160;particular,&#160;we<br/>
<i>erty,&#160;then&#160;R&#160;applied&#160;to&#160;M&#160;maintains&#160;this&#160;liveness&#160;property.</i><br/>
condition&#160;on&#160;Verify&#160;returning&#160;false&#160;if&#160;<i>P&#160;</i>does&#160;not&#160;possess<br/>non-deterministic&#160;choices&#160;such&#160;that&#160;the&#160;claimed&#160;outputs&#160;cor-<br/>
<i>Proof.&#160;</i>Any&#160;states&#160;<i>S&#160;</i>of&#160;<i>M&#160;</i>can&#160;be&#160;extended&#160;to&#160;a&#160;state&#160;(<i>S</i>,&#160;<i>d</i>)<br/>
rect,&#160;and&#160;the&#160;prover&#160;knowing&#160;no&#160;collisions&#160;in&#160;<i>H</i>(<i>·</i>).&#160;Then:<br/>
for&#160;<i>M</i>,&#160;by&#160;setting&#160;<i>d&#160;</i>=&#160;<i>H</i>(<i>S</i>).&#160;If&#160;<i>R&#160;</i>maintains&#160;some&#160;liveness<br/>property&#160;<i>L&#160;</i>on&#160;<i>M</i>,&#160;any&#160;sequence&#160;of&#160;states&#160;for&#160;<i>M&#160;</i>satisfying&#160;<i>L</i><br/>
Verify(<i>π</i>,&#160;<i>d</i>,&#160;<i>d</i>,<i>y</i>)&#160;=<i>⇒&#160;∃σ&#160;∈&#160;Sym</i>(<i>n</i>),&#160;<i>x</i><br/>
can&#160;be&#160;extended&#160;indeﬁnitely&#160;maintaining&#160;<i>L</i>.<br/>
1,&#160;<i>.&#160;.&#160;.&#160;xn</i>,&#160;<i>S</i>0&#160;<i>.&#160;.&#160;.&#160;Sn&#160;</i>:<br/>
<i>H</i>(<i>S</i><br/>
A&#160;sequence&#160;of&#160;states&#160;of&#160;<i>M&#160;</i>project&#160;to&#160;a&#160;sub-sequence&#160;of<br/>
0)&#160;=&#160;<i>d&#160;∧&#160;H</i>(<i>Sn</i>)&#160;=&#160;<i>d</i><br/>
(1)<br/>
a&#160;sequence&#160;of&#160;states&#160;of&#160;<i>M</i>.&#160;If&#160;this&#160;sequence&#160;of&#160;states&#160;of&#160;<i>M</i><br/>
<i>∧i</i>=1<i>...n&#160;</i>Ψ(<i>Si−</i>1,&#160;<i>xσ</i>(<i>i</i>))&#160;=&#160;(<i>Si</i>,&#160;<i>yσ</i>(<i>i</i>))<br/>
satisfy&#160;<i>L</i>,&#160;then&#160;it&#160;may&#160;be&#160;extended&#160;by&#160;inputs&#160;<i>x&#160;</i>maintaining&#160;<i>L</i>.<br/>
<hr/>
<a name=8></a>Given&#160;inputs&#160;<i>x&#160;</i>causing&#160;<i>M&#160;</i>to&#160;transition&#160;from&#160;<i>S&#160;</i>to&#160;<i>S&#160;</i>out-<br/>
who&#160;wish&#160;to&#160;invoke&#160;the&#160;application&#160;submit&#160;their&#160;transactions<br/>
putting&#160;<i>y</i>,&#160;the&#160;prover&#160;can&#160;compute&#160;a&#160;(<i>y</i>,&#160;<i>d</i>,&#160;<i>π</i>,&#160;Δ,&#160;<i>π</i>Δ)&#160;causing<br/>
to&#160;a&#160;Piperine&#160;prover.&#160;The&#160;prover&#160;accumulates&#160;transactions,<br/>
<i>M&#160;</i>to&#160;transition&#160;from&#160;(<i>S</i>,&#160;<i>H</i>(<i>S</i>))&#160;to&#160;(<i>S</i>,&#160;<i>H</i>(<i>S</i>))&#160;and&#160;output<br/>
executes&#160;them&#160;in&#160;batches,&#160;and&#160;produces&#160;proofs&#160;that&#160;are&#160;then<br/>
<i>y&#160;</i>(Lemma&#160;3.1).&#160;So&#160;the&#160;sequence&#160;of&#160;states&#160;of&#160;<i>M&#160;</i>may&#160;be<br/>
sent&#160;to&#160;a&#160;veriﬁer.&#160;The&#160;veriﬁer&#160;is&#160;implemented&#160;as&#160;a&#160;smart&#160;con-<br/>
extended&#160;maintaining&#160;<i>L</i>,&#160;and&#160;<i>R&#160;</i>maintains&#160;<i>L</i>.<br/>
tract&#160;that&#160;runs&#160;natively&#160;on&#160;Ethereum.&#160;The&#160;veriﬁer&#160;contract&#160;is<br/>generic&#160;to&#160;Ψ&#160;and&#160;implements&#160;the&#160;veriﬁcation&#160;of&#160;proofs,&#160;the&#160;ag-<br/>
Corollary&#160;3.2.&#160;<i>If&#160;R&#160;maintains&#160;a&#160;liveness&#160;property&#160;L&#160;for&#160;all</i><br/>
gregation&#160;of&#160;changes&#160;to&#160;the&#160;state&#160;digests,&#160;and&#160;the&#160;veriﬁcation<br/>
<i>state&#160;machines,&#160;then&#160;R&#160;maintains&#160;L&#160;for&#160;all&#160;state&#160;machines.</i><br/>
of&#160;the&#160;purported&#160;state&#160;changes.&#160;As&#160;the&#160;veriﬁer&#160;keeps&#160;track&#160;of<br/>
4<br/>
Applying&#160;Piperine&#160;to&#160;Ethereum<br/>
the&#160;application&#160;state&#160;and&#160;incorporates&#160;cryptographic&#160;material<br/>for&#160;proof&#160;veriﬁcation,&#160;it&#160;is&#160;deployed&#160;on&#160;a&#160;per-application&#160;basis.<br/>
We&#160;discuss&#160;how&#160;Piperine&#160;enhances&#160;Ethereum,&#160;starting&#160;with&#160;a<br/>
All&#160;inputs&#160;processed&#160;by&#160;the&#160;veriﬁer&#160;are&#160;recorded&#160;on-chain<br/>
primer&#160;on&#160;the&#160;base&#160;system.<br/>
since&#160;the&#160;prover&#160;invokes&#160;the&#160;veriﬁer&#160;by&#160;submitting&#160;a&#160;regular<br/>
A&#160;primer&#160;on&#160;Ethereum.&#160;Ethereum&#160;is&#160;a&#160;blockchain&#160;network<br/>
Ethereum&#160;transaction&#160;with&#160;these&#160;inputs&#160;as&#160;arguments.<br/>
that&#160;instantiates&#160;a&#160;large-scale&#160;RSM.&#160;In&#160;Ethereum,&#160;state&#160;con-<br/>
Deployment&#160;and&#160;fault-tolerance.&#160;Recall&#160;from&#160;Section&#160;3<br/>
sists&#160;of&#160;a&#160;set&#160;of&#160;accounts,&#160;each&#160;of&#160;which&#160;possesses&#160;a&#160;balance&#160;in<br/>
that&#160;Piperine’s&#160;prover&#160;is&#160;untrusted&#160;for&#160;both&#160;safety&#160;and&#160;live-<br/>
a&#160;currency&#160;(ether).&#160;Optionally,&#160;each&#160;account&#160;can&#160;possess&#160;byte-<br/>
ness.&#160;Thus,&#160;the&#160;prover&#160;can&#160;run&#160;on&#160;any&#160;untrusted&#160;infrastructure.<br/>
code&#160;written&#160;for&#160;the&#160;Ethereum&#160;Virtual&#160;Machine&#160;(EVM)&#160;and<br/>
Furthermore,&#160;the&#160;prover&#160;has&#160;<i>no&#160;</i>private&#160;state,&#160;and&#160;all&#160;state<br/>
internal&#160;persistent&#160;storage.&#160;Such&#160;bytecode&#160;is&#160;called&#160;a&#160;<i>smart</i><br/>
necessary&#160;to&#160;instantiate&#160;a&#160;new&#160;prover&#160;is&#160;persistently&#160;recorded<br/>
<i>contract&#160;</i>and&#160;can&#160;be&#160;deployed&#160;to&#160;an&#160;account&#160;by&#160;a&#160;developer;<br/>
on-chain&#160;(in&#160;blockchain&#160;terms,&#160;there&#160;are&#160;no&#160;“data&#160;availability”<br/>
this&#160;facility&#160;can&#160;be&#160;used&#160;to&#160;implement&#160;decentralized&#160;applica-<br/>
issues).&#160;Hence,&#160;any&#160;entity&#160;(a&#160;client,&#160;a&#160;miner,&#160;or&#160;a&#160;third-party<br/>
tions&#160;such&#160;as&#160;payment&#160;services,&#160;games,&#160;auctions,&#160;etc.&#160;State<br/>
service)&#160;can&#160;act&#160;as&#160;a&#160;prover&#160;at&#160;any&#160;point—without&#160;requiring<br/>
transitions&#160;(also&#160;known&#160;as&#160;transactions)&#160;in&#160;Ethereum&#160;consist<br/>
coordination&#160;with&#160;any&#160;other&#160;instance&#160;of&#160;a&#160;prover&#160;that&#160;might<br/>
of&#160;transfers&#160;of&#160;balances&#160;between&#160;accounts,&#160;deploying&#160;new<br/>
exist&#160;in&#160;the&#160;system.2&#160;There&#160;can&#160;theoretically&#160;be&#160;an&#160;unlimited<br/>
smart&#160;contracts,&#160;and&#160;calls&#160;to&#160;methods&#160;exposed&#160;by&#160;smart&#160;con-<br/>
number&#160;of&#160;provers&#160;per&#160;application&#160;(e.g.,&#160;each&#160;miner&#160;can&#160;be-<br/>
tracts&#160;(which&#160;in&#160;turn&#160;can&#160;make&#160;calls&#160;to&#160;other&#160;smart&#160;contracts).<br/>
come&#160;a&#160;prover&#160;for&#160;an&#160;application&#160;of&#160;its&#160;choice).&#160;In&#160;practice,<br/>
Nodes&#160;in&#160;the&#160;Ethereum&#160;network&#160;reach&#160;consensus&#160;on&#160;an<br/>
an&#160;efﬁcient&#160;deployment&#160;option&#160;is&#160;for&#160;the&#160;prover&#160;to&#160;be&#160;offered<br/>
append-only&#160;ledger&#160;of&#160;blocks&#160;containing&#160;transactions.&#160;The<br/>
as&#160;a&#160;commercial&#160;service&#160;that&#160;provides&#160;decentralized&#160;applica-<br/>
execution&#160;of&#160;transactions&#160;is&#160;replicated&#160;across&#160;the&#160;network,&#160;i.e.,<br/>
tions&#160;with&#160;reduced&#160;per-transaction&#160;costs—without&#160;giving&#160;up<br/>
each&#160;node&#160;executes&#160;every&#160;transaction&#160;in&#160;the&#160;ledger.<br/>
the&#160;beneﬁts&#160;of&#160;decentralization.&#160;In&#160;our&#160;experiments&#160;(§6),&#160;we<br/>
Each&#160;operation&#160;supported&#160;by&#160;the&#160;EVM&#160;is&#160;assigned&#160;a<br/>
deploy&#160;the&#160;prover&#160;on&#160;a&#160;cluster&#160;of&#160;machines&#160;in&#160;the&#160;cloud.<br/>
complexity-based&#160;cost&#160;in&#160;a&#160;currency&#160;called&#160;<i>gas</i>,&#160;which&#160;is<br/>
Bootstrapping&#160;and&#160;interoperability.&#160;We&#160;facilitate&#160;inter-<br/>
derived&#160;from&#160;ether&#160;and&#160;hence&#160;fungible&#160;in&#160;USD&#160;(§6.3).&#160;For<br/>
operability&#160;between&#160;Piperine-enhanced&#160;applications&#160;and&#160;na-<br/>
example,&#160;the&#160;cost&#160;of&#160;executing&#160;arithmetic&#160;operations&#160;or&#160;read-<br/>
tive&#160;smart&#160;contracts.&#160;As&#160;an&#160;example,&#160;in&#160;the&#160;context&#160;of&#160;an<br/>
ing&#160;transaction&#160;data&#160;inside&#160;a&#160;contract&#160;is&#160;in&#160;single&#160;digits&#160;of<br/>
ERC-20&#160;token&#160;[79],&#160;the&#160;main&#160;requirements&#160;are&#160;that&#160;clients<br/>
gas,&#160;whilst&#160;the&#160;cost&#160;of&#160;updating&#160;state&#160;or&#160;calling&#160;a&#160;contract&#160;is<br/>
can&#160;bootstrap&#160;account&#160;balances&#160;by&#160;sending&#160;currency&#160;to&#160;the<br/>
many&#160;thousands&#160;of&#160;gas&#160;[86].&#160;When&#160;a&#160;transaction&#160;invokes&#160;a<br/>
smart&#160;contract,&#160;and&#160;can&#160;withdraw&#160;their&#160;funds&#160;unilaterally—<br/>
method&#160;exposed&#160;by&#160;a&#160;smart&#160;contract,&#160;the&#160;call&#160;is&#160;supplied&#160;by&#160;its<br/>
without&#160;trusting&#160;any&#160;prover.&#160;To&#160;support&#160;this,&#160;the&#160;smart&#160;contract<br/>
caller&#160;with&#160;some&#160;amount&#160;of&#160;gas,&#160;and&#160;each&#160;operation&#160;consumes<br/>
implementing&#160;the&#160;veriﬁer&#160;keeps&#160;a&#160;list&#160;of&#160;pending&#160;payments&#160;to<br/>
gas&#160;from&#160;this&#160;supply.&#160;If&#160;the&#160;execution&#160;of&#160;the&#160;smart-contract<br/>
and&#160;from&#160;the&#160;Piperine-enhanced&#160;token.&#160;When&#160;clients&#160;wish&#160;to<br/>
call&#160;requires&#160;more&#160;gas&#160;than&#160;is&#160;supplied,&#160;the&#160;execution&#160;termi-<br/>
bootstrap&#160;a&#160;balance,&#160;they&#160;use&#160;a&#160;traditional&#160;ERC-20&#160;transaction<br/>
nates.&#160;This&#160;policy&#160;bounds&#160;the&#160;computational&#160;resources&#160;that<br/>
to&#160;send&#160;funds&#160;to&#160;the&#160;veriﬁer&#160;contract.&#160;The&#160;veriﬁer&#160;contract<br/>
nodes&#160;in&#160;the&#160;network&#160;must&#160;expend&#160;to&#160;execute&#160;state&#160;transitions<br/>
adds&#160;the&#160;hash&#160;of&#160;this&#160;transaction&#160;to&#160;the&#160;list&#160;of&#160;pending&#160;pay-<br/>
in&#160;Ethereum;&#160;this&#160;is&#160;a&#160;key&#160;mechanism&#160;to&#160;prevent&#160;denial&#160;of<br/>
ments&#160;to&#160;the&#160;token.&#160;When&#160;the&#160;prover&#160;wishes&#160;to&#160;issue&#160;currency<br/>
service&#160;attacks.&#160;The&#160;gas&#160;consumption&#160;of&#160;all&#160;smart&#160;contract<br/>
to&#160;an&#160;account&#160;on&#160;its&#160;state,&#160;it&#160;releases&#160;a&#160;transaction&#160;hash&#160;to&#160;the<br/>
calls&#160;in&#160;a&#160;block&#160;is&#160;the&#160;<i>block&#160;size</i>,&#160;which&#160;is&#160;currently&#160;capped&#160;by<br/>
veriﬁer,&#160;which&#160;rejects&#160;the&#160;state&#160;transition&#160;if&#160;the&#160;hash&#160;is&#160;not<br/>
Ethereum&#160;to&#160;<i>≈&#160;</i>8&#160;<i>·&#160;</i>106&#160;and&#160;is&#160;routinely&#160;saturated&#160;in&#160;practice.<br/>
present&#160;in&#160;the&#160;pending&#160;list.&#160;If&#160;not,&#160;it&#160;updates&#160;the&#160;pending&#160;list<br/>
Enhancing&#160;Ethereum&#160;with&#160;Piperine.&#160;Piperine&#160;enhances<br/>
to&#160;prevent&#160;a&#160;prover&#160;from&#160;double&#160;issuance.<br/>
Ethereum&#160;at&#160;the&#160;level&#160;of&#160;an&#160;application.&#160;While&#160;the&#160;enhance-<br/>
Similarly,&#160;to&#160;withdraw&#160;funds,&#160;the&#160;prover&#160;executes&#160;a&#160;trans-<br/>
ment&#160;requires&#160;several&#160;changes&#160;to&#160;the&#160;execution&#160;logic&#160;of&#160;the<br/>
action&#160;that&#160;burns&#160;tokens&#160;in&#160;the&#160;Piperine-managed&#160;state&#160;and<br/>
application,&#160;these&#160;changes&#160;do&#160;not&#160;require&#160;any&#160;modiﬁcation<br/>
whose&#160;public&#160;outputs&#160;direct&#160;the&#160;smart&#160;contract&#160;to&#160;approve<br/>
to&#160;the&#160;underlying&#160;Ethereum&#160;mechanisms&#160;and&#160;can&#160;be&#160;applied<br/>
a&#160;token&#160;withdrawal,&#160;which&#160;can&#160;be&#160;collected&#160;by&#160;an&#160;ERC-20<br/>
transparently.&#160;Speciﬁcally,&#160;instead&#160;of&#160;specifying&#160;the&#160;applica-<br/>
2An&#160;alternate&#160;option&#160;is&#160;to&#160;obtain&#160;a&#160;snapshot&#160;of&#160;the&#160;state&#160;from&#160;another&#160;node.<br/>
tion&#160;as&#160;an&#160;on-chain&#160;smart&#160;contract,&#160;developers&#160;implement&#160;it<br/>
In&#160;this&#160;case,&#160;if&#160;the&#160;snapshot&#160;is&#160;incorrect,&#160;proofs&#160;produced&#160;by&#160;the&#160;new&#160;prover<br/>
off-chain&#160;as&#160;a&#160;program&#160;Ψ&#160;using&#160;Piperine’s&#160;toolchain.&#160;Clients<br/>
will&#160;not&#160;be&#160;accepted&#160;by&#160;the&#160;veriﬁer&#160;on-chain&#160;due&#160;Piperine’s&#160;safety&#160;properties.<br/>
<hr/>
<a name=9></a>transaction.&#160;Since&#160;any&#160;party&#160;can&#160;act&#160;as&#160;the&#160;Piperine&#160;prover,&#160;any<br/>
struct&#160;Txn&#160;{<br/>
party&#160;can&#160;unilaterally&#160;withdraw&#160;funds&#160;by&#160;producing&#160;proofs&#160;of<br/>
int&#160;type;<br/>
//&#160;Type&#160;of&#160;the&#160;transaction<br/>
execution&#160;for&#160;such&#160;a&#160;burn&#160;transaction&#160;and&#160;can&#160;then&#160;transition<br/>
Pk&#160;pk_c,&#160;pk_r;&#160;//&#160;Public&#160;keys:&#160;caller,&#160;recipient<br/>int&#160;v;<br/>
//&#160;Amount&#160;of&#160;currency<br/>
state&#160;on&#160;the&#160;on-chain&#160;veriﬁer&#160;smart&#160;contract.<br/>
int&#160;sig;<br/>
//&#160;Signature&#160;on&#160;the&#160;transaction<br/>
Status&#160;checks.&#160;Piperine’s&#160;prover&#160;sends&#160;a&#160;hash&#160;of&#160;each&#160;ex-<br/>
}<br/>
ecuted&#160;transaction&#160;to&#160;the&#160;chain&#160;as&#160;part&#160;of&#160;inputs&#160;to&#160;the&#160;veri-<br/>
struct&#160;Delta<br/>
//&#160;Delta&#160;to&#160;set-digest<br/>
ﬁer.&#160;As&#160;a&#160;corollary,&#160;any&#160;client&#160;(or&#160;a&#160;new&#160;prover)&#160;can&#160;check<br/>
struct&#160;Account&#160;{&#160;int&#160;balance&#160;};<br/>static&#160;PK&#160;organiser;<br/>
whether&#160;some&#160;transaction&#160;has&#160;already&#160;been&#160;executed&#160;by&#160;check-<br/>
//&#160;creates&#160;currency<br/>
ing&#160;whether&#160;the&#160;hash&#160;of&#160;their&#160;transaction&#160;has&#160;appeared&#160;as&#160;an<br/>
Delta&#160;create(Txn&#160;txn)&#160;{<br/>
input&#160;to&#160;the&#160;Piperine&#160;veriﬁer&#160;contract.<br/>
Delta&#160;d;&#160;Account&#160;recipient;<br/>//&#160;Check&#160;the&#160;type&#160;of&#160;transaction&#160;and&#160;signature<br/>
Choice&#160;of&#160;an&#160;elliptic&#160;curve.&#160;For&#160;efﬁciency,&#160;Piperine&#160;uses&#160;a<br/>
assert(txn.type&#160;==&#160;CREATE);<br/>
different&#160;elliptic&#160;curve&#160;for&#160;ECDSA&#160;signatures&#160;than&#160;Ethereum.<br/>
assert(verify_sig(txn.pk_c,&#160;txn,&#160;txn.sig))<br/>
Thus,&#160;transactions&#160;generated&#160;for&#160;a&#160;Piperine-enhanced&#160;appli-<br/>
//&#160;Only&#160;the&#160;organiser&#160;can&#160;create&#160;tokens<br/>
cation&#160;cannot&#160;be&#160;sent&#160;directly&#160;to&#160;the&#160;Ethereum&#160;chain.3&#160;The<br/>
assert(txn.pk_c&#160;==&#160;organiser)<br/>//&#160;Lock&#160;and&#160;read&#160;account&#160;of&#160;txn.pk_c,&#160;update&#160;d<br/>
above&#160;interoperability&#160;mechanism&#160;alleviates&#160;this&#160;constraint<br/>
beg_txn(&amp;d,&#160;[txn.pk_r],&#160;[&amp;recipient]);<br/>
by&#160;enabling&#160;currency&#160;transfers&#160;from&#160;ether&#160;to&#160;per-application<br/>
recipient.balance&#160;+=&#160;txn.v;<br/>
tokens&#160;and&#160;vice&#160;versa.&#160;Moreover,&#160;the&#160;use&#160;of&#160;cryptographic<br/>
//&#160;Write&#160;and&#160;unlock&#160;account,&#160;update&#160;d<br/>
primitives&#160;that&#160;are&#160;friendly&#160;to&#160;proof&#160;machinery&#160;is&#160;often&#160;an<br/>
end_txn(&amp;d,&#160;[txn.pk_c],&#160;[recipient]);<br/>return&#160;d;<br/>
acceptable&#160;optimization&#160;in&#160;practice&#160;[4,&#160;34,&#160;85].<br/>
}<br/>
Details&#160;of&#160;the&#160;veriﬁer&#160;running&#160;as&#160;a&#160;smart&#160;contract.&#160;To<br/>
//&#160;transfers&#160;currency&#160;between&#160;accounts<br/>
implement&#160;the&#160;logic&#160;of&#160;the&#160;veriﬁer,&#160;we&#160;need&#160;to&#160;build&#160;three<br/>
Delta&#160;transfer(Txn&#160;txn)&#160;{<br/>
high-level&#160;primitives:&#160;a&#160;primitive&#160;to&#160;verify&#160;proofs&#160;produced&#160;by<br/>
Delta&#160;d;&#160;Account&#160;caller,&#160;recipient;<br/>//&#160;Check&#160;the&#160;type&#160;of&#160;transaction&#160;and&#160;signature<br/>
the&#160;proof&#160;machinery,&#160;the&#160;MiMC&#160;hash&#160;function,&#160;and&#160;functions<br/>
assert(txn.type&#160;==&#160;TRANSFER);<br/>
to&#160;update&#160;set-digests&#160;with&#160;deltas.&#160;By&#160;default,&#160;the&#160;EVM<br/>
assert(verify_sig(txn.pk_c,&#160;h,&#160;txn.sig))<br/>
provides&#160;basic&#160;elliptic-curve&#160;point&#160;addition&#160;(150&#160;gas)&#160;and<br/>
//&#160;Lock&#160;and&#160;read&#160;account&#160;of&#160;txn.pk_c,&#160;txn.pk_r,&#160;update&#160;d<br/>
scalar&#160;multiplication&#160;(6,000&#160;gas),&#160;in&#160;the&#160;form&#160;of&#160;precompiled<br/>
beg_txn(&amp;d,&#160;[txn.pk_c,&#160;txn.pk_r],&#160;[&amp;caller,&#160;&amp;recipient]);<br/>if&#160;(caller.balance&#160;&gt;=&#160;txn.v&#160;&amp;&amp;&#160;txn.v&#160;&gt;=&#160;0)&#160;{<br/>
contracts&#160;(i.e.,&#160;as&#160;libraries).&#160;Using&#160;these&#160;library&#160;operations,<br/>
caller.balance&#160;-=&#160;txn.v;<br/>
we&#160;implement&#160;a&#160;primitive&#160;that&#160;can&#160;verify&#160;proofs&#160;produced<br/>
recipient.balance&#160;+=&#160;txn.v;<br/>
by&#160;the&#160;proof&#160;machinery.&#160;In&#160;our&#160;implementation,&#160;verifying&#160;a<br/>
}<br/>//&#160;Write&#160;and&#160;unlock&#160;accounts,&#160;update&#160;d<br/>
single&#160;proof&#160;of&#160;a&#160;computation&#160;costs&#160;<i>≈&#160;</i>201,000&#160;+&#160;6,150&#160;<i>·&#160;I&#160;</i>gas<br/>
end_txn(&amp;d,&#160;[txn.pk_c,&#160;txn.pk_r],&#160;[caller,&#160;recipient]);<br/>
where&#160;<i>I&#160;</i>is&#160;a&#160;number&#160;of&#160;inputs&#160;and&#160;outputs&#160;to&#160;the&#160;computation.<br/>
return&#160;d;<br/>
Observe&#160;that&#160;the&#160;cost&#160;of&#160;verifying&#160;a&#160;proof&#160;is&#160;independent&#160;of<br/>
}<br/>
the&#160;complexity&#160;of&#160;the&#160;computation&#160;for&#160;which&#160;the&#160;proof&#160;is&#160;pro-<br/>duced.&#160;Furthermore,&#160;our&#160;design&#160;limits&#160;the&#160;size&#160;of&#160;inputs&#160;and<br/>
FIGURE&#160;3—Pseudocode&#160;for&#160;ERC-20’s&#160;create&#160;and&#160;transfer&#160;op-<br/>
outputs&#160;of&#160;a&#160;computation&#160;using&#160;GetBlock/PutBlock&#160;APIs,<br/>
erations&#160;using&#160;Piperine’s&#160;API.&#160;We&#160;abstract&#160;details&#160;of&#160;the&#160;use&#160;of&#160;block<br/>
so&#160;<i>I&#160;</i>is&#160;a&#160;constant&#160;in&#160;our&#160;context.&#160;However,&#160;the&#160;veriﬁer&#160;incurs<br/>
store&#160;and&#160;internal&#160;details&#160;of&#160;signature&#160;veriﬁcation.&#160;Other&#160;ERC-20<br/>
a&#160;cost&#160;linear&#160;in&#160;the&#160;number&#160;of&#160;hash&#160;operations,&#160;as&#160;it&#160;uses&#160;the<br/>
operations&#160;are&#160;programmed&#160;similarly.<br/>
block&#160;store&#160;optimization&#160;(which,&#160;recall,&#160;replaces&#160;exponentia-<br/>tions&#160;with&#160;hash&#160;operations).&#160;In&#160;our&#160;context,&#160;the&#160;hash&#160;function<br/>
library&#160;for&#160;signature&#160;veriﬁcation,&#160;etc.&#160;This&#160;adds&#160;about&#160;375<br/>
is&#160;MiMC,&#160;which&#160;we&#160;implement&#160;using&#160;the&#160;EVM’s&#160;primitive<br/>
SLOC&#160;to&#160;Spice.&#160;We&#160;implement&#160;the&#160;additional&#160;portions&#160;of<br/>
modulo&#160;operations&#160;along&#160;with&#160;custom&#160;assembly.&#160;The&#160;resulting<br/>
Piperine’s&#160;veriﬁer&#160;(§3.2;&#160;batching&#160;paragraph)&#160;in&#160;Python,&#160;along<br/>
cost&#160;of&#160;a&#160;hash&#160;operation&#160;is&#160;<i>≈&#160;</i>200&#160;gas/byte.&#160;Our&#160;functions&#160;to<br/>
with&#160;orchestration&#160;for&#160;execution&#160;on&#160;our&#160;cluster,&#160;in&#160;about&#160;725<br/>
update&#160;set-digests&#160;are&#160;implemented&#160;directly&#160;with&#160;mulmod&#160;and<br/>
lines&#160;of&#160;Python.&#160;This&#160;code&#160;parallelizes&#160;the&#160;prover’s&#160;work<br/>
addmod,&#160;directly&#160;ported&#160;from&#160;the&#160;C&#160;implementation.<br/>
(executing&#160;transactions,&#160;producing&#160;proofs,&#160;etc.).<br/>
To&#160;demonstrate&#160;Piperine&#160;in&#160;action,&#160;we&#160;implement&#160;a&#160;pay-<br/>
5<br/>
Implementation<br/>
ment&#160;processing&#160;service&#160;with&#160;a&#160;standardized&#160;interface&#160;(called<br/>
We&#160;build&#160;Piperine&#160;atop&#160;Spice&#160;[73],&#160;which&#160;provides&#160;a&#160;compiler<br/>
an&#160;ERC-20&#160;token&#160;[79])&#160;using&#160;380&#160;lines&#160;of&#160;C.&#160;Although&#160;we<br/>
from&#160;a&#160;subset&#160;of&#160;C&#160;augmented&#160;with&#160;storage&#160;primitives&#160;to<br/>
implement&#160;our&#160;approach&#160;for&#160;only&#160;one&#160;contract,&#160;ERC-20&#160;is&#160;a<br/>
algebraic&#160;constraints.&#160;For&#160;producing&#160;succinct&#160;cryptographic<br/>
popular&#160;standardized&#160;interface&#160;for&#160;contracts,&#160;whose&#160;implemen-<br/>
proofs,&#160;it&#160;invokes&#160;libsnark&#160;[57],&#160;an&#160;implementation&#160;of&#160;a<br/>
tations&#160;account&#160;for&#160;over&#160;50%&#160;of&#160;transactions&#160;on&#160;Ethereum&#160;[33].<br/>
state-of-the-art&#160;proof&#160;machinery&#160;[47].&#160;We&#160;extend&#160;Spice&#160;with<br/>
Figure&#160;3&#160;depicts&#160;pseudocode&#160;for&#160;various&#160;state&#160;transitions<br/>
techniques&#160;described&#160;in&#160;Section&#160;3&#160;including&#160;ΨΔ,&#160;a&#160;high-speed<br/>
in&#160;the&#160;payment&#160;state&#160;machine.&#160;The&#160;main&#160;transaction&#160;is&#160;the<br/>transfer,&#160;which&#160;moves&#160;fungible&#160;tokens&#160;between&#160;two&#160;ac-<br/>
3The&#160;curve&#160;is&#160;deﬁned&#160;in&#160;Section&#160;3.2,&#160;and&#160;has&#160;parameters&#160;of&#160;similar&#160;size&#160;to<br/>
Ethereum’s&#160;secp256k1,&#160;so&#160;it&#160;provides&#160;a&#160;similar&#160;security.<br/>
counts.&#160;To&#160;apply&#160;Piperine&#160;to&#160;Ethereum,&#160;we&#160;implement&#160;the<br/>
<hr/>
<a name=10></a>veriﬁer&#160;as&#160;a&#160;smart&#160;contract&#160;in&#160;Solidity,&#160;a&#160;language&#160;for&#160;writ-<br/>ing&#160;state&#160;machines.&#160;In&#160;particular,&#160;we&#160;implement&#160;machinery<br/>
&#160;120<br/>
for&#160;verifying&#160;cryptographic&#160;proofs&#160;(which&#160;builds&#160;on&#160;an&#160;open-<br/>
&#160;100<br/>
source&#160;library&#160;[70]&#160;for&#160;elliptic&#160;curve&#160;pairings)&#160;and&#160;the&#160;MiMC<br/>
&#160;80<br/>
hash&#160;function&#160;in&#160;500&#160;lines&#160;of&#160;Solidity.<br/>
&#160;60<br/>
Prover time<br/>
&#160;40<br/>
(μs / constraint)<br/>
&#160;20<br/>
6<br/>
Evaluation<br/>
&#160;0<br/>
212<br/>
214<br/>
216<br/>
218<br/>
220<br/>
222<br/>
Our&#160;experimental&#160;evaluation&#160;of&#160;Piperine&#160;answers&#160;the&#160;follow-<br/>
Number of Constraints<br/>
ing&#160;questions:<br/>
FIGURE&#160;4—Proof&#160;generation&#160;costs&#160;per&#160;constraint&#160;the&#160;number&#160;of&#160;con-<br/>
1.&#160;What&#160;are&#160;the&#160;beneﬁts&#160;of&#160;Piperine’s&#160;techniques&#160;on&#160;end-to-<br/>
straints&#160;in&#160;a&#160;computation&#160;Ψ&#160;varies.&#160;The&#160;solid&#160;curve&#160;is&#160;1150<i>μs/&#160;</i>log(<i>n</i>),<br/>suggested&#160;by&#160;the&#160;<i>n/&#160;</i>log(<i>n</i>)&#160;cost&#160;of&#160;multi-exponentiation&#160;algorithms.<br/>
end&#160;costs&#160;of&#160;the&#160;prover&#160;and&#160;the&#160;veriﬁer&#160;in&#160;VSMs?<br/>
2.&#160;What&#160;are&#160;the&#160;regimes&#160;in&#160;which&#160;delegation&#160;via&#160;veriﬁable<br/>
6.1<br/>
Beneﬁts&#160;of&#160;Piperine’s&#160;techniques<br/>
state&#160;machines&#160;is&#160;better&#160;than&#160;local&#160;reexecution?<br/>
To&#160;answer&#160;the&#160;ﬁrst&#160;question,&#160;we&#160;ﬁrst&#160;experimentally&#160;establish<br/>
3.&#160;Does&#160;Piperine&#160;reduce&#160;costs&#160;in&#160;large-scale&#160;RSMs?<br/>
that,&#160;in&#160;Piperine,&#160;the&#160;prover’s&#160;costs&#160;depend&#160;primarily&#160;on&#160;the<br/>
Methodology&#160;and&#160;baselines.&#160;We&#160;report&#160;our&#160;results&#160;in&#160;the<br/>
number&#160;of&#160;constraints.&#160;Thus,&#160;we&#160;can&#160;evaluate&#160;the&#160;beneﬁts&#160;of<br/>
context&#160;of&#160;a&#160;state&#160;machine&#160;for&#160;processing&#160;payment&#160;transac-<br/>
our&#160;signature&#160;optimization&#160;by&#160;measuring&#160;their&#160;impact&#160;on&#160;the<br/>
tions&#160;(§5).&#160;To&#160;answer&#160;the&#160;ﬁrst&#160;question,&#160;we&#160;measure&#160;the&#160;impact<br/>
number&#160;of&#160;constraints&#160;generated.<br/>
of&#160;our&#160;reﬁnements&#160;(described&#160;in&#160;§3)&#160;on&#160;the&#160;prover’s&#160;and&#160;veri-<br/>
The&#160;two&#160;principal&#160;costs&#160;to&#160;generate&#160;a&#160;proof&#160;for&#160;a&#160;com-<br/>
ﬁer’s&#160;CPU&#160;costs.&#160;To&#160;answer&#160;the&#160;second&#160;question,&#160;we&#160;consider<br/>
putation&#160;with&#160;<i>n&#160;</i>constraints&#160;in&#160;Piperine&#160;are&#160;several&#160;multi-<br/>
a&#160;baseline&#160;state&#160;machine&#160;that&#160;executes&#160;the&#160;above&#160;state&#160;ma-<br/>
exponentiations&#160;of&#160;size&#160;<i>n&#160;</i>in&#160;a&#160;pairing-friendly&#160;elliptic&#160;curve<br/>
chine’s&#160;payment&#160;transactions&#160;by&#160;just&#160;authenticating&#160;them&#160;(i.e.,<br/>
and&#160;an&#160;FFT&#160;of&#160;size&#160;<i>n&#160;</i>over&#160;the&#160;ﬁeld&#160;of&#160;scalars&#160;[15,&#160;18,&#160;24,<br/>
it&#160;does&#160;not&#160;execute&#160;transitions&#160;in&#160;entirety,&#160;which&#160;is&#160;pessimistic<br/>
47,&#160;67,&#160;81,&#160;83].&#160;Using&#160;standard&#160;algorithms,&#160;such&#160;a&#160;multi-<br/>
to&#160;Piperine).&#160;We&#160;implement&#160;the&#160;optimistic&#160;baseline&#160;using<br/>
exponentiation&#160;takes&#160;<i>O</i>(<i>n/&#160;</i>log&#160;<i>n</i>)&#160;time,&#160;whilst&#160;the&#160;FFT&#160;takes<br/>
libsodium&#160;[38],&#160;a&#160;high-speed&#160;cryptographic&#160;library.&#160;We&#160;re-<br/>
<i>O</i>(<i>n&#160;</i>log&#160;<i>n</i>)&#160;time.&#160;For&#160;computations&#160;used&#160;in&#160;our&#160;evaluation,<br/>
port&#160;the&#160;per-transaction&#160;costs&#160;in&#160;terms&#160;of&#160;CPU&#160;and&#160;network<br/>
we&#160;measure&#160;<i>P</i>’s&#160;CPU-time&#160;per&#160;constraint.&#160;Figure&#160;4&#160;depicts<br/>
costs&#160;for&#160;a&#160;system&#160;with&#160;and&#160;without&#160;Piperine.<br/>
our&#160;results&#160;that&#160;conﬁrm&#160;that&#160;<i>P</i>’s&#160;CPU-time&#160;scales&#160;roughly&#160;as<br/>
To&#160;answer&#160;the&#160;last&#160;question,&#160;we&#160;compare&#160;Piperine-enhanced<br/>
<i>O</i>(<i>n/&#160;</i>log&#160;<i>n</i>),&#160;which&#160;is&#160;consistent&#160;with&#160;the&#160;theoretical&#160;predic-<br/>
Ethereum&#160;to&#160;native&#160;Ethereum,&#160;in&#160;both&#160;cases&#160;implementing&#160;the<br/>
tion&#160;that&#160;the&#160;prover&#160;is&#160;bottlenecked&#160;by&#160;multiexponentiations.<br/>
above&#160;state&#160;machine.&#160;For&#160;this,&#160;we&#160;report&#160;end-to-end&#160;costs&#160;of<br/>
This&#160;experiment&#160;also&#160;conﬁrms&#160;the&#160;beneﬁts&#160;of&#160;our&#160;batching<br/>
the&#160;two&#160;variants&#160;by&#160;using&#160;a&#160;uniﬁed&#160;metric&#160;(that&#160;accounts&#160;for<br/>
optimization&#160;(§3.2)&#160;on&#160;the&#160;prover’s&#160;costs.<br/>
network,&#160;storage,&#160;and&#160;CPU&#160;costs).&#160;We&#160;also&#160;report&#160;the&#160;size&#160;of<br/>
Effect&#160;of&#160;signature&#160;optimizations.&#160;To&#160;examine&#160;the&#160;impact<br/>
a&#160;transaction&#160;in&#160;bytes&#160;in&#160;both&#160;cases.<br/>
of&#160;signature&#160;optimizations&#160;in&#160;Piperine,&#160;we&#160;measure&#160;the&#160;num-<br/>
Setup.&#160;We&#160;use&#160;a&#160;cluster&#160;of&#160;Azure&#160;D64s&#160;v3&#160;instances&#160;(32<br/>
ber&#160;of&#160;constraints&#160;needed&#160;for&#160;a&#160;transfer&#160;state&#160;transition&#160;(to<br/>
physical&#160;cores,&#160;2.30&#160;GHz&#160;Intel&#160;Xeon&#160;E5-2673&#160;v4,&#160;256&#160;GB<br/>
transfer&#160;currency&#160;from&#160;one&#160;account&#160;to&#160;another)&#160;over&#160;the&#160;course<br/>
RAM)&#160;running&#160;Ubuntu&#160;18.04.&#160;We&#160;measure&#160;CPU-time&#160;for<br/>
of&#160;several&#160;rounds&#160;of&#160;optimization.&#160;This&#160;metric&#160;is&#160;directly&#160;pro-<br/>
the&#160;prover&#160;<i>P&#160;</i>and&#160;a&#160;veriﬁer&#160;<i>V</i>.&#160;We&#160;run&#160;parallel&#160;instances&#160;of<br/>
duced&#160;as&#160;a&#160;part&#160;of&#160;the&#160;process&#160;of&#160;compiling&#160;transfer&#160;with<br/>
<i>P&#160;</i>on&#160;as&#160;many&#160;physical&#160;cores&#160;as&#160;are&#160;available,&#160;and&#160;compute<br/>
our&#160;toolchain.&#160;Figure&#160;5&#160;depicts&#160;our&#160;results.&#160;As&#160;can&#160;be&#160;seen,<br/>
totals&#160;across&#160;all&#160;instances.&#160;We&#160;restrict&#160;the&#160;native&#160;<i>V&#160;</i>to&#160;a&#160;single<br/>
these&#160;optimizations&#160;reduce&#160;the&#160;number&#160;of&#160;constraints&#160;by&#160;up<br/>
physical&#160;core&#160;for&#160;ease&#160;of&#160;comparison&#160;to&#160;the&#160;baselines,&#160;which<br/>
to&#160;1000<i>×</i>.&#160;Our&#160;individual&#160;techniques&#160;reduce&#160;the&#160;number&#160;of<br/>
are&#160;single-threaded&#160;in&#160;each&#160;case.<br/>
constraints&#160;required&#160;by&#160;<i>≈&#160;</i>2<i>×&#160;</i>compared&#160;to&#160;a&#160;baseline&#160;depicted<br/>
To&#160;compare&#160;to&#160;the&#160;ERC-20&#160;baseline,&#160;we&#160;run&#160;Piperine<br/>
on&#160;the&#160;second&#160;line.&#160;While&#160;the&#160;latter&#160;is&#160;a&#160;modest&#160;improvement,<br/>
against&#160;a&#160;private&#160;instance&#160;of&#160;the&#160;Ethereum&#160;RSM,&#160;using&#160;the<br/>
it&#160;directly&#160;impacts&#160;the&#160;number&#160;of&#160;replicas&#160;needed&#160;to&#160;amortize<br/>
Web3&#160;Python&#160;library&#160;[3]&#160;for&#160;interaction&#160;and&#160;the&#160;Ganache<br/>
the&#160;prover’s&#160;costs,&#160;in&#160;the&#160;context&#160;of&#160;RSMs&#160;(so&#160;any&#160;reﬁnement<br/>
suite&#160;[2]&#160;for&#160;deployment.&#160;We&#160;measure&#160;gas&#160;consumption&#160;of&#160;the<br/>
to&#160;reduce&#160;the&#160;prover’s&#160;costs&#160;is&#160;valuable).<br/>
veriﬁer&#160;and&#160;the&#160;size&#160;in&#160;bytes&#160;of&#160;signed&#160;transactions&#160;using&#160;the<br/>
Effect&#160;of&#160;using&#160;a&#160;block&#160;store.&#160;To&#160;examine&#160;the&#160;impact&#160;of&#160;re-<br/>
Web3&#160;API.&#160;We&#160;measure&#160;CPU-time&#160;of&#160;the&#160;prover&#160;from&#160;the&#160;sys-<br/>
placing&#160;modular&#160;exponentiations&#160;with&#160;hashing&#160;in&#160;Piperine,&#160;we<br/>
tem&#160;clock.&#160;Finally,&#160;we&#160;measure&#160;network&#160;costs&#160;by&#160;measuring<br/>
compile&#160;a&#160;state&#160;machine&#160;that&#160;performs&#160;transfer&#160;operations<br/>
the&#160;number&#160;of&#160;bytes&#160;transmitted&#160;from&#160;Piperine’s&#160;prover&#160;to&#160;the<br/>
at&#160;a&#160;range&#160;of&#160;batch&#160;sizes,&#160;with&#160;and&#160;without&#160;the&#160;optimization.<br/>
veriﬁer&#160;(in&#160;case&#160;of&#160;Piperine)&#160;and&#160;by&#160;measuring&#160;the&#160;number&#160;of<br/>
The&#160;batch&#160;size&#160;parameter&#160;does&#160;not&#160;impact&#160;the&#160;improvements,<br/>
bytes&#160;in&#160;a&#160;raw&#160;transaction&#160;(in&#160;case&#160;of&#160;our&#160;baselines).<br/>
so&#160;we&#160;report&#160;results&#160;for&#160;a&#160;batch&#160;size&#160;of&#160;64&#160;transactions.&#160;Fig-<br/>
<hr/>
<a name=11></a>#&#160;of&#160;constraints<br/>
batch&#160;size<br/>
baseline<br/>
veriﬁer<br/>
prover<br/>
cross-over<br/>
naive<br/>
<i>&gt;&#160;</i>107<br/>
(#txns)<br/>
(<i>μ</i>s/txn)<br/>
(<i>μ</i>s/txn)<br/>
(s/txn)<br/>
(#replicas)<br/>
careful&#160;choice&#160;of&#160;cryptographic&#160;parameters<br/>
20414<br/>
1<br/>
120<br/>
3799<br/>
1.34<br/>
–<br/>
+&#160;double-scalar&#160;multiplication<br/>
17080<br/>
4<br/>
116<br/>
931<br/>
1.02<br/>
–<br/>
+&#160;windowing<br/>
16451<br/>
16<br/>
115<br/>
275<br/>
0.88<br/>
–<br/>
+&#160;mod&#160;<i>N&#160;</i>arithmetic<br/>
12574<br/>
64<br/>
118<br/>
107<br/>
0.79<br/>
68365<br/>
+&#160;limb&#160;optimization<br/>
11249<br/>
256<br/>
118<br/>
63<br/>
0.78<br/>
14280<br/>
1024<br/>
117<br/>
42<br/>
0.75<br/>
10072<br/>
FIGURE&#160;5—Cost&#160;of&#160;a&#160;transfer&#160;operation,&#160;in&#160;terms&#160;of&#160;number&#160;of<br/>algebraic&#160;constraints,&#160;in&#160;Piperine&#160;with&#160;host&#160;of&#160;optimizations&#160;to&#160;the<br/>
FIGURE&#160;7—The&#160;per-transaction&#160;CPU&#160;cost&#160;of&#160;the&#160;prover,&#160;the&#160;veriﬁer,<br/>
signature&#160;veriﬁcation&#160;algorithm.&#160;Each&#160;line&#160;depicts&#160;an&#160;optimization<br/>
and&#160;the&#160;baseline&#160;with&#160;varying&#160;batch&#160;sizes.&#160;We&#160;also&#160;depict&#160;cross-<br/>
atop&#160;its&#160;prior&#160;line&#160;and&#160;the&#160;resulting&#160;number&#160;of&#160;constraints.<br/>
over&#160;points:&#160;the&#160;number&#160;of&#160;replicas&#160;needed&#160;to&#160;make&#160;the&#160;Piperine-<br/>enhanced&#160;RSM&#160;(including&#160;the&#160;prover’s&#160;costs)&#160;to&#160;incur&#160;lower&#160;CPU<br/>
prover&#160;(x86)<br/>
veriﬁer&#160;(x86)<br/>
veriﬁer&#160;(Eth)<br/>
costs&#160;than&#160;a&#160;replicated&#160;baseline.&#160;The&#160;veriﬁer&#160;beneﬁts&#160;signiﬁcantly<br/>
(s&#160;/&#160;txn)<br/>
(<i>μ</i>s&#160;/&#160;txn)<br/>
(gas&#160;/&#160;txn)<br/>
from&#160;batching&#160;while&#160;the&#160;prover’s&#160;gains&#160;are&#160;modest.&#160;Beyond&#160;batch<br/>size&#160;of&#160;64,&#160;Piperine-enhanced&#160;RSM&#160;is&#160;cheaper&#160;than&#160;the&#160;baseline.<br/>
w/o&#160;block&#160;store<br/>
0.79<br/>
107<br/>
13241<br/>
w/&#160;block&#160;store<br/>
0.84<br/>
104<br/>
9301<br/>
batch&#160;size<br/>
baseline<br/>
Piperine<br/>
savings<br/>
FIGURE&#160;6—Effects&#160;of&#160;the&#160;block&#160;store&#160;optimization&#160;on&#160;the&#160;CPU<br/>
(#txns)<br/>
(bytes)<br/>
(bytes)<br/>
(<i>×</i>)<br/>
costs&#160;of&#160;the&#160;prover&#160;and&#160;the&#160;veriﬁer&#160;(batch&#160;size&#160;is&#160;64).&#160;The&#160;veriﬁer&#160;on<br/>
1<br/>
224<br/>
588<br/>
–<br/>
Ethereum&#160;beneﬁts&#160;signiﬁcantly&#160;while&#160;slightly&#160;increasing&#160;the&#160;prover’s<br/>
4<br/>
224<br/>
259<br/>
–<br/>
costs.&#160;The&#160;veriﬁer&#160;on&#160;x86&#160;beneﬁts&#160;only&#160;slightly&#160;(see&#160;text).<br/>
16<br/>
224<br/>
147<br/>
1.5<br/>
64<br/>
224<br/>
132<br/>
1.7<br/>
ure&#160;6&#160;depicts&#160;the&#160;per-transaction&#160;CPU&#160;costs&#160;for&#160;the&#160;prover&#160;and<br/>
256<br/>
224<br/>
129<br/>
1.7<br/>
the&#160;veriﬁer;&#160;we&#160;also&#160;report&#160;gas&#160;required&#160;to&#160;execute&#160;the&#160;veriﬁer<br/>
1024<br/>
224<br/>
80<br/>
2.8<br/>
running&#160;as&#160;a&#160;smart&#160;contract&#160;on&#160;Ethereum.&#160;As&#160;can&#160;be&#160;seen,&#160;for<br/>
FIGURE&#160;8—The&#160;per-transaction&#160;network&#160;costs&#160;of&#160;Piperine&#160;and&#160;the<br/>
the&#160;Ethereum&#160;veriﬁer,&#160;the&#160;costs&#160;are&#160;reduced&#160;by&#160;<i>≈&#160;</i>3.3<i>×</i>,&#160;whilst<br/>
baseline&#160;with&#160;varying&#160;batch&#160;sizes.&#160;At&#160;the&#160;largest&#160;batch&#160;size,&#160;the&#160;per-<br/>
the&#160;cost&#160;for&#160;the&#160;prover&#160;does&#160;not&#160;increase&#160;substantially.&#160;The<br/>
transaction&#160;network&#160;costs&#160;to&#160;propagate&#160;a&#160;transaction&#160;to&#160;the&#160;replicated<br/>
veriﬁer&#160;on&#160;x86&#160;does&#160;not&#160;beneﬁt&#160;from&#160;the&#160;optimization.&#160;This<br/>
system&#160;is&#160;2.8<i>×&#160;</i>lower&#160;in&#160;Piperine&#160;than&#160;the&#160;baseline.<br/>
is&#160;because&#160;the&#160;cost&#160;of&#160;multi-exponentiation&#160;is&#160;<i>O</i>(<i>n/&#160;</i>log&#160;<i>n</i>),<br/>
whilst&#160;the&#160;cost&#160;of&#160;hashing&#160;for&#160;the&#160;block&#160;store&#160;is&#160;<i>O</i>(<i>n</i>)&#160;with&#160;a<br/>
the&#160;baseline.&#160;At&#160;large&#160;batch&#160;sizes,&#160;the&#160;veriﬁer’s&#160;CPU&#160;costs&#160;are<br/>
smaller&#160;implied&#160;constant.&#160;However,&#160;for&#160;larger&#160;input&#160;sizes,&#160;we<br/>
lower&#160;than&#160;that&#160;of&#160;the&#160;baseline&#160;by&#160;about&#160;2.7<i>×</i>.&#160;Although&#160;the<br/>
expect&#160;the&#160;block&#160;store&#160;optimization&#160;to&#160;provide&#160;a&#160;beneﬁt.<br/>
prover’s&#160;CPU&#160;costs&#160;are&#160;<i>≈&#160;</i>6,300–11,000<i>×&#160;</i>higher&#160;than&#160;that<br/>of&#160;the&#160;baseline,&#160;there&#160;exists&#160;a&#160;cross-over&#160;point&#160;(in&#160;terms&#160;of<br/>
6.2<br/>
Beneﬁts&#160;of&#160;Piperine&#160;for&#160;delegating&#160;state&#160;machines<br/>
the&#160;number&#160;of&#160;replicas&#160;in&#160;an&#160;RSM)&#160;at&#160;which&#160;the&#160;CPU&#160;cost&#160;of<br/>
We&#160;now&#160;assess&#160;the&#160;regimes&#160;in&#160;which&#160;it&#160;is&#160;cheaper&#160;to&#160;employ<br/>
the&#160;prover&#160;and&#160;the&#160;replicated&#160;veriﬁer&#160;is&#160;lower&#160;than&#160;the&#160;CPU<br/>
delegation&#160;than&#160;naive&#160;reexecution&#160;in&#160;RSMs.&#160;Our&#160;focus&#160;here<br/>
cost&#160;of&#160;the&#160;replicated&#160;baseline.&#160;With&#160;a&#160;batch&#160;size&#160;of&#160;1024,&#160;the<br/>
is&#160;on&#160;resource&#160;costs&#160;(CPU&#160;and&#160;network&#160;costs)&#160;and&#160;cross-over<br/>
cross-over&#160;point&#160;is&#160;about&#160;10,000&#160;replicas.<br/>
points&#160;(the&#160;number&#160;of&#160;replicas&#160;necessary&#160;to&#160;make&#160;the&#160;total<br/>
Network&#160;costs.&#160;Figure&#160;8&#160;depicts&#160;the&#160;size&#160;of&#160;a&#160;transaction<br/>
cost&#160;of&#160;the&#160;Piperine-enhanced&#160;RSM,&#160;including&#160;the&#160;prover’s<br/>
processed&#160;by&#160;the&#160;RSM&#160;in&#160;Piperine&#160;and&#160;the&#160;baseline.&#160;Beyond&#160;a<br/>
costs,&#160;to&#160;be&#160;cheaper&#160;than&#160;a&#160;baseline&#160;RSM).<br/>
batch&#160;size&#160;of&#160;16,&#160;Piperine&#160;always&#160;incurs&#160;lower&#160;network&#160;costs<br/>
We&#160;run&#160;Piperine&#160;and&#160;our&#160;baseline&#160;on&#160;a&#160;synthetic&#160;workload<br/>
than&#160;the&#160;baseline.&#160;This&#160;is&#160;because&#160;Piperine&#160;compresses&#160;each<br/>
of&#160;create&#160;and&#160;transfer&#160;operations,&#160;modeled&#160;on&#160;the&#160;trans-<br/>
transaction&#160;to&#160;a&#160;hash&#160;and&#160;a&#160;minimal&#160;speciﬁcation&#160;of&#160;its&#160;impact<br/>
action&#160;history&#160;of&#160;a&#160;popular&#160;ERC-20&#160;token&#160;[25].&#160;For&#160;Piperine,<br/>
on&#160;the&#160;state.&#160;At&#160;a&#160;batch&#160;size&#160;of&#160;1024,&#160;the&#160;savings&#160;are&#160;a&#160;factor<br/>
we&#160;experiment&#160;with&#160;a&#160;range&#160;of&#160;batch&#160;sizes&#160;for&#160;transfer<br/>
of&#160;2.8,&#160;which&#160;can&#160;be&#160;signiﬁcant&#160;in&#160;blockchains&#160;[36].<br/>
and&#160;measure&#160;the&#160;per-transaction&#160;CPU&#160;costs&#160;to&#160;the&#160;prover&#160;and<br/>the&#160;veriﬁer,&#160;and&#160;to&#160;our&#160;baseline.&#160;We&#160;also&#160;measure&#160;the&#160;size<br/>
6.3<br/>
Beneﬁts&#160;of&#160;Piperine&#160;for&#160;large-scale&#160;RSMs<br/>
of&#160;a&#160;transaction&#160;(in&#160;bytes)&#160;processed&#160;by&#160;the&#160;replicated&#160;state<br/>
To&#160;answer&#160;the&#160;third&#160;question,&#160;we&#160;run&#160;a&#160;set&#160;of&#160;experiments<br/>
machine&#160;under&#160;Piperine&#160;and&#160;the&#160;baseline.<br/>
similar&#160;to&#160;the&#160;previous&#160;subsection,&#160;except&#160;that&#160;we&#160;experiment<br/>
CPU&#160;costs&#160;and&#160;cross-over&#160;points.&#160;Figure&#160;7&#160;depicts&#160;the&#160;per-<br/>
with&#160;the&#160;Piperine&#160;veriﬁer&#160;running&#160;as&#160;a&#160;smart&#160;contract.&#160;Further-<br/>
transaction&#160;CPU&#160;costs&#160;of&#160;the&#160;prover,&#160;the&#160;veriﬁer,&#160;and&#160;the<br/>
more,&#160;instead&#160;of&#160;an&#160;optimistic&#160;baseline&#160;based&#160;on&#160;libsodium,<br/>
baseline&#160;for&#160;varying&#160;batch&#160;sizes.&#160;As&#160;expected,&#160;the&#160;baseline<br/>
the&#160;baseline&#160;here&#160;is&#160;an&#160;ERC-20&#160;smart&#160;contract&#160;[79].<br/>
CPU&#160;cost&#160;does&#160;not&#160;decrease&#160;with&#160;batch&#160;size&#160;whereas&#160;the<br/>
End-to-end&#160;per-transaction&#160;costs&#160;in&#160;gas&#160;and&#160;USD.&#160;Be-<br/>
veriﬁer&#160;beneﬁts&#160;signiﬁcantly&#160;from&#160;batching.&#160;Furthermore,&#160;for<br/>
sides&#160;the&#160;metrics&#160;used&#160;in&#160;the&#160;last&#160;subsection&#160;(CPU&#160;costs,<br/>
batch&#160;sizes&#160;<i>≥&#160;</i>64&#160;the&#160;Piperine&#160;<i>V&#160;</i>has&#160;lower&#160;CPU&#160;costs&#160;than<br/>
network&#160;transfers,&#160;etc.),&#160;we&#160;use&#160;an&#160;additional&#160;metric—<br/>
<hr/>
<a name=12></a>Ethereum’s&#160;gas&#160;(§4)—that&#160;captures&#160;the&#160;end-to-end&#160;costs&#160;of<br/>
computation&#160;costs<br/>
the&#160;prover&#160;and&#160;the&#160;veriﬁer&#160;in&#160;a&#160;uniﬁed&#160;manner.&#160;Although&#160;the<br/>
instances<br/>
prover<br/>
veriﬁer<br/>
total<br/>
network<br/>
prover&#160;runs&#160;on&#160;a&#160;cluster&#160;of&#160;machines&#160;in&#160;the&#160;cloud&#160;and&#160;billed<br/>
(#)<br/>
(s)<br/>
(gas)<br/>
(USD)<br/>
(bytes)<br/>
in&#160;USD&#160;for&#160;the&#160;total&#160;machine&#160;cost&#160;(CPU,&#160;network,&#160;storage,<br/>
batch&#160;Ψ<i>transfer&#160;</i>512<br/>
677.79<br/>
5561726<br/>
$5.6<br/>
35888<br/>
etc.),&#160;the&#160;prover’s&#160;cost&#160;can&#160;be&#160;converted&#160;to&#160;gas&#160;because&#160;gas&#160;is<br/>
chunk&#160;Ψ<i>audit</i><br/>
15<br/>
605.93<br/>
293377<br/>
$0.33<br/>
720<br/>
fungible&#160;in&#160;USD.&#160;It&#160;might&#160;seem&#160;that&#160;this&#160;conversion&#160;must&#160;be<br/>
chunk&#160;ΨΔ<br/>
389<br/>
60.67<br/>
6448764<br/>
$6.44<br/>
43856<br/>
done&#160;with&#160;care&#160;since&#160;the&#160;exchange&#160;rate&#160;between&#160;gas&#160;and&#160;USD<br/>
Piperine&#160;(/txn)<br/>
0.67<br/>
9518<br/>
0.96¢<br/>
62.9<br/>
is&#160;highly&#160;volatile.&#160;Since&#160;2017,&#160;the&#160;daily&#160;average&#160;price&#160;for&#160;106<br/>
baseline&#160;(/txn)<br/>
0<br/>
51668<br/>
5.17¢<br/>
170<br/>
gas&#160;has&#160;varied&#160;between&#160;$0.80&#160;and&#160;$100,&#160;with&#160;intra-day&#160;volatil-<br/>ity&#160;of&#160;<i>≥&#160;</i>10<i>×</i>.&#160;As&#160;shown&#160;below,&#160;perhaps&#160;surprisingly,&#160;picking<br/>
FIGURE&#160;9—The&#160;costs&#160;of&#160;the&#160;prover,&#160;the&#160;veriﬁer,&#160;and&#160;the&#160;baseline<br/>
any&#160;rate&#160;in&#160;the&#160;above&#160;range&#160;does&#160;not&#160;signiﬁcantly&#160;affect&#160;our<br/>
along&#160;with&#160;network&#160;costs&#160;under&#160;Piperine&#160;and&#160;the&#160;baseline.&#160;As&#160;noted,<br/>
results.&#160;This&#160;is&#160;because&#160;the&#160;total&#160;cost&#160;of&#160;a&#160;Piperine-enhanced<br/>
we&#160;assume&#160;106&#160;gas&#160;costs&#160;$1;&#160;the&#160;prover’s&#160;costs&#160;are&#160;based&#160;on&#160;a&#160;ma-<br/>
ERC-20&#160;contract&#160;is&#160;dominated&#160;by&#160;the&#160;veriﬁer’s&#160;gas&#160;costs,&#160;so<br/>
chine&#160;cost&#160;of&#160;20.9¢/hour&#160;as&#160;reported&#160;by&#160;the&#160;cloud&#160;provider.<br/>
the&#160;prover’s&#160;costs&#160;in&#160;USD&#160;(when&#160;converted&#160;to&#160;gas)&#160;do&#160;not<br/>substantially&#160;affect&#160;the&#160;end-to-end&#160;costs&#160;of&#160;the&#160;system.&#160;Below,<br/>
of&#160;gas,&#160;so&#160;Piperine’s&#160;reduction&#160;in&#160;per-transaction&#160;gas&#160;directly<br/>
we&#160;conservatively&#160;assume&#160;an&#160;exchange&#160;rate&#160;of&#160;$1&#160;for&#160;106&#160;gas.<br/>
translates&#160;to&#160;an&#160;increased&#160;number&#160;of&#160;transactions&#160;in&#160;each&#160;block<br/>
In&#160;this&#160;experiment,&#160;the&#160;prover&#160;processes&#160;about&#160;0.5&#160;million<br/>
(improving&#160;Ethereum’s&#160;throughput).&#160;While&#160;Ethereum&#160;can<br/>
ERC-20&#160;transfer&#160;transactions&#160;(in&#160;batches&#160;where&#160;each&#160;batch<br/>
pack&#160;<i>≈&#160;</i>150&#160;ERC-20&#160;transactions/block,&#160;Piperine-enhanced<br/>
is&#160;of&#160;size&#160;1,100&#160;transactions).&#160;The&#160;prover&#160;then&#160;produces&#160;a<br/>
ERC-20&#160;can&#160;pack&#160;<i>≈&#160;</i>850&#160;transactions/block.<br/>
<i>πaudit&#160;</i>by&#160;performing&#160;a&#160;linear&#160;scan&#160;over&#160;the&#160;entire&#160;state,&#160;which<br/>in&#160;our&#160;workload&#160;is&#160;about&#160;<i>≈&#160;</i>175,000&#160;key-value&#160;tuples&#160;(i.e.,<br/>
7<br/>
Related&#160;work<br/>
account&#160;balances);&#160;the&#160;prover&#160;uses&#160;a&#160;chunk&#160;size&#160;of&#160;12,288<br/>
A&#160;set&#160;of&#160;works&#160;achieve&#160;higher&#160;throughput&#160;on&#160;blockchains&#160;by<br/>
tuples&#160;to&#160;produce&#160;<i>πaudit&#160;</i>in&#160;parallel&#160;(§3.2).&#160;The&#160;prover&#160;also<br/>
changing&#160;the&#160;underlying&#160;consensus&#160;protocol,&#160;assumptions,<br/>
produces&#160;a&#160;<i>π</i>Δ,&#160;which&#160;in&#160;our&#160;experiment&#160;emits&#160;the&#160;entire<br/>
or&#160;guarantees.&#160;Bitcoin-NG&#160;[41]&#160;increases&#160;Bitcoin’s&#160;through-<br/>
state&#160;(the&#160;chunk&#160;size&#160;here&#160;is&#160;450&#160;state&#160;changes).&#160;We&#160;pick<br/>
put&#160;by&#160;using&#160;proof-of-work&#160;solely&#160;for&#160;leader&#160;election,&#160;whilst<br/>
these&#160;parameters&#160;to&#160;reduce&#160;the&#160;prover’s&#160;and&#160;veriﬁer’s&#160;costs&#160;via<br/>
enabling&#160;the&#160;leader&#160;to&#160;approve&#160;transactions&#160;at&#160;a&#160;higher&#160;rate.<br/>
aggressive&#160;batching&#160;and&#160;to&#160;ensure&#160;that&#160;each&#160;of&#160;these&#160;proofs&#160;can<br/>
However,&#160;this&#160;approach&#160;is&#160;vulnerable&#160;to&#160;double&#160;spending<br/>
be&#160;veriﬁed&#160;with&#160;<i>&lt;&#160;</i>8<i>·</i>106&#160;gas.&#160;We&#160;measure&#160;the&#160;prover’s&#160;time&#160;to<br/>
in&#160;the&#160;short&#160;term&#160;by&#160;a&#160;non-rational&#160;malicious&#160;leader.&#160;Byz-<br/>
produce&#160;these&#160;proofs&#160;and&#160;state&#160;changes&#160;and&#160;then&#160;calculate&#160;the<br/>
coin&#160;[50]&#160;strengthens&#160;Bitcoin-NG&#160;by&#160;electing&#160;a&#160;quorum&#160;of<br/>
total&#160;machine&#160;cost&#160;to&#160;run&#160;the&#160;prover.&#160;We&#160;also&#160;run&#160;the&#160;veriﬁer<br/>
nodes&#160;that&#160;in&#160;turn&#160;use&#160;PBFT&#160;[29],&#160;but&#160;it&#160;requires&#160;a&#160;super<br/>
as&#160;a&#160;smart&#160;contract&#160;and&#160;measure&#160;the&#160;veriﬁer’s&#160;costs,&#160;in&#160;terms<br/>
majority&#160;of&#160;those&#160;elected&#160;nodes&#160;to&#160;be&#160;honest.&#160;Algorand&#160;[46]<br/>
of&#160;gas,&#160;to&#160;verify&#160;these&#160;proofs&#160;and&#160;state&#160;changes.<br/>
selects&#160;a&#160;committee,&#160;as&#160;in&#160;Byzcoin,&#160;but&#160;using&#160;light-weight<br/>
Figure&#160;9&#160;depicts&#160;our&#160;results.&#160;The&#160;per-transaction&#160;gas&#160;costs<br/>
veriﬁable&#160;random&#160;function,&#160;instead&#160;of&#160;proof-of-work.&#160;Un-<br/>
of&#160;Piperine’s&#160;veriﬁer&#160;are&#160;lower&#160;than&#160;the&#160;baseline&#160;by&#160;<i>≈&#160;</i>5.4<i>×</i>.<br/>
like&#160;Byzcoin,&#160;it&#160;assumes&#160;that&#160;the&#160;majority&#160;of&#160;currency&#160;in&#160;the<br/>
The&#160;USD&#160;cost&#160;of&#160;Piperine’s&#160;prover&#160;is&#160;<i>≈&#160;</i>250<i>×&#160;</i>smaller&#160;than<br/>
system&#160;is&#160;owned&#160;by&#160;honest&#160;nodes.&#160;The&#160;latter&#160;comes&#160;with&#160;its<br/>
the&#160;USD&#160;cost&#160;of&#160;Piperine’s&#160;veriﬁer,&#160;so&#160;the&#160;5.4<i>×&#160;</i>saving&#160;in&#160;gas<br/>
own&#160;issues&#160;[42].&#160;Instead&#160;of&#160;the&#160;randomized&#160;committee&#160;se-<br/>
translates&#160;directly&#160;into&#160;a&#160;similar&#160;savings&#160;in&#160;USD&#160;terms.<br/>
lection,&#160;Arbitrum&#160;[48]&#160;allows&#160;parties&#160;to&#160;manually&#160;choose&#160;a<br/>
Note&#160;that&#160;the&#160;prover’s&#160;cost&#160;to&#160;produce&#160;<i>πaudit&#160;</i>depends&#160;only<br/>
set&#160;of&#160;managers&#160;on&#160;a&#160;per-contract&#160;basis&#160;to&#160;monitor&#160;for&#160;cor-<br/>
on&#160;the&#160;size&#160;of&#160;the&#160;state&#160;whereas&#160;the&#160;cost&#160;to&#160;process&#160;trans-<br/>
rect&#160;execution.&#160;The&#160;blockchain&#160;accepts&#160;state&#160;transitions&#160;if<br/>
actions&#160;and&#160;to&#160;produce&#160;<i>π</i>Δ&#160;scale&#160;linearly&#160;in&#160;the&#160;number&#160;of<br/>
they&#160;are&#160;endorsed&#160;either&#160;by&#160;all&#160;the&#160;managers,&#160;or&#160;by&#160;one&#160;of<br/>
transactions.&#160;In&#160;the&#160;above&#160;experiment,&#160;<i>πaudit&#160;</i>is&#160;produced&#160;only<br/>
them&#160;and&#160;not&#160;disputed&#160;later.&#160;This&#160;requires&#160;active&#160;monitoring,<br/>
after&#160;processing&#160;5&#160;<i>·&#160;</i>105&#160;transactions,&#160;but&#160;on&#160;end-to-end&#160;per-<br/>
or&#160;trusting&#160;managers.&#160;A&#160;similar&#160;optimistic&#160;approach&#160;is&#160;fol-<br/>
transaction&#160;costs,&#160;it&#160;accounts&#160;for&#160;only&#160;0.09%&#160;and&#160;0.03%&#160;of<br/>
lowed&#160;in&#160;other&#160;works&#160;[5,&#160;44,&#160;68,&#160;78].&#160;Other&#160;approaches&#160;for<br/>
the&#160;overall&#160;USD&#160;and&#160;network&#160;costs&#160;respectively,&#160;so&#160;producing<br/>
accelerating&#160;blockchains&#160;include&#160;sharding&#160;[7,&#160;51,&#160;59,&#160;84,&#160;88],<br/>
<i>πaudit&#160;</i>more&#160;frequently&#160;does&#160;not&#160;substantially&#160;affect&#160;our&#160;results.<br/>
multi-chaining&#160;[56,&#160;77],&#160;off-chain&#160;state&#160;channels&#160;[39,&#160;63],&#160;pay-<br/>
Transaction&#160;sizes&#160;and&#160;network&#160;costs.&#160;As&#160;in&#160;the&#160;prior&#160;sub-<br/>
ment&#160;channels&#160;and&#160;networks&#160;[37,&#160;60,&#160;63,&#160;69],&#160;and&#160;the&#160;use&#160;of<br/>
section,&#160;Piperine&#160;reduces&#160;the&#160;size&#160;of&#160;transactions&#160;by&#160;<i>≈&#160;</i>2.7<i>×</i>.<br/>
trusted&#160;execution&#160;environments&#160;[30,&#160;58]&#160;(see&#160;a&#160;position&#160;pa-<br/>
We&#160;note&#160;that&#160;in&#160;Piperine&#160;the&#160;size&#160;of&#160;a&#160;transaction&#160;is&#160;dominated<br/>
per&#160;[36]&#160;for&#160;an&#160;overview).&#160;We&#160;highlight&#160;that&#160;Piperine&#160;operates<br/>
by&#160;a&#160;single&#160;hash&#160;and&#160;the&#160;associated&#160;state&#160;changes,&#160;so&#160;it&#160;is<br/>
at&#160;a&#160;different&#160;level&#160;than&#160;these&#160;systems&#160;and&#160;can&#160;be&#160;used&#160;in<br/>
insensitive&#160;to&#160;the&#160;size&#160;of&#160;arguments&#160;to&#160;a&#160;smart&#160;contract’s&#160;API<br/>
combination&#160;with&#160;any&#160;of&#160;them&#160;to&#160;further&#160;increase&#160;throughput<br/>
or&#160;Ethereum’s&#160;digital&#160;signatures.&#160;Whereas,&#160;for&#160;an&#160;on-chain<br/>
and&#160;achieve&#160;lower&#160;per-transaction&#160;costs.<br/>
contract&#160;in&#160;Ethereum,&#160;the&#160;size&#160;of&#160;transactions&#160;is&#160;dominated<br/>
Zerocash&#160;[14],&#160;Hawk&#160;[52],&#160;and&#160;Zexe&#160;[22]&#160;use&#160;proof&#160;ma-<br/>
by&#160;signatures&#160;and&#160;call&#160;arguments.&#160;Furthermore,&#160;as&#160;noted&#160;in<br/>
chinery&#160;similar&#160;to&#160;Piperine’s,&#160;but&#160;they&#160;primarily&#160;focus&#160;on<br/>
Section&#160;4,&#160;Ethereum’s&#160;blocks&#160;are&#160;limited&#160;by&#160;the&#160;scarce&#160;supply<br/>
privacy&#160;of&#160;transactions,&#160;rather&#160;than&#160;system&#160;scalability.&#160;Hawk<br/>
<hr/>
<a name=13></a>in&#160;particular&#160;relies&#160;on&#160;a&#160;manager&#160;to&#160;execute&#160;all&#160;the&#160;contract<br/>
are&#160;more&#160;complex&#160;than&#160;a&#160;payment&#160;service.<br/>
computations&#160;and&#160;lacks&#160;mechanisms&#160;for&#160;state&#160;reconstruction,<br/>
Very&#160;recently,&#160;Ozdemir&#160;et&#160;al.&#160;[65]&#160;describe&#160;a&#160;new&#160;storage<br/>
which&#160;can&#160;lead&#160;to&#160;degraded&#160;performance&#160;and&#160;hindered&#160;live-<br/>
primitive&#160;based&#160;on&#160;set&#160;accumulators&#160;for&#160;building&#160;veriﬁable<br/>
ness.&#160;Zerocash&#160;does&#160;not&#160;suffer&#160;from&#160;such&#160;liveness&#160;issues&#160;as&#160;it<br/>
state&#160;machines.&#160;Unlike&#160;Piperine’s&#160;set-based&#160;storage,&#160;it&#160;does<br/>
does&#160;not&#160;rely&#160;on&#160;a&#160;manager&#160;(each&#160;user&#160;acts&#160;as&#160;a&#160;manager&#160;of<br/>
not&#160;require&#160;the&#160;prover&#160;to&#160;produce&#160;a&#160;periodic&#160;<i>πaudit&#160;</i>(§2).&#160;How-<br/>
its&#160;own&#160;state)&#160;but&#160;supports&#160;only&#160;payment&#160;transactions.&#160;Zexe<br/>
ever,&#160;with&#160;their&#160;primitive,&#160;each&#160;storage&#160;operation&#160;requires&#160;a<br/>
extends&#160;Zerocash&#160;to&#160;support&#160;a&#160;richer&#160;model&#160;of&#160;ofﬂine&#160;com-<br/>
higher&#160;number&#160;of&#160;algebraic&#160;constraints&#160;than&#160;Piperine&#160;(small<br/>
putation.&#160;Although,&#160;the&#160;on-chain&#160;cost&#160;of&#160;verifying&#160;a&#160;proof&#160;is<br/>
constant&#160;factors&#160;depending&#160;on&#160;the&#160;batch&#160;size).<br/>
independent&#160;of&#160;the&#160;ofﬂine&#160;computation,&#160;it&#160;does&#160;not&#160;demon-<br/>strate&#160;improved&#160;blockchain&#160;throughput&#160;or&#160;lower&#160;transaction<br/>
8<br/>
Discussion<br/>
costs.&#160;Zether&#160;[28]&#160;offers&#160;privacy&#160;for&#160;amounts&#160;in&#160;a&#160;transaction<br/>
Trusted&#160;setup.&#160;Piperine&#160;employs&#160;a&#160;proof&#160;machinery&#160;[47]<br/>
using&#160;commitments&#160;and&#160;range&#160;proofs.&#160;ZoKrates&#160;[40]&#160;offers<br/>
that&#160;requires&#160;a&#160;<i>trusted&#160;setup</i>:&#160;a&#160;trusted&#160;party&#160;must&#160;create&#160;cryp-<br/>
a&#160;programming&#160;toolchain&#160;similar&#160;to&#160;Piperine&#160;to&#160;support&#160;off-<br/>
tographic&#160;material&#160;that&#160;depends&#160;on&#160;Ψ&#160;but&#160;not&#160;on&#160;inputs&#160;or<br/>
blockchain&#160;computation&#160;with&#160;a&#160;veriﬁer&#160;running&#160;on&#160;Ethereum.<br/>
outputs&#160;to&#160;Ψ.&#160;Such&#160;a&#160;trusted&#160;setup&#160;can&#160;be&#160;executed&#160;by&#160;a<br/>
However,&#160;ZoKrates&#160;does&#160;not&#160;provide&#160;a&#160;veriﬁable&#160;storage&#160;prim-<br/>
set&#160;of&#160;parties&#160;in&#160;a&#160;distributed&#160;protocol&#160;where&#160;at&#160;most&#160;one<br/>
itive&#160;nor&#160;guarantees&#160;liveness&#160;for&#160;off-chain&#160;state.<br/>
party&#160;needs&#160;to&#160;be&#160;honest&#160;[16].&#160;Designing&#160;an&#160;efﬁcient&#160;proof<br/>
Unlike&#160;a&#160;traditional&#160;blockchain&#160;that&#160;increases&#160;in&#160;size&#160;over<br/>
machinery&#160;without&#160;trusted&#160;setup&#160;is&#160;a&#160;topic&#160;of&#160;ongoing&#160;re-<br/>
time,&#160;Coda&#160;[61]&#160;proposes&#160;a&#160;constant-sized&#160;blockchain&#160;that<br/>
search&#160;[13,&#160;31,&#160;72,&#160;82];&#160;we&#160;plan&#160;to&#160;explore&#160;such&#160;a&#160;proof&#160;ma-<br/>
maintains&#160;a&#160;single&#160;Merkle&#160;root&#160;of&#160;the&#160;current&#160;state,&#160;using<br/>
chinery&#160;in&#160;Piperine&#160;in&#160;the&#160;future.<br/>
recursive&#160;proofs&#160;[17].&#160;Unfortunately,&#160;Coda&#160;lacks&#160;key&#160;liveness<br/>properties:&#160;one&#160;cannot&#160;recover&#160;state&#160;or&#160;update&#160;Merkle&#160;proofs<br/>
Reducing&#160;the&#160;costs&#160;of&#160;the&#160;proof&#160;machinery&#160;further.&#160;In&#160;the<br/>
from&#160;the&#160;blockchain&#160;information&#160;alone.<br/>
context&#160;of&#160;blockchains,&#160;we&#160;can&#160;drive&#160;down&#160;the&#160;cost&#160;of&#160;the<br/>
In&#160;concurrent&#160;work,&#160;StarkDEX&#160;[12]&#160;and&#160;StarkPay&#160;[23]&#160;pro-<br/>
Piperine&#160;veriﬁer&#160;further&#160;by&#160;using&#160;an&#160;inexpensive&#160;hash&#160;function<br/>
pose&#160;a&#160;solution&#160;that&#160;is&#160;similar&#160;in&#160;spirit,&#160;yet&#160;qualitatively&#160;dif-<br/>
(e.g.,&#160;SHA-256).&#160;However,&#160;as&#160;discussed&#160;earlier,&#160;this&#160;increases<br/>
ferent&#160;from&#160;Piperine.&#160;In&#160;these&#160;proposals,&#160;the&#160;veriﬁer&#160;stores&#160;a<br/>
the&#160;prover’s&#160;costs&#160;by&#160;orders&#160;of&#160;magnitude.&#160;But,&#160;one&#160;can&#160;reduce<br/>
Merkle&#160;root&#160;of&#160;the&#160;state,&#160;and&#160;the&#160;prover&#160;transitions&#160;the&#160;ver-<br/>
the&#160;prover’s&#160;monetary&#160;costs&#160;using&#160;GPU&#160;clusters,&#160;or&#160;serverless<br/>
iﬁer’s&#160;state&#160;by&#160;supplying&#160;a&#160;new&#160;Merkle&#160;root&#160;along&#160;with&#160;a<br/>
computing,&#160;which&#160;offer&#160;cheaper&#160;computing&#160;cycles&#160;per&#160;USD.<br/>
proof.&#160;This&#160;approach&#160;does&#160;not&#160;satisfy&#160;liveness&#160;as&#160;it&#160;lacks&#160;a<br/>
9<br/>
Summary<br/>
mechanism&#160;for&#160;an&#160;arbitrary&#160;entity&#160;to&#160;reconstruct&#160;the&#160;inter-<br/>nal&#160;state&#160;of&#160;the&#160;system&#160;(i.e.,&#160;the&#160;prover&#160;is&#160;trusted&#160;for&#160;data<br/>
We&#160;began&#160;this&#160;project&#160;with&#160;the&#160;following&#160;question:&#160;can&#160;we<br/>
availability).&#160;They&#160;allude&#160;to&#160;a&#160;future&#160;mechanism&#160;to&#160;“freeze”<br/>
reduce&#160;end-to-end&#160;costs&#160;in&#160;large-scale&#160;replicated&#160;systems&#160;by<br/>
the&#160;system&#160;when&#160;the&#160;prover&#160;fails,&#160;and&#160;in&#160;that&#160;circumstance,<br/>
delegating&#160;state&#160;machine&#160;executions?&#160;Our&#160;system,&#160;Piperine,<br/>
clients&#160;can&#160;regain&#160;custody&#160;of&#160;their&#160;assets&#160;by&#160;providing&#160;suitable<br/>
offers&#160;an&#160;afﬁrmative&#160;answer.&#160;Speciﬁcally,&#160;Piperine&#160;provides<br/>
Merkle&#160;proofs.&#160;However,&#160;for&#160;a&#160;client&#160;to&#160;construct&#160;such&#160;Merkle<br/>
a&#160;generic&#160;mechanism&#160;to&#160;reduce&#160;CPU&#160;and&#160;network&#160;costs&#160;of<br/>
proofs,&#160;the&#160;prover&#160;must&#160;be&#160;modiﬁed&#160;to&#160;produce&#160;a&#160;list&#160;of&#160;state<br/>
a&#160;given&#160;RSM—under&#160;certain&#160;operating&#160;conditions&#160;about&#160;the<br/>
changes&#160;during&#160;transaction&#160;execution&#160;and&#160;those&#160;changes&#160;must<br/>
number&#160;of&#160;nodes&#160;and&#160;complexity&#160;of&#160;the&#160;delegated&#160;state&#160;ma-<br/>
be&#160;persisted&#160;reliably&#160;(e.g.,&#160;as&#160;in&#160;Piperine).&#160;In&#160;terms&#160;of&#160;mecha-<br/>
chine.&#160;Furthermore,&#160;Piperine&#160;offers&#160;the&#160;ﬁrst&#160;mechanism&#160;to<br/>
nisms,&#160;Piperine&#160;relies&#160;on&#160;the&#160;Groth16&#160;proof&#160;system&#160;[47]&#160;for<br/>
execute&#160;transactions&#160;concurrently&#160;in&#160;an&#160;RSM&#160;built&#160;under&#160;an<br/>
proof&#160;generation&#160;and&#160;on&#160;set&#160;data&#160;structures&#160;for&#160;state,&#160;whereas<br/>
open,&#160;permissionless&#160;model.&#160;Finally,&#160;Piperine&#160;demonstrates<br/>
StarkDEX&#160;and&#160;StarkPay&#160;use&#160;zkSTARKs&#160;[13]&#160;and&#160;Merkle<br/>
the&#160;ﬁrst&#160;large-scale&#160;application&#160;of&#160;cryptographic&#160;proof&#160;ma-<br/>
trees,&#160;respectively.&#160;Prior&#160;performance&#160;reports&#160;[73,&#160;82,&#160;87]<br/>
chinery&#160;to&#160;reduce&#160;costs&#160;in&#160;a&#160;real-world&#160;system.&#160;As&#160;a&#160;result&#160;of<br/>
show&#160;that&#160;both&#160;mechanisms&#160;employed&#160;by&#160;Piperine&#160;achieve<br/>
these,&#160;we&#160;believe&#160;this&#160;work&#160;represents&#160;progress.<br/>
signiﬁcantly&#160;lower&#160;costs&#160;for&#160;the&#160;prover.<br/>
Acknowledgments.&#160;We&#160;thank&#160;Sebastian&#160;Angel,&#160;Riad&#160;Wahby,&#160;and<br/>
Unlike&#160;Stark-based&#160;proposals,&#160;Rollup&#160;[1,&#160;26,&#160;27,&#160;85],&#160;an<br/>
the&#160;anonymous&#160;S&amp;P&#160;reviewers&#160;for&#160;helpful&#160;comments&#160;that&#160;signiﬁ-<br/>
ongoing&#160;project&#160;in&#160;the&#160;Ethereum&#160;community&#160;to&#160;build&#160;an&#160;off-<br/>
cantly&#160;improved&#160;the&#160;presentation&#160;of&#160;this&#160;work.&#160;Part&#160;of&#160;this&#160;work&#160;was<br/>
chain&#160;payment&#160;service,&#160;does&#160;not&#160;suffer&#160;from&#160;aforementioned<br/>
performed&#160;during&#160;Kirill&#160;Nikitin’s&#160;internship&#160;at&#160;Microsoft&#160;Research.<br/>
liveness&#160;issues.&#160;However,&#160;like&#160;Stark-based&#160;proposals,&#160;it&#160;relies<br/>on&#160;Merkle&#160;trees&#160;as&#160;a&#160;storage&#160;primitive&#160;whereas&#160;Piperine&#160;em-<br/>
References<br/>
ploys&#160;set&#160;data&#160;structures;&#160;the&#160;latter&#160;enables&#160;concurrent&#160;transac-<br/>tion&#160;processing&#160;and&#160;cheaper&#160;storage&#160;operations&#160;(§2).&#160;Based&#160;on<br/>
[1]&#160;Ethereum&#160;Roadmap.&#160;ZK-Rollups.<br/>
prior&#160;performance&#160;reports&#160;[73],&#160;this&#160;means&#160;Piperine’s&#160;prover<br/>
https://docs.ethhub.io/ethereum-roadmap/layer-2-<br/>
is&#160;cheaper&#160;than&#160;Rollup’s&#160;prover&#160;by&#160;small&#160;constant&#160;factors&#160;to<br/>
scaling/zk-rollups/.<br/>
[2]&#160;Ganache.&#160;https://truffleframework.com/ganache.<br/>
several&#160;orders&#160;of&#160;magnitude&#160;(depending&#160;on&#160;the&#160;hash&#160;function<br/>
[3]&#160;Web3.py.<br/>
employed&#160;by&#160;Rollup).&#160;This&#160;gap&#160;widens&#160;for&#160;state&#160;machines&#160;that<br/>
https://web3py.readthedocs.io/en/stable/.<br/>
<hr/>
<a name=14></a>[4]&#160;STARK-friendly&#160;hash&#160;challenge.<br/>
[19]&#160;D.&#160;J.&#160;Bernstein,&#160;P.&#160;Birkner,&#160;M.&#160;Joye,&#160;T.&#160;Lange,&#160;and&#160;C.&#160;Peters.<br/>
https://starkware.co/hash-challenge/,&#160;Aug.&#160;2019.<br/>
Twisted&#160;Edwards&#160;curves.&#160;In&#160;<i>AFRICACRYPT</i>,&#160;2008.<br/>
[5]&#160;J.&#160;Adler.&#160;Minimal&#160;viable&#160;merged&#160;consensus.<br/>
[20]&#160;P.&#160;A.&#160;Bernstein,&#160;D.&#160;W.&#160;Shipman,&#160;and&#160;W.&#160;S.&#160;Wong.&#160;Formal<br/>
https://ethresear.ch/t/minimal-viable-merged-<br/>
aspects&#160;of&#160;serializability&#160;in&#160;database&#160;concurrency&#160;control.<br/>
consensus/5617,&#160;June&#160;2019.<br/>
<i>IEEE&#160;Transactions&#160;on&#160;Software&#160;Engineering</i>,&#160;SE-5(3),&#160;May<br/>
[6]&#160;M.&#160;Ajtai.&#160;Generating&#160;hard&#160;instances&#160;of&#160;lattice&#160;problems<br/>
1979.<br/>
(extended&#160;abstract).&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;ACM&#160;Symposium</i><br/>
[21]&#160;N.&#160;Bitansky,&#160;A.&#160;Chiesa,&#160;Y.&#160;Ishai,&#160;O.&#160;Paneth,&#160;and&#160;R.&#160;Ostrovsky.<br/>
<i>on&#160;Theory&#160;of&#160;Computing&#160;(STOC)</i>,&#160;pages&#160;99–108,&#160;1996.<br/>
Succinct&#160;non-interactive&#160;arguments&#160;via&#160;linear&#160;interactive<br/>
[7]&#160;M.&#160;Al-Bassam,&#160;A.&#160;Sonnino,&#160;S.&#160;Bano,&#160;D.&#160;Hrycyszyn,&#160;and<br/>
proofs.&#160;In&#160;<i>Theory&#160;of&#160;Cryptography&#160;Conference</i>,&#160;2013.<br/>
G.&#160;Danezis.&#160;Chainspace:&#160;A&#160;sharded&#160;smart&#160;contracts&#160;platform.<br/>
[22]&#160;S.&#160;Bowe,&#160;A.&#160;Chiesa,&#160;M.&#160;Green,&#160;I.&#160;Miers,&#160;P.&#160;Mishra,&#160;and&#160;H.&#160;Wu.<br/>
In&#160;<i>Proceedings&#160;of&#160;the&#160;Network&#160;and&#160;Distributed&#160;System</i><br/>
Zexe:&#160;Enabling&#160;decentralized&#160;private&#160;computation.&#160;In<br/>
<i>Security&#160;Symposium&#160;(NDSS)</i>,&#160;2018.<br/>
<i>Proceedings&#160;of&#160;the&#160;IEEE&#160;Symposium&#160;on&#160;Security&#160;and&#160;Privacy</i><br/>
[8]&#160;M.&#160;Albrecht,&#160;L.&#160;Grassi,&#160;C.&#160;Rechberger,&#160;A.&#160;Roy,&#160;and&#160;T.&#160;Tiessen.<br/>
<i>(S&amp;P)</i>,&#160;2020.<br/>
MiMC:&#160;Efﬁcient&#160;encryption&#160;and&#160;cryptographic&#160;hashing&#160;with<br/>
[23]&#160;T.&#160;Brand,&#160;U.&#160;Kolodny,&#160;and&#160;A.&#160;Levy.&#160;When&#160;lightning&#160;STARKs.<br/>
minimal&#160;multiplicative&#160;complexity.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
https://medium.com/starkware/when-lightning-<br/>
<i>International&#160;Conference&#160;on&#160;the&#160;Theory&#160;and&#160;Application&#160;of</i><br/>
starks-a90819be37ba,&#160;Mar.&#160;2019.<br/>
<i>Cryptology&#160;and&#160;Information&#160;Security&#160;(ASIACRYPT)</i>,&#160;2016.<br/>
[24]&#160;B.&#160;Braun,&#160;A.&#160;J.&#160;Feldman,&#160;Z.&#160;Ren,&#160;S.&#160;Setty,&#160;A.&#160;J.&#160;Blumberg,&#160;and<br/>
[9]&#160;E.&#160;Androulaki,&#160;A.&#160;Barger,&#160;V.&#160;Bortnikov,&#160;C.&#160;Cachin,<br/>
M.&#160;Walﬁsh.&#160;Verifying&#160;computations&#160;with&#160;state.&#160;In<br/>
K.&#160;Christidis,&#160;A.&#160;D.&#160;Caro,&#160;D.&#160;Enyeart,&#160;C.&#160;Ferris,&#160;G.&#160;Laventman,<br/>
<i>Proceedings&#160;of&#160;the&#160;ACM&#160;Symposium&#160;on&#160;Operating&#160;Systems</i><br/>
Y.&#160;Manevich,&#160;S.&#160;Muralidharan,&#160;C.&#160;Murthy,&#160;B.&#160;Nguyen,<br/>
<i>Principles&#160;(SOSP)</i>,&#160;2013.<br/>
M.&#160;Sethi,&#160;G.&#160;Singh,&#160;K.&#160;Smith,&#160;A.&#160;Sorniotti,&#160;C.&#160;Stathakopoulou,<br/>
[25]&#160;Brave&#160;Software.&#160;Basic&#160;Attention&#160;Token.&#160;https:<br/>
M.&#160;Vukolic,&#160;S.&#160;W.&#160;Cocco,&#160;and&#160;J.&#160;Yellick.&#160;Hyperledger&#160;fabric:<br/>
//basicattentiontoken.org/wp-content/uploads/<br/>
A&#160;distributed&#160;operating&#160;system&#160;for&#160;permissioned&#160;blockchains.<br/>
2017/05/BasicAttentionTokenWhitePaper-4.pdf,&#160;Mar.<br/>
In&#160;<i>Proceedings&#160;of&#160;the&#160;ACM&#160;European&#160;Conference&#160;on</i><br/>
2018.<br/>
<i>Computer&#160;Systems&#160;(EuroSys)</i>,&#160;pages&#160;30:1–30:15,&#160;2018.<br/>
[26]&#160;V.&#160;Buterin.&#160;On-chain&#160;scaling&#160;to&#160;potentially&#160;500&#160;tx/sec&#160;through<br/>
[10]&#160;A.&#160;Arasu,&#160;K.&#160;Eguro,&#160;R.&#160;Kaushik,&#160;D.&#160;Kossmann,&#160;P.&#160;Meng,<br/>
mass&#160;tx&#160;validation.&#160;https://ethresear.ch/t/on-chain-<br/>
V.&#160;Pandey,&#160;and&#160;R.&#160;Ramamurthy.&#160;Concerto:&#160;A&#160;high<br/>
scaling-to-potentially-500-tx-sec-through-<br/>
concurrency&#160;key-value&#160;store&#160;with&#160;integrity.&#160;In&#160;<i>Proceedings&#160;of</i><br/>
mass-tx-validation/3477,&#160;Sept.&#160;2018.<br/>
<i>the&#160;ACM&#160;International&#160;Conference&#160;on&#160;Management&#160;of&#160;Data</i><br/>
[27]&#160;V.&#160;Buterin.&#160;The&#160;dawn&#160;of&#160;hybrid&#160;layer&#160;2&#160;protocols.<br/>
<i>(SIGMOD)</i>,&#160;2017.<br/>
https://vitalik.ca/general/2019/08/28/hybrid_<br/>
[11]&#160;M.&#160;Bellare&#160;and&#160;D.&#160;Micciancio.&#160;A&#160;new&#160;paradigm&#160;for<br/>
layer_2.html,&#160;Aug.&#160;2019.<br/>
collision-free&#160;hashing:&#160;Incrementality&#160;at&#160;reduced&#160;cost.&#160;In<br/>
[28]&#160;B.&#160;BÃijnz,&#160;S.&#160;Agrawal,&#160;M.&#160;Zamani,&#160;and&#160;D.&#160;Boneh.&#160;Zether:<br/>
<i>Proceedings&#160;of&#160;the&#160;International&#160;Conference&#160;on&#160;the&#160;Theory</i><br/>
Towards&#160;privacy&#160;in&#160;a&#160;smart&#160;contract&#160;world.&#160;Cryptology&#160;ePrint<br/>
<i>and&#160;Applications&#160;of&#160;Cryptographic&#160;Techniques</i><br/>
Archive,&#160;Report&#160;2019/191,&#160;2019.<br/>
<i>(EUROCRYPT)</i>,&#160;1997.<br/>
[29]&#160;M.&#160;Castro&#160;and&#160;B.&#160;Liskov.&#160;Practical&#160;Byzantine&#160;fault&#160;tolerance.<br/>
[12]&#160;E.&#160;Ben-Sasson.&#160;The&#160;STARK&#160;truth&#160;about&#160;DEXes.&#160;Stanford<br/>
In&#160;<i>Proceedings&#160;of&#160;the&#160;USENIX&#160;Symposium&#160;on&#160;Operating</i><br/>
Blockchain&#160;Conference,&#160;2019.<br/>
<i>Systems&#160;Design&#160;and&#160;Implementation&#160;(OSDI)</i>,&#160;pages&#160;173–186,<br/>
[13]&#160;E.&#160;Ben-Sasson,&#160;I.&#160;Bentov,&#160;Y.&#160;Horesh,&#160;and&#160;M.&#160;Riabzev.&#160;Scalable<br/>
1999.<br/>
zero&#160;knowledge&#160;with&#160;no&#160;trusted&#160;setup.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
[30]&#160;R.&#160;Cheng,&#160;F.&#160;Zhang,&#160;J.&#160;Kos,&#160;W.&#160;He,&#160;N.&#160;Hynes,&#160;N.&#160;Johnson,<br/>
<i>International&#160;Cryptology&#160;Conference&#160;(CRYPTO)</i>,&#160;Aug.&#160;2019.<br/>
A.&#160;Juels,&#160;A.&#160;Miller,&#160;and&#160;D.&#160;Song.&#160;Ekiden:&#160;A&#160;platform&#160;for<br/>
[14]&#160;E.&#160;Ben-Sasson,&#160;A.&#160;Chiesa,&#160;C.&#160;Garman,&#160;M.&#160;Green,&#160;I.&#160;Miers,<br/>
conﬁdentiality-preserving,&#160;trustworthy,&#160;and&#160;performant&#160;smart<br/>
E.&#160;Tromer,&#160;and&#160;M.&#160;Virza.&#160;Zerocash:&#160;Decentralized&#160;anonymous<br/>
contracts.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;IEEE&#160;European&#160;Symposium</i><br/>
payments&#160;from&#160;Bitcoin.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;IEEE</i><br/>
<i>on&#160;Security&#160;and&#160;Privacy&#160;(EuroS&amp;P)</i>,&#160;pages&#160;185–200,&#160;2019.<br/>
<i>Symposium&#160;on&#160;Security&#160;and&#160;Privacy&#160;(S&amp;P)</i>,&#160;2014.<br/>
[31]&#160;A.&#160;Chiesa,&#160;D.&#160;Ojha,&#160;and&#160;N.&#160;Spooner.&#160;Fractal:&#160;Post-quantum<br/>
[15]&#160;E.&#160;Ben-Sasson,&#160;A.&#160;Chiesa,&#160;D.&#160;Genkin,&#160;E.&#160;Tromer,&#160;and<br/>
and&#160;transparent&#160;recursive&#160;proofs&#160;from&#160;holography.&#160;Cryptology<br/>
M.&#160;Virza.&#160;SNARKs&#160;for&#160;C:&#160;Verifying&#160;program&#160;executions<br/>
ePrint&#160;Archive,&#160;Report&#160;2019/1076,&#160;2019.<br/>
succinctly&#160;and&#160;in&#160;zero&#160;knowledge.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
[32]&#160;D.&#160;Clarke,&#160;S.&#160;Devadas,&#160;M.&#160;V.&#160;Dijk,&#160;B.&#160;Gassend,&#160;G.&#160;Edward,<br/>
<i>International&#160;Cryptology&#160;Conference&#160;(CRYPTO)</i>,&#160;Aug.&#160;2013.<br/>
and&#160;S.&#160;Mit.&#160;Incremental&#160;multiset&#160;hash&#160;functions&#160;and&#160;their<br/>
[16]&#160;E.&#160;Ben-Sasson,&#160;A.&#160;Chiesa,&#160;M.&#160;Green,&#160;E.&#160;Tromer,&#160;and&#160;M.&#160;Virza.<br/>
application&#160;to&#160;memory&#160;integrity&#160;checking.&#160;In&#160;<i>Proceedings&#160;of</i><br/>
Secure&#160;sampling&#160;of&#160;public&#160;parameters&#160;for&#160;succinct&#160;zero<br/>
<i>the&#160;International&#160;Conference&#160;on&#160;the&#160;Theory&#160;and&#160;Application&#160;of</i><br/>
knowledge&#160;proofs.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;IEEE&#160;Symposium&#160;on</i><br/>
<i>Cryptology&#160;and&#160;Information&#160;Security&#160;(ASIACRYPT)</i>,&#160;2003.<br/>
<i>Security&#160;and&#160;Privacy&#160;(S&amp;P)</i>,&#160;2015.<br/>
[33]&#160;CoinMetrics.&#160;State&#160;of&#160;the&#160;network:&#160;Issue&#160;25.<br/>
[17]&#160;E.&#160;Ben-Sasson,&#160;A.&#160;Chiesa,&#160;E.&#160;Tromer,&#160;and&#160;M.&#160;Virza.&#160;Scalable<br/>
https://coinmetrics.substack.com/p/coin-metrics-<br/>
zero&#160;knowledge&#160;via&#160;cycles&#160;of&#160;elliptic&#160;curves.&#160;In&#160;<i>Proceedings</i><br/>
state-of-the-network-44c,&#160;Nov.&#160;2019.<br/>
<i>of&#160;the&#160;International&#160;Cryptology&#160;Conference&#160;(CRYPTO)</i>,&#160;2014.<br/>
[34]&#160;Z.&#160;E.&#160;C.&#160;Company.&#160;What&#160;is&#160;Jubjub?<br/>
[18]&#160;E.&#160;Ben-Sasson,&#160;A.&#160;Chiesa,&#160;E.&#160;Tromer,&#160;and&#160;M.&#160;Virza.&#160;Succinct<br/>
https://z.cash/technology/jubjub.html,&#160;2017.<br/>
non-interactive&#160;zero&#160;knowledge&#160;for&#160;a&#160;von&#160;Neumann<br/>
[35]&#160;C.&#160;Costello,&#160;C.&#160;Fournet,&#160;J.&#160;Howell,&#160;M.&#160;Kohlweiss,&#160;B.&#160;Kreuter,<br/>
architecture.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;USENIX&#160;Security</i><br/>
M.&#160;Naehrig,&#160;B.&#160;Parno,&#160;and&#160;S.&#160;Zahur.&#160;Geppetto:&#160;Versatile<br/>
<i>Symposium</i>,&#160;2014.<br/>
veriﬁable&#160;computation.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;IEEE</i><br/>
<hr/>
<a name=15></a><i>Symposium&#160;on&#160;Security&#160;and&#160;Privacy&#160;(S&amp;P)</i>,&#160;May&#160;2015.<br/>
[50]&#160;E.&#160;Kokoris-Kogias,&#160;P.&#160;Jovanovic,&#160;N.&#160;Gailly,&#160;I.&#160;Khofﬁ,<br/>
[36]&#160;K.&#160;Croman,&#160;C.&#160;Decker,&#160;I.&#160;Eyal,&#160;A.&#160;E.&#160;Gencer,&#160;A.&#160;Juels,<br/>
L.&#160;Gasser,&#160;and&#160;B.&#160;Ford.&#160;Enhancing&#160;Bitcoin&#160;security&#160;and<br/>
A.&#160;Kosba,&#160;A.&#160;Miller,&#160;P.&#160;Saxena,&#160;E.&#160;Shi,&#160;E.&#160;G.&#160;Sirer,&#160;et&#160;al.&#160;On<br/>
performance&#160;with&#160;strong&#160;consistency&#160;via&#160;collective&#160;signing.&#160;In<br/>
scaling&#160;decentralized&#160;blockchains.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
<i>Proceedings&#160;of&#160;the&#160;USENIX&#160;Security&#160;Symposium</i>,&#160;pages<br/>
<i>International&#160;Financial&#160;Cryptography&#160;and&#160;Data&#160;Security</i><br/>
279–296,&#160;2016.<br/>
<i>Conference</i>,&#160;pages&#160;106–125,&#160;2016.<br/>
[51]&#160;E.&#160;Kokoris-Kogias,&#160;P.&#160;Jovanovic,&#160;L.&#160;Gasser,&#160;N.&#160;Gailly,&#160;E.&#160;Syta,<br/>
[37]&#160;C.&#160;Decker&#160;and&#160;R.&#160;Wattenhofer.&#160;A&#160;fast&#160;and&#160;scalable&#160;payment<br/>
and&#160;B.&#160;Ford.&#160;Omniledger:&#160;A&#160;secure,&#160;scale-out,&#160;decentralized<br/>
network&#160;with&#160;Bitcoin&#160;duplex&#160;micropayment&#160;channels.&#160;In<br/>
ledger&#160;via&#160;sharding.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;IEEE&#160;Symposium</i><br/>
<i>Symposium&#160;on&#160;Self-Stabilizing&#160;Systems</i>,&#160;pages&#160;3–18,&#160;2015.<br/>
<i>on&#160;Security&#160;and&#160;Privacy&#160;(S&amp;P)</i>,&#160;pages&#160;583–598,&#160;2018.<br/>
[38]&#160;F.&#160;Denis.&#160;Libsodium.<br/>
[52]&#160;A.&#160;Kosba,&#160;A.&#160;Miller,&#160;E.&#160;Shi,&#160;Z.&#160;Wen,&#160;and&#160;C.&#160;Papamanthou.<br/>
https://github.com/jedisct1/libsodium.<br/>
Hawk:&#160;The&#160;blockchain&#160;model&#160;of&#160;cryptography&#160;and<br/>
[39]&#160;S.&#160;Dziembowski,&#160;S.&#160;Faust,&#160;and&#160;K.&#160;Hostáková.&#160;General&#160;state<br/>
privacy-preserving&#160;smart&#160;contracts.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
channel&#160;networks.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;ACM&#160;Conference&#160;on</i><br/>
<i>IEEE&#160;Symposium&#160;on&#160;Security&#160;and&#160;Privacy&#160;(S&amp;P)</i>,&#160;pages<br/>
<i>Computer&#160;and&#160;Communications&#160;Security&#160;(CCS)</i>,&#160;pages<br/>
839–858,&#160;2016.<br/>
949–966,&#160;2018.<br/>
[53]&#160;A.&#160;Kosba,&#160;Z.&#160;Zhao,&#160;A.&#160;Miller,&#160;Y.&#160;Qian,&#160;H.&#160;Chan,<br/>
[40]&#160;J.&#160;Eberhardt&#160;and&#160;S.&#160;Tai.&#160;ZoKrates&#160;–&#160;Scalable<br/>
C.&#160;Papamanthou,&#160;R.&#160;Pass,&#160;abhi&#160;shelat,&#160;and&#160;E.&#160;Shi.&#160;C<i>∅</i>C<i>∅</i>:&#160;A<br/>
privacy-preserving&#160;off-chain&#160;computations.&#160;In&#160;<i>IEEE</i><br/>
framework&#160;for&#160;building&#160;composable&#160;zero-knowledge&#160;proofs.<br/>
<i>International&#160;Conference&#160;on&#160;Blockchain</i>,&#160;pages&#160;1084–1091,<br/>
Cryptology&#160;ePrint&#160;Archive,&#160;Report&#160;2015/1093,&#160;2015.<br/>
2018.<br/>
[54]&#160;L.&#160;Lamport.&#160;How&#160;to&#160;make&#160;a&#160;multiprocessor&#160;computer&#160;that<br/>
[41]&#160;I.&#160;Eyal,&#160;A.&#160;E.&#160;Gencer,&#160;E.&#160;G.&#160;Sirer,&#160;and&#160;R.&#160;V.&#160;Renesse.<br/>
correctly&#160;executes&#160;multiprocess&#160;programs.&#160;<i>IEEE&#160;Transactions</i><br/>
Bitcoin-NG:&#160;A&#160;scalable&#160;blockchain&#160;protocol.&#160;In&#160;<i>Proceedings</i><br/>
<i>on&#160;Computers</i>,&#160;C-28(9),&#160;Sept.&#160;1979.<br/>
<i>of&#160;the&#160;USENIX&#160;Symposium&#160;on&#160;Networked&#160;Systems&#160;Design&#160;and</i><br/>
[55]&#160;L.&#160;Lamport.&#160;<i>Specifying&#160;Systems:&#160;The&#160;TLA+&#160;Language&#160;and</i><br/>
<i>Implementation&#160;(NSDI)</i>,&#160;pages&#160;45–59,&#160;2016.<br/>
<i>Tools&#160;for&#160;Hardware&#160;and&#160;Software&#160;Engineers</i>.&#160;Addison-Wesley,<br/>
[42]&#160;G.&#160;Fanti,&#160;L.&#160;Kogan,&#160;S.&#160;Oh,&#160;K.&#160;Ruan,&#160;P.&#160;Viswanath,&#160;and<br/>
June&#160;2002.<br/>
G.&#160;Wang.&#160;Compounding&#160;of&#160;wealth&#160;in&#160;proof-of-stake<br/>
[56]&#160;Y.&#160;Lewenberg,&#160;Y.&#160;Sompolinsky,&#160;and&#160;A.&#160;Zohar.&#160;Inclusive&#160;block<br/>
cryptocurrencies.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;International</i><br/>
chain&#160;protocols.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;International&#160;Financial</i><br/>
<i>Financial&#160;Cryptography&#160;and&#160;Data&#160;Security&#160;Conference</i>,&#160;2019.<br/>
<i>Cryptography&#160;and&#160;Data&#160;Security&#160;Conference</i>,&#160;pages&#160;528–547,<br/>
[43]&#160;D.&#160;Fiore,&#160;C.&#160;Fournet,&#160;E.&#160;Ghosh,&#160;M.&#160;Kohlweiss,&#160;O.&#160;Ohrimenko,<br/>
2015.<br/>
and&#160;B.&#160;Parno.&#160;Hash&#160;ﬁrst,&#160;argue&#160;later:&#160;Adaptive&#160;veriﬁable<br/>
[57]&#160;libsnark.&#160;A&#160;C++&#160;library&#160;for&#160;zkSNARK&#160;proofs.<br/>
computations&#160;on&#160;outsourced&#160;data.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;ACM</i><br/>
https://github.com/scipr-lab/libsnark,&#160;2012.<br/>
<i>Conference&#160;on&#160;Computer&#160;and&#160;Communications&#160;Security</i><br/>
[58]&#160;J.&#160;Lind,&#160;O.&#160;Naor,&#160;I.&#160;Eyal,&#160;F.&#160;Kelbert,&#160;E.&#160;G.&#160;Sirer,&#160;and<br/>
<i>(CCS)</i>,&#160;2016.<br/>
P.&#160;Pietzuch.&#160;Teechain:&#160;a&#160;secure&#160;payment&#160;network&#160;with<br/>
[44]&#160;K.&#160;Floersch.&#160;Ethereum&#160;smart&#160;contracts&#160;in&#160;L2:&#160;Optimistic<br/>
asynchronous&#160;blockchain&#160;access.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;ACM</i><br/>
Rollup.<br/>
<i>Symposium&#160;on&#160;Operating&#160;Systems&#160;Principles&#160;(SOSP)</i>,&#160;pages<br/>
https://medium.com/plasma-group/ethereum-smart-<br/>
63–79,&#160;2019.<br/>
contracts-in-l2-optimistic-rollup-2c1cef2ec537,<br/>
[59]&#160;L.&#160;Luu,&#160;V.&#160;Narayanan,&#160;C.&#160;Zheng,&#160;K.&#160;Baweja,&#160;S.&#160;Gilbert,&#160;and<br/>
Aug.&#160;2019.<br/>
P.&#160;Saxena.&#160;A&#160;secure&#160;sharding&#160;protocol&#160;for&#160;open&#160;blockchains.<br/>
[45]&#160;R.&#160;Gennaro,&#160;C.&#160;Gentry,&#160;B.&#160;Parno,&#160;and&#160;M.&#160;Raykova.&#160;Quadratic<br/>
In&#160;<i>Proceedings&#160;of&#160;the&#160;ACM&#160;Conference&#160;on&#160;Computer&#160;and</i><br/>
span&#160;programs&#160;and&#160;succinct&#160;NIZKs&#160;without&#160;PCPs.&#160;In<br/>
<i>Communications&#160;Security&#160;(CCS)</i>,&#160;pages&#160;17–30,&#160;2016.<br/>
<i>Proceedings&#160;of&#160;the&#160;International&#160;Conference&#160;on&#160;the&#160;Theory</i><br/>
[60]&#160;P.&#160;McCorry,&#160;M.&#160;Möser,&#160;S.&#160;F.&#160;Shahandasti,&#160;and&#160;F.&#160;Hao.<br/>
<i>and&#160;Applications&#160;of&#160;Cryptographic&#160;Techniques</i><br/>
Towards&#160;Bitcoin&#160;payment&#160;networks.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
<i>(EUROCRYPT)</i>,&#160;2013.<br/>
<i>Australasian&#160;Conference&#160;on&#160;Information&#160;Security&#160;and&#160;Privacy</i>,<br/>
[46]&#160;Y.&#160;Gilad,&#160;R.&#160;Hemo,&#160;S.&#160;Micali,&#160;G.&#160;Vlachos,&#160;and&#160;N.&#160;Zeldovich.<br/>
pages&#160;57–76,&#160;2016.<br/>
Algorand:&#160;Scaling&#160;Byzantine&#160;agreements&#160;for&#160;cryptocurrencies.<br/>
[61]&#160;I.&#160;Meckler&#160;and&#160;E.&#160;Shapiro.&#160;Coda:&#160;Decentralized<br/>
In&#160;<i>Proceedings&#160;of&#160;the&#160;ACM&#160;Symposium&#160;on&#160;Operating&#160;Systems</i><br/>
cryptocurrency&#160;at&#160;scale.<br/>
<i>Principles&#160;(SOSP)</i>,&#160;pages&#160;51–68,&#160;2017.<br/>
https://cdn.codaprotocol.com/v2/static/coda-<br/>
[47]&#160;J.&#160;Groth.&#160;On&#160;the&#160;size&#160;of&#160;pairing-based&#160;non-interactive<br/>
whitepaper-05-10-2018-0.pdf,&#160;2018.<br/>
arguments.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;International&#160;Conference&#160;on</i><br/>
[62]&#160;A.&#160;J.&#160;Menezes,&#160;S.&#160;A.&#160;Vanstone,&#160;and&#160;P.&#160;C.&#160;V.&#160;Oorschot.<br/>
<i>the&#160;Theory&#160;and&#160;Applications&#160;of&#160;Cryptographic&#160;Techniques</i><br/>
<i>Handbook&#160;of&#160;Applied&#160;Cryptography</i>.&#160;CRC&#160;Press,&#160;Inc.,&#160;1st<br/>
<i>(EUROCRYPT)</i>,&#160;2016.<br/>
edition,&#160;1996.<br/>
[48]&#160;H.&#160;Kalodner,&#160;S.&#160;Goldfeder,&#160;X.&#160;Chen,&#160;S.&#160;M.&#160;Weinberg,&#160;and<br/>
[63]&#160;A.&#160;Miller,&#160;I.&#160;Bentov,&#160;S.&#160;Bakshi,&#160;R.&#160;Kumaresan,&#160;and<br/>
E.&#160;W.&#160;Felten.&#160;Arbitrum:&#160;Scalable,&#160;private&#160;smart&#160;contracts.&#160;In<br/>
P.&#160;McCorry.&#160;Sprites&#160;and&#160;state&#160;channels:&#160;Payment&#160;networks&#160;that<br/>
<i>Proceedings&#160;of&#160;the&#160;USENIX&#160;Security&#160;Symposium</i>,&#160;pages<br/>
go&#160;faster&#160;than&#160;lightning.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;International</i><br/>
1353–1370,&#160;2018.<br/>
<i>Financial&#160;Cryptography&#160;and&#160;Data&#160;Security&#160;Conference</i>,&#160;2019.<br/>
[49]&#160;M.&#160;Kapritsos,&#160;Y.&#160;Wang,&#160;V.&#160;Quema,&#160;A.&#160;Clement,&#160;L.&#160;Alvisi,&#160;and<br/>
[64]&#160;S.&#160;Nakamoto.&#160;Bitcoin:&#160;A&#160;peer-to-peer&#160;electronic&#160;cash&#160;system,<br/>
M.&#160;Dahlin.&#160;All&#160;about&#160;Eve:&#160;Execute-Verify&#160;replication&#160;for<br/>
Oct.&#160;2008.<br/>
multi-core&#160;servers.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;USENIX&#160;Symposium</i><br/>
[65]&#160;A.&#160;Ozdemir,&#160;R.&#160;S.&#160;Wahby,&#160;and&#160;D.&#160;Boneh.&#160;Scaling&#160;veriﬁable<br/>
<i>on&#160;Operating&#160;Systems&#160;Design&#160;and&#160;Implementation&#160;(OSDI)</i>,<br/>
computation&#160;using&#160;efﬁcient&#160;set&#160;accumulators.&#160;Cryptology<br/>
pages&#160;237–250,&#160;2012.<br/>
ePrint&#160;Archive,&#160;Report&#160;2019/1494,&#160;2019.<br/>
<hr/>
<a name=16></a>[66]&#160;C.&#160;H.&#160;Papadimitriou.&#160;The&#160;serializability&#160;of&#160;concurrent<br/>
<i>(S&amp;P)</i>,&#160;2018.<br/>
database&#160;updates.&#160;<i>Journal&#160;of&#160;the&#160;ACM&#160;(JACM)</i>,&#160;26(4),&#160;Oct.<br/>
[83]&#160;M.&#160;Walﬁsh&#160;and&#160;A.&#160;J.&#160;Blumberg.&#160;Verifying&#160;computations<br/>
1979.<br/>
without&#160;reexecuting&#160;them:&#160;From&#160;theoretical&#160;possibility&#160;to&#160;near<br/>
[67]&#160;B.&#160;Parno,&#160;C.&#160;Gentry,&#160;J.&#160;Howell,&#160;and&#160;M.&#160;Raykova.&#160;Pinocchio:<br/>
practicality.&#160;<i>Communications&#160;of&#160;the&#160;ACM</i>,&#160;58(2),&#160;Jan.&#160;2015.<br/>
Nearly&#160;practical&#160;veriﬁable&#160;computation.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
[84]&#160;J.&#160;Wang&#160;and&#160;H.&#160;Wang.&#160;Monoxide:&#160;Scale&#160;out&#160;blockchains&#160;with<br/>
<i>IEEE&#160;Symposium&#160;on&#160;Security&#160;and&#160;Privacy&#160;(S&amp;P)</i>,&#160;May&#160;2013.<br/>
asynchronous&#160;consensus&#160;zones.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
[68]&#160;J.&#160;Poon&#160;and&#160;V.&#160;Buterin.&#160;Plasma:&#160;Scalable&#160;autonomous&#160;smart<br/>
<i>USENIX&#160;Symposium&#160;on&#160;Networked&#160;Systems&#160;Design&#160;and</i><br/>
contracts,&#160;2017.&#160;https://plasma.io/plasma.pdf.<br/>
<i>Implementation&#160;(NSDI)</i>,&#160;pages&#160;95–112,&#160;2019.<br/>
[69]&#160;J.&#160;Poon&#160;and&#160;T.&#160;Dryja.&#160;The&#160;Bitcoin&#160;Lightning&#160;Network:<br/>
[85]&#160;B.&#160;WhiteHat,&#160;A.&#160;Gluchowski,&#160;HarryR,&#160;Y.&#160;Fu,&#160;and<br/>
Scalable&#160;off-chain&#160;instant&#160;payments.&#160;https:<br/>
P.&#160;Castonguay.&#160;Roll_up&#160;/&#160;roll_back&#160;snark&#160;side&#160;chain&#160;~17000<br/>
//lightning.network/lightning-network-paper.pdf,<br/>
tps.&#160;https://ethresear.ch/t/roll-up-roll-back-<br/>
2016.<br/>
snark-side-chain-17000-tps/3675,&#160;Oct.&#160;2018.<br/>
[70]&#160;C.&#160;Reitwiessner.&#160;zkSNARKs&#160;test&#160;code.<br/>
[86]&#160;G.&#160;Wood.&#160;Ethereum:&#160;A&#160;secure&#160;decentralised&#160;generalised<br/>
https://gist.github.com/chriseth/<br/>
transaction&#160;ledger&#160;Byzantium&#160;version.<br/>
f9be9d9391efc5beb9704255a8e2989d,&#160;2017.<br/>
https://ethereum.github.io/yellowpaper/paper.pdf,<br/>
[71]&#160;F.&#160;B.&#160;Schneider.&#160;Implementing&#160;fault-tolerant&#160;services&#160;using<br/>
Oct.&#160;2019.<br/>
the&#160;state&#160;machine&#160;approach:&#160;A&#160;tutorial.&#160;<i>ACM&#160;Computing</i><br/>
[87]&#160;T.&#160;Xie,&#160;J.&#160;Zhang,&#160;Y.&#160;Zhang,&#160;C.&#160;Papamanthou,&#160;and&#160;D.&#160;Song.<br/>
<i>Surveys</i>,&#160;22(4):299–319,&#160;Dec.&#160;1990.<br/>
Libra:&#160;Succinct&#160;zero-knowledge&#160;proofs&#160;with&#160;optimal&#160;prover<br/>
[72]&#160;S.&#160;Setty.&#160;Spartan:&#160;Efﬁcient&#160;and&#160;general-purpose&#160;zkSNARKs<br/>
computation.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;International&#160;Cryptology</i><br/>
without&#160;trusted&#160;setup.&#160;Cryptology&#160;ePrint&#160;Archive,&#160;Report<br/>
<i>Conference&#160;(CRYPTO)</i>,&#160;2019.<br/>
2019/550,&#160;2019.<br/>
[88]&#160;M.&#160;Zamani,&#160;M.&#160;Movahedi,&#160;and&#160;M.&#160;Raykova.&#160;RapidChain:<br/>
[73]&#160;S.&#160;Setty,&#160;S.&#160;Angel,&#160;T.&#160;Gupta,&#160;and&#160;J.&#160;Lee.&#160;Proving&#160;the&#160;correct<br/>
Scaling&#160;blockchain&#160;via&#160;full&#160;sharding.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
execution&#160;of&#160;concurrent&#160;services&#160;in&#160;zero-knowledge.&#160;In<br/>
<i>ACM&#160;Conference&#160;on&#160;Computer&#160;and&#160;Communications&#160;Security</i><br/>
<i>Proceedings&#160;of&#160;the&#160;USENIX&#160;Symposium&#160;on&#160;Operating&#160;Systems</i><br/>
<i>(CCS)</i>,&#160;pages&#160;931–948,&#160;2018.<br/>
<i>Design&#160;and&#160;Implementation&#160;(OSDI)</i>,&#160;2018.<br/>
[89]&#160;Y.&#160;Zhang,&#160;D.&#160;Genkin,&#160;J.&#160;Katz,&#160;D.&#160;Papadopoulos,&#160;and<br/>
[74]&#160;S.&#160;Setty,&#160;B.&#160;Braun,&#160;V.&#160;Vu,&#160;A.&#160;J.&#160;Blumberg,&#160;B.&#160;Parno,&#160;and<br/>
C.&#160;Papamanthou.&#160;vSQL:&#160;Verifying&#160;arbitrary&#160;SQL&#160;queries&#160;over<br/>
M.&#160;Walﬁsh.&#160;Resolving&#160;the&#160;conﬂict&#160;between&#160;generality&#160;and<br/>
dynamic&#160;outsourced&#160;databases.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;IEEE</i><br/>
plausibility&#160;in&#160;veriﬁed&#160;computation.&#160;In&#160;<i>Proceedings&#160;of&#160;the</i><br/>
<i>Symposium&#160;on&#160;Security&#160;and&#160;Privacy&#160;(S&amp;P)</i>,&#160;2017.<br/>
<i>ACM&#160;European&#160;Conference&#160;on&#160;Computer&#160;Systems&#160;(EuroSys)</i>,<br/>Apr.&#160;2013.<br/>
[75]&#160;S.&#160;Setty,&#160;R.&#160;McPherson,&#160;A.&#160;J.&#160;Blumberg,&#160;and&#160;M.&#160;Walﬁsh.<br/>
Making&#160;argument&#160;systems&#160;for&#160;outsourced&#160;computation<br/>practical&#160;(sometimes).&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;Network&#160;and</i><br/>
<i>Distributed&#160;System&#160;Security&#160;Symposium&#160;(NDSS)</i>,&#160;Feb.&#160;2012.<br/>
[76]&#160;S.&#160;Setty,&#160;V.&#160;Vu,&#160;N.&#160;Panpalia,&#160;B.&#160;Braun,&#160;A.&#160;J.&#160;Blumberg,&#160;and<br/>
M.&#160;Walﬁsh.&#160;Taking&#160;proof-based&#160;veriﬁed&#160;computation&#160;a&#160;few<br/>steps&#160;closer&#160;to&#160;practicality.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;USENIX<br/>Security&#160;Symposium</i>,&#160;Aug.&#160;2012.<br/>
[77]&#160;Y.&#160;Sompolinsky&#160;and&#160;A.&#160;Zohar.&#160;Secure&#160;high-rate&#160;transaction<br/>
processing&#160;in&#160;Bitcoin.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;International</i><br/>
<i>Financial&#160;Cryptography&#160;and&#160;Data&#160;Security&#160;Conference</i>,&#160;pages<br/>
507–527,&#160;2015.<br/>
[78]&#160;J.&#160;Teutsch&#160;and&#160;C.&#160;Reitwießner.&#160;A&#160;scalable&#160;veriﬁcation&#160;solution<br/>
for&#160;blockchains,&#160;Nov.&#160;2017.<br/>https://people.cs.uchicago.edu/teutsch/papers/<br/>truebit.pdf.<br/>
[79]&#160;F.&#160;Vogelsteller&#160;and&#160;V.&#160;Buterin.&#160;EIP&#160;20:&#160;ERC-20&#160;token&#160;standard.<br/>
https://eips.ethereum.org/EIPS/eip-20,&#160;Nov.&#160;2015.<br/>
[80]&#160;R.&#160;S.&#160;Wahby,&#160;Y.&#160;Ji,&#160;A.&#160;J.&#160;Blumberg,&#160;abhi&#160;shelat,&#160;J.&#160;Thaler,<br/>
M.&#160;Walﬁsh,&#160;and&#160;T.&#160;Wies.&#160;Full&#160;accounting&#160;for&#160;veriﬁable<br/>outsourcing.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;ACM&#160;Conference&#160;on</i><br/>
<i>Computer&#160;and&#160;Communications&#160;Security&#160;(CCS)</i>,&#160;2017.<br/>
[81]&#160;R.&#160;S.&#160;Wahby,&#160;S.&#160;Setty,&#160;Z.&#160;Ren,&#160;A.&#160;J.&#160;Blumberg,&#160;and&#160;M.&#160;Walﬁsh.<br/>
Efﬁcient&#160;RAM&#160;and&#160;control&#160;ﬂow&#160;in&#160;veriﬁable&#160;outsourced<br/>computation.&#160;In&#160;<i>Proceedings&#160;of&#160;the&#160;Network&#160;and&#160;Distributed<br/>System&#160;Security&#160;Symposium&#160;(NDSS)</i>,&#160;2015.<br/>
[82]&#160;R.&#160;S.&#160;Wahby,&#160;I.&#160;Tzialla,&#160;abhi&#160;shelat,&#160;J.&#160;Thaler,&#160;and&#160;M.&#160;Walﬁsh.<br/>
Doubly-efﬁcient&#160;zkSNARKs&#160;without&#160;trusted&#160;setup.&#160;In<br/>
<i>Proceedings&#160;of&#160;the&#160;IEEE&#160;Symposium&#160;on&#160;Security&#160;and&#160;Privacy</i><br/>
<hr/>
</body>
</html>
